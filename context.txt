This file is a merged representation of the entire codebase, combined into a single document by Repomix.

<file_summary>
This section contains a summary of this file.

<purpose>
This file contains a packed representation of the entire repository's contents.
It is designed to be easily consumable by AI systems for analysis, code review,
or other automated processes.
</purpose>

<file_format>
The content is organized as follows:
1. This summary section
2. Repository information
3. Directory structure
4. Repository files (if enabled)
5. Multiple file entries, each consisting of:
  - File path as an attribute
  - Full contents of the file
</file_format>

<usage_guidelines>
- This file should be treated as read-only. Any changes should be made to the
  original repository files, not this packed version.
- When processing this file, use the file path to distinguish
  between different files in the repository.
- Be aware that this file may contain sensitive information. Handle it with
  the same level of security as you would the original repository.
</usage_guidelines>

<notes>
- Some files may have been excluded based on .gitignore rules and Repomix's configuration
- Binary files are not included in this packed representation. Please refer to the Repository Structure section for a complete list of file paths, including binary files
- Files matching patterns in .gitignore are excluded
- Files matching default ignore patterns are excluded
- Files are sorted by Git change count (files with more changes are at the bottom)
</notes>

</file_summary>

<directory_structure>
.agent/
  workflows/
    backup.md
    export-context.md
    publish.md
    review-feedback.md
    setup-dual-remote.md
  rules.md
docs/
  development_workflow.md
  implementation_plan.md
  integration.ts
  plan.md
  roadmap.md
  spec-kit-format.md
  spec-patch-format.md
  task.md
src/
  lib/
    assets/
      favicon.svg
    components/
      editor/
        ConstraintPanel.svelte
        index.ts
        SpecEditor.svelte
      ui/
        Button.svelte
        index.ts
        Panel.svelte
        StatusIndicator.svelte
      MermaidDiagram.svelte
      Sidebar.svelte
      StatusBar.svelte
    server/
      gemini.ts
    services/
      websocket.ts
    stores/
      artifact-store.ts
      history-store.ts
      integration-store.ts
      session-store.ts
      settings-store.ts
      spec-store.ts
    types/
      index.ts
    utils/
      crypto-utils.ts
      diff-utils.ts
      index.ts
      prompt-utils.ts
      storage-utils.ts
      yaml-utils.ts
    index.ts
  routes/
    api/
      generate/
        +server.ts
      models/
        +server.ts
    editor/
      +page.svelte
    history/
      +page.svelte
    settings/
      +page.svelte
    viewer/
      +page.svelte
    +layout.svelte
    +page.svelte
  app.css
  app.d.ts
  app.html
static/
  favicon.png
  favicon.svg
  manifest.json
  robots.txt
.gitignore
.npmrc
.prettierignore
.prettierrc
eslint.config.js
package.json
README.md
svelte.config.js
tsconfig.json
vite.config.ts
</directory_structure>

<files>
This section contains the contents of the repository's files.

<file path="src/lib/components/MermaidDiagram.svelte">
<!--
  Mermaid Diagram Component
  Mermaidå›³ã‚’ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã™ã‚‹ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
-->
<script lang="ts">
	import { onMount } from 'svelte';

	interface Props {
		code: string;
		id?: string;
	}

	let { code, id = 'mermaid-diagram' }: Props = $props();
	let container: HTMLDivElement;
	let svg = $state('');
	let error = $state<string | null>(null);

	onMount(async () => {
		try {
			// Mermaidã‚’å‹•çš„ã«ã‚¤ãƒ³ãƒãƒ¼ãƒˆ
			const mermaid = await import('mermaid');
			mermaid.default.initialize({
				startOnLoad: false,
				theme: 'dark',
				themeVariables: {
					primaryColor: '#0ea5e9',
					primaryTextColor: '#f8fafc',
					primaryBorderColor: '#334155',
					lineColor: '#64748b',
					secondaryColor: '#1e293b',
					tertiaryColor: '#0f172a'
				}
			});

			const { svg: renderedSvg } = await mermaid.default.render(id, code);
			svg = renderedSvg;
			error = null;
		} catch (e) {
			console.error('Mermaid render error:', e);
			error = e instanceof Error ? e.message : 'Mermaid rendering failed';
		}
	});

	// codeãŒå¤‰æ›´ã•ã‚ŒãŸã‚‰å†ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°
	$effect(() => {
		if (code && container) {
			(async () => {
				try {
					const mermaid = await import('mermaid');
					const uniqueId = `${id}-${Date.now()}`;
					const { svg: renderedSvg } = await mermaid.default.render(uniqueId, code);
					svg = renderedSvg;
					error = null;
				} catch (e) {
					error = e instanceof Error ? e.message : 'Mermaid rendering failed';
				}
			})();
		}
	});
</script>

<div class="mermaid-container" bind:this={container}>
	{#if error}
		<div class="mermaid-error">
			<span class="error-icon">âš ï¸</span>
			<span class="error-text">{error}</span>
		</div>
	{:else if svg}
		{@html svg}
	{:else}
		<div class="mermaid-loading">Loading diagram...</div>
	{/if}
</div>

<style>
	.mermaid-container {
		display: flex;
		justify-content: center;
		align-items: center;
		min-height: 100px;
		padding: var(--space-4);
		background: var(--color-bg-tertiary);
		border-radius: var(--radius-md);
		overflow: auto;
	}

	.mermaid-container :global(svg) {
		max-width: 100%;
		height: auto;
	}

	.mermaid-error {
		display: flex;
		align-items: center;
		gap: var(--space-2);
		color: var(--color-accent-warning);
		font-size: var(--font-size-sm);
	}

	.mermaid-loading {
		color: var(--color-text-muted);
		font-size: var(--font-size-sm);
	}
</style>
</file>

<file path=".agent/workflows/backup.md">
---
description: Giteaã«ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‚’ãƒ—ãƒƒã‚·ãƒ¥ã™ã‚‹
---
# Giteaãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼

ç¾åœ¨ã®ä½œæ¥­çŠ¶æ…‹ã‚’Giteaã«ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã¨ã—ã¦ãƒ—ãƒƒã‚·ãƒ¥ã—ã¾ã™ã€‚

## æ‰‹é †

// turbo
1. `git status` ã§ç¾åœ¨ã®çŠ¶æ…‹ã‚’ç¢ºèª
2. æœªã‚³ãƒŸãƒƒãƒˆã®å¤‰æ›´ãŒã‚ã‚‹å ´åˆã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ã‚³ãƒŸãƒƒãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ç¢ºèª
// turbo
3. `git add -A && git commit -m "<ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸>"` ã§å¤‰æ›´ã‚’ã‚³ãƒŸãƒƒãƒˆ
// turbo
4. `git push origin` ã§Giteaã¸ãƒ—ãƒƒã‚·ãƒ¥
5. å®Œäº†ã‚’å ±å‘Š
</file>

<file path=".agent/workflows/export-context.md">
---
description: ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’Gemini/ChatGPTãƒ¬ãƒ“ãƒ¥ãƒ¼ç”¨ã«ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
---
# ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼

repomixã‚’ä½¿ç”¨ã—ã¦ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå…¨ä½“ã‚’1ãƒ•ã‚¡ã‚¤ãƒ«ã«æ›¸ãå‡ºã—ã€å¤–éƒ¨AIãƒ¬ãƒ“ãƒ¥ãƒ¼ã«å‚™ãˆã¾ã™ã€‚

## å‰ææ¡ä»¶

repomixãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ã‚‹ã“ã¨ã€‚
æœªã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã®å ´åˆã¯ `npm install -g repomix` ã‚’å®Ÿè¡Œã€‚

## æ‰‹é †

// turbo
1. `npx repomix --output context.txt` ã§ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
2. ç”Ÿæˆã•ã‚ŒãŸ `context.txt` ã®å†…å®¹ã‚µãƒãƒªãƒ¼ã‚’å ±å‘Š
3. ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ã€Œcontext.txt ã‚’Gemini/ChatGPTã«æ¸¡ã—ã¦ãƒ¬ãƒ“ãƒ¥ãƒ¼ä¾é ¼ã—ã¦ãã ã•ã„ã€ã¨æ¡ˆå†…

## ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆå¾Œã®ãƒ¬ãƒ“ãƒ¥ãƒ¼ä¾é ¼ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ

```
ä»¥ä¸‹ã¯ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰å…¨ä½“ã§ã™ã€‚
ä»¥ä¸‹ã®è¦³ç‚¹ã§ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚’ãŠé¡˜ã„ã—ã¾ã™ï¼š

1. è¨­è¨ˆãƒ»ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã®æ•´åˆæ€§
2. ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ä¸Šã®æ‡¸å¿µ
3. UI/UXã®æ”¹å–„æ¡ˆ
4. ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–ã®ä½™åœ°

---
[context.txtã®å†…å®¹ã‚’ã“ã“ã«è²¼ã‚Šä»˜ã‘]
```
</file>

<file path=".agent/workflows/publish.md">
---
description: GitHubã¸ã‚¯ãƒªãƒ¼ãƒ³ãªã‚³ãƒŸãƒƒãƒˆã‚’å…¬é–‹ã™ã‚‹
---
# GitHubå…¬é–‹ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼

é–‹ç™ºãƒ–ãƒ©ãƒ³ãƒã®å¤‰æ›´ã‚’ã‚¹ã‚¯ãƒƒã‚·ãƒ¥ãƒãƒ¼ã‚¸ã—ã¦GitHubã¸å…¬é–‹ã—ã¾ã™ã€‚

## æ‰‹é †

1. ç¾åœ¨ã®ãƒ–ãƒ©ãƒ³ãƒåã¨å¤‰æ›´å·®åˆ†ã‚’ç¢ºèªã™ã‚‹
// turbo
2. `git checkout main` ã§mainãƒ–ãƒ©ãƒ³ãƒã«åˆ‡ã‚Šæ›¿ãˆã‚‹
3. `git merge --squash <é–‹ç™ºãƒ–ãƒ©ãƒ³ãƒå>` ã§ã‚¹ã‚¯ãƒƒã‚·ãƒ¥ãƒãƒ¼ã‚¸ã‚’å®Ÿè¡Œ
4. ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ã‚³ãƒŸãƒƒãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®å†…å®¹ã‚’ç¢ºèªã™ã‚‹
5. `git commit -m "<ã‚³ãƒŸãƒƒãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸>"` ã§ã‚³ãƒŸãƒƒãƒˆã‚’ä½œæˆ
// turbo
6. `git push public main` ã§GitHubã¸ãƒ—ãƒƒã‚·ãƒ¥
7. å®Œäº†ã‚’å ±å‘Šã™ã‚‹
</file>

<file path=".agent/workflows/review-feedback.md">
---
description: å¤–éƒ¨AIã®ãƒ¬ãƒ“ãƒ¥ãƒ¼çµæœã‚’å–ã‚Šè¾¼ã‚€
---
# ãƒ¬ãƒ“ãƒ¥ãƒ¼ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯å–ã‚Šè¾¼ã¿ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼

ChatGPT/Geminiã‹ã‚‰ã®ãƒ¬ãƒ“ãƒ¥ãƒ¼çµæœã‚’æ•´ç†ã—ã€ä¿®æ­£ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚

## å…¥åŠ›ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆï¼ˆæ¨å¥¨ï¼‰

ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯ä»¥ä¸‹ã®å½¢å¼ã§ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã‚’è²¼ã‚Šä»˜ã‘ã¦ãã ã•ã„ï¼š

```markdown
## å¤–éƒ¨AIãƒ¬ãƒ“ãƒ¥ãƒ¼çµæœ

### æ¡ç”¨ã™ã‚‹æŒ‡æ‘˜
- [ ] â—‹â—‹ã®ä¿®æ­£
- [ ] â–³â–³ã®è¿½åŠ 

### æ¤œè¨ãŒå¿…è¦ãªæŒ‡æ‘˜
- â–¡â–¡ã«ã¤ã„ã¦ï¼ˆç†ç”±: ...ï¼‰

### å´ä¸‹ã™ã‚‹æŒ‡æ‘˜
- Ã—Ã—ï¼ˆå´ä¸‹ç†ç”±: ...ï¼‰
```

## æ‰‹é †

1. ãƒ¬ãƒ“ãƒ¥ãƒ¼çµæœã®å†…å®¹ã‚’è§£æã—ã€å¯¾å¿œé …ç›®ã‚’ä¸€è¦§åŒ–
2. ã€Œæ¡ç”¨ã™ã‚‹æŒ‡æ‘˜ã€ã«ã¤ã„ã¦ã€å¯¾è±¡ãƒ•ã‚¡ã‚¤ãƒ«ã¨ä¿®æ­£å†…å®¹ã‚’ç‰¹å®š
3. ä¿®æ­£ã‚’å®Ÿè¡Œ
4. ã€Œæ¤œè¨ãŒå¿…è¦ãªæŒ‡æ‘˜ã€ã«ã¤ã„ã¦ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¨ç›¸è«‡
5. ä¿®æ­£å®Œäº†å¾Œã€é–¢é€£ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆï¼ˆdocs/ï¼‰ã‚‚æ›´æ–°
6. å¤‰æ›´ã‚µãƒãƒªãƒ¼ã‚’å ±å‘Š
</file>

<file path=".agent/workflows/setup-dual-remote.md">
---
description: Gitea/GitHub Dual Remoteç’°å¢ƒã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
---
# Dual Remote ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼

1ã¤ã®ãƒªãƒã‚¸ãƒˆãƒªã«2ã¤ã®ãƒªãƒ¢ãƒ¼ãƒˆï¼ˆGitea + GitHubï¼‰ã‚’è¨­å®šã—ã¾ã™ã€‚

## å‰ææ¡ä»¶

- GitåˆæœŸåŒ–æ¸ˆã¿ã§ã‚ã‚‹ã“ã¨
- Giteaã¨GitHubã®ãƒªãƒã‚¸ãƒˆãƒªURLã‚’ç”¨æ„ã—ã¦ã„ã‚‹ã“ã¨

## æ‰‹é †

1. ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«Giteaã®ãƒªãƒã‚¸ãƒˆãƒªURLã‚’ç¢ºèª
2. ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«GitHubã®ãƒªãƒã‚¸ãƒˆãƒªURLã‚’ç¢ºèª
// turbo
3. `git remote add origin <Giteaã®URL>` ã§Giteaã‚’originã¨ã—ã¦è¿½åŠ 
// turbo
4. `git remote add public <GitHubã®URL>` ã§GitHubã‚’publicã¨ã—ã¦è¿½åŠ 
// turbo
5. `git remote -v` ã§ãƒªãƒ¢ãƒ¼ãƒˆè¨­å®šã‚’ç¢ºèª
6. è¨­å®šå®Œäº†ã‚’å ±å‘Š

## é‹ç”¨ãƒ«ãƒ¼ãƒ«

| ãƒªãƒ¢ãƒ¼ãƒˆå | ç”¨é€” | ãƒ—ãƒƒã‚·ãƒ¥ã‚¿ã‚¤ãƒŸãƒ³ã‚° |
|-----------|------|-------------------|
| `origin` (Gitea) | ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ãƒ»WIP | ä½œæ¥­ã®åŒºåˆ‡ã‚Šã”ã¨ |
| `public` (GitHub) | å…¬é–‹ãƒ»AIãƒ¬ãƒ“ãƒ¥ãƒ¼ | ã‚¹ã‚¯ãƒƒã‚·ãƒ¥ãƒãƒ¼ã‚¸å¾Œ |
</file>

<file path=".agent/rules.md">
# Workspace Rules
1. å¸¸ã« `docs/development_workflow.md` ã‚’æœ€å„ªå…ˆã®æŒ‡ç¤ºæ›¸ã¨ã—ã¦éµå®ˆã—ã€å…¨ã¦ã®ä½œæ¥­å‰ã«ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ã®å†…å®¹ã¨ç¾åœ¨ã®ã‚¿ã‚¹ã‚¯ã®æ•´åˆæ€§ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚
2. ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆï¼ˆPlan/Taskç­‰ï¼‰ã¯å¿…ãš `docs/` ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªé…ä¸‹ã§ç®¡ç†ã—ã¦ãã ã•ã„ã€‚
3. Plan / Task ã«è¨˜è¼‰ã•ã‚ŒãŸç›®çš„ãƒ»ã‚¹ã‚³ãƒ¼ãƒ—ãƒ»åˆ¶ç´„ã¯ã€äººé–“ã®æ‰¿èªãªã—ã«å¤‰æ›´ã—ã¦ã¯ãªã‚Šã¾ã›ã‚“ã€‚å¤‰æ›´ãŒå¿…è¦ãªå ´åˆã¯ã€Œå¤‰æ›´ææ¡ˆã€ã¨ã—ã¦æ˜ç¤ºã—ã¦ãã ã•ã„ã€‚
4. å®Ÿè£…ä½œæ¥­ã‚’é–‹å§‹ã™ã‚‹å‰ã«ã€å¯¾å¿œã™ã‚‹ Plan / Task ãŒ docs/ é…ä¸‹ã«å­˜åœ¨ã™ã‚‹ã“ã¨ã‚’å¿…ãšç¢ºèªã—ã¦ãã ã•ã„ã€‚
5. æŒ‡ç¤ºã‚„ä»•æ§˜ã«æ›–æ˜§ã•ã‚„çŸ›ç›¾ã‚’æ„Ÿã˜ãŸå ´åˆã€è‡ªå·±åˆ¤æ–­ã§è£œå®Œã›ãšã€å¿…ãšè³ªå•ã¾ãŸã¯ç¢ºèªã‚’è¡Œã£ã¦ãã ã•ã„ã€‚
</file>

<file path="docs/development_workflow.md">
<!-- Antigravity Instruction -->
ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¯ä¸Šè¨˜ã€Œé–‹ç™ºãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã€ã«å³å¯†ã«å¾“ã£ã¦é–‹ç™ºã•ã‚Œã¾ã™ã€‚
Antigravityã¯å¸¸ã«ã“ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’å‚ç…§ã—ã€å®šç¾©ã•ã‚ŒãŸã‚³ãƒãƒ³ãƒ‰ï¼ˆ/backup, /publish ç­‰ï¼‰ã¨ãƒ—ãƒ­ã‚»ã‚¹ã‚’éµå®ˆã—ã¦ãã ã•ã„ã€‚
Planã‚„Taskã¯Artifactsã§ã¯ãªãã€`docs/` é…ä¸‹ã®ãƒãƒ¼ã‚¯ãƒ€ã‚¦ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«ã¨ã—ã¦ç®¡ç†ã—ã¦ãã ã•ã„ã€‚

# é–‹ç™ºãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼

## é‡è¦ãªåŸå‰‡ï¼ˆå¿…é ˆï¼‰
[!IMPORTANT]
**Plan / Task ã«è¨˜è¼‰ã•ã‚ŒãŸã€Œç›®çš„ãƒ»ã‚¹ã‚³ãƒ¼ãƒ—ãƒ»åˆ¶ç´„ã€ã¯ã€äººé–“ã®æ‰¿èªãªã—ã«å¤‰æ›´ã—ã¦ã¯ãªã‚‰ãªã„ã€‚**
å¤‰æ›´ãŒå¿…è¦ãªå ´åˆã¯ã€å¿…ãšã€Œå¤‰æ›´ææ¡ˆã€ã¨ã—ã¦åˆ¥ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã«è¨˜è¿°ã—ã€æ‰¿èªã‚’å¾…ã¤ã“ã¨ã€‚

## æ¦‚è¦

è¤‡æ•°ã®AIï¼ˆGemini/ChatGPT/Antigravityï¼‰ã‚’æ´»ç”¨ã—ãŸåŠ¹ç‡çš„ãªé–‹ç™ºãƒ•ãƒ­ãƒ¼ã§ã™ã€‚

## é–‹ç™ºãƒ•ãƒ­ãƒ¼å›³

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  1. ã‚¢ã‚¤ãƒ‡ã‚£ã‚¢å‡ºã—: Gemini/ChatGPT                       â”‚
â”‚  2. ãƒ—ãƒ©ãƒ³ä½œæˆ: Antigravity â†’ /review-feedback          â”‚
â”‚  3. å®Ÿè£…: Antigravity                                   â”‚
â”‚  4. ãƒ­ãƒ¼ã‚«ãƒ«ç¢ºèª: npm run dev (+ mkcert HTTPS)          â”‚
â”‚  5. ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—: /backup (Gitea)                       â”‚
â”‚  6. AIãƒ¬ãƒ“ãƒ¥ãƒ¼: /export-context â†’ Gemini/ChatGPT        â”‚
â”‚  7. ä¿®æ­£: /review-feedback â†’ 3ã«æˆ»ã‚‹                    â”‚
â”‚  8. å…¬é–‹æº–å‚™å®Œäº†: /publish â†’ GitHub Public + Pages      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## æ®µéšåˆ¥ãƒªãƒã‚¸ãƒˆãƒªé‹ç”¨

| é–‹ç™ºæ®µéš | ãƒªãƒã‚¸ãƒˆãƒª | ç¢ºèªæ–¹æ³• | AIãƒ¬ãƒ“ãƒ¥ãƒ¼ |
|----------|-----------|----------|-----------|
| **åˆæœŸé–‹ç™º** | Gitea | ãƒ­ãƒ¼ã‚«ãƒ«HTTP/HTTPS | repomix â†’ è²¼ã‚Šä»˜ã‘ |
| **æ©Ÿèƒ½å®Ÿè£…ä¸­** | Gitea | ãƒ­ãƒ¼ã‚«ãƒ«HTTPS | repomix â†’ è²¼ã‚Šä»˜ã‘ |
| **å…¬é–‹æº–å‚™** | GitHub Public | Pages | URLç›´æ¥å…±æœ‰å¯èƒ½ |
| **å…¬é–‹å¾Œ** | GitHub Public | Pages | URLç›´æ¥å…±æœ‰ |

## ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚³ãƒãƒ³ãƒ‰ä¸€è¦§

| ã‚³ãƒãƒ³ãƒ‰ | èª¬æ˜ | ä½¿ç”¨ã‚¿ã‚¤ãƒŸãƒ³ã‚° |
|---------|------|---------------|
| `/backup` | Giteaã«ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ— | ä½œæ¥­ã®åŒºåˆ‡ã‚Šã”ã¨ |
| `/publish` | GitHubã¸ã‚¹ã‚¯ãƒƒã‚·ãƒ¥ãƒãƒ¼ã‚¸ | å…¬é–‹æº–å‚™å®Œäº†æ™‚ |
| `/review-feedback` | å¤–éƒ¨AIãƒ¬ãƒ“ãƒ¥ãƒ¼çµæœã‚’å–ã‚Šè¾¼ã‚€ | ãƒ¬ãƒ“ãƒ¥ãƒ¼å¾Œ |
| `/export-context` | repomixã§ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ | AIãƒ¬ãƒ“ãƒ¥ãƒ¼ä¾é ¼å‰ |
| `/setup-dual-remote` | Dual Remoteè¨­å®š | åˆå›ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—æ™‚ |

## ãƒªãƒ¢ãƒ¼ãƒˆãƒªãƒã‚¸ãƒˆãƒªæ§‹æˆ

| ãƒªãƒ¢ãƒ¼ãƒˆå | URL | ç”¨é€” |
|-----------|-----|------|
| `origin` | Gitea (ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆ) | é–‹ç™ºãƒ»ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ— |
| `public` | GitHub (ãƒ‘ãƒ–ãƒªãƒƒã‚¯) | å…¬é–‹ãƒ»Pages |

## ãƒ­ãƒ¼ã‚«ãƒ«HTTPSç’°å¢ƒï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰

PWAã®Service Workerç­‰ã‚’ãƒ­ãƒ¼ã‚«ãƒ«ã§ãƒ†ã‚¹ãƒˆã™ã‚‹å ´åˆï¼š

```bash
# mkcertã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ï¼ˆåˆå›ã®ã¿ï¼‰
sudo apt install mkcert
mkcert -install
mkcert localhost

# é–‹ç™ºã‚µãƒ¼ãƒãƒ¼èµ·å‹•æ™‚ã«HTTPSæœ‰åŠ¹åŒ–
npm run dev -- --https
```

## AIãƒ¬ãƒ“ãƒ¥ãƒ¼ä¾é ¼ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ

```markdown
ä»¥ä¸‹ã¯ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰å…¨ä½“ã§ã™ã€‚
ä»¥ä¸‹ã®è¦³ç‚¹ã§ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚’ãŠé¡˜ã„ã—ã¾ã™ï¼š

1. è¨­è¨ˆãƒ»ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã®æ•´åˆæ€§
2. ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ä¸Šã®æ‡¸å¿µ
3. UI/UXã®æ”¹å–„æ¡ˆ
4. ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–ã®ä½™åœ°

---
[context.txtã®å†…å®¹ã‚’ã“ã“ã«è²¼ã‚Šä»˜ã‘]
```

## ãƒ¬ãƒ“ãƒ¥ãƒ¼çµæœãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯å½¢å¼

å¤–éƒ¨AIã‹ã‚‰ã®æŒ‡æ‘˜ã‚’Antigravityã«æ¸¡ã™éš›ã®æ¨å¥¨ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆï¼š

```markdown
## å¤–éƒ¨AIãƒ¬ãƒ“ãƒ¥ãƒ¼çµæœ

### æ¡ç”¨ã™ã‚‹æŒ‡æ‘˜
- [ ] â—‹â—‹ã®ä¿®æ­£
- [ ] â–³â–³ã®è¿½åŠ 

### æ¤œè¨ãŒå¿…è¦ãªæŒ‡æ‘˜
- â–¡â–¡ã«ã¤ã„ã¦ï¼ˆç†ç”±: ...ï¼‰

### å´ä¸‹ã™ã‚‹æŒ‡æ‘˜
- Ã—Ã—ï¼ˆå´ä¸‹ç†ç”±: ...ï¼‰
```
</file>

<file path="docs/implementation_plan.md">
# Phase 4 å®Ÿè£…è¨ˆç”»: å·®åˆ†ç®¡ç†ã¨çµ±åˆ

## ç›®æ¨™
Spec-Flow Studioã®æ ¸å¿ƒæ©Ÿèƒ½ã§ã‚ã‚‹ã€ŒDiffé§†å‹•é–‹ç™ºã€ã‚’å®Ÿè£…ã™ã‚‹ã€‚  
ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆä»•æ§˜ã®å¤‰æ›´ã‚’æ¤œå‡ºã—ã€`SpecPatch`å½¢å¼ã§è¨˜éŒ²ãƒ»ç®¡ç†ã™ã‚‹ã€‚  
ã¾ãŸã€å±¥æ­´ç®¡ç†ï¼ˆã‚¿ã‚¤ãƒ ãƒˆãƒ©ãƒ™ãƒ«ï¼‰ã¨Aether Consoleã¨ã®WebSocketé€£æºã‚’å®Œæˆã•ã›ã‚‹ã€‚

## ãƒ¦ãƒ¼ã‚¶ãƒ¼ç¢ºèªäº‹é …

> [!IMPORTANT]
> **WebSocketçµ±åˆ**: å®Œå…¨ãªæ¤œè¨¼ã«ã¯Aether Consoleã®èµ·å‹•ãŒå¿…è¦ã§ã™ã€‚  
> Aether ConsoleãŒåˆ©ç”¨ã§ããªã„å ´åˆã¯ã€WebSocketæ¥ç¶šã‚’ãƒ¢ãƒƒã‚¯åŒ–ã—ã¦ãƒ­ãƒ¼ã‚«ãƒ«ãƒ†ã‚¹ãƒˆã‚’è¡Œã„ã¾ã™ã€‚

---

## å¤‰æ›´å†…å®¹

### ã‚³ã‚¢ãƒ­ã‚¸ãƒƒã‚¯ (Diffã‚¨ãƒ³ã‚¸ãƒ³)

#### [NEW] [diff-utils.ts](file:///home/gemini1/workspace3/spec-flow-studio/src/lib/utils/diff-utils.ts)
- `generateSpecPatch(before, after)` ã®å®Ÿè£…
  - ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã®è¿½åŠ ãƒ»å‰Šé™¤ãƒ»å¤‰æ›´ã‚’æ¤œå‡º
  - ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãƒ¬ãƒ™ãƒ«ã®å¤‰æ›´ã‚’æ¤œå‡ºï¼ˆconstraints, capabilitiesãªã©ï¼‰
  - å½±éŸ¿åº¦ï¼ˆimpactï¼‰ã‚’ãƒ’ãƒ¥ãƒ¼ãƒªã‚¹ãƒ†ã‚£ãƒƒã‚¯ã«ç®—å‡º
- `applySpecPatch(spec, patch)` ã®å®Ÿè£…
  - ãƒ‘ãƒƒãƒã‚’é©ç”¨ã—ã¦çŠ¶æ…‹ã‚’æ›´æ–°

---

### çŠ¶æ…‹ç®¡ç† (å±¥æ­´)

#### [NEW] [history-store.ts](file:///home/gemini1/workspace3/spec-flow-studio/src/lib/stores/history-store.ts)
- `SpecPatch` ã®ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³ã‚’ä¿å­˜
- Undo / Redo ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã®å®Ÿè£…
- `localStorage` ã¸ã®æ°¸ç¶šåŒ–

---

### UIã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ

#### [NEW] [history/+page.svelte](file:///home/gemini1/workspace3/spec-flow-studio/src/routes/history/+page.svelte)
- ãƒ‘ãƒƒãƒã®ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³è¡¨ç¤º
- é¸æŠã—ãŸãƒ‘ãƒƒãƒã®è©³ç´°è¡¨ç¤ºï¼ˆè‡ªç„¶è¨€èªè¦ç´„ + æ§‹é€ å·®åˆ†ï¼‰
- ã€Œã“ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã«æˆ»ã™ã€ãƒœã‚¿ãƒ³

#### [MODIFY] [editor/+page.svelte](file:///home/gemini1/workspace3/spec-flow-studio/src/routes/editor/+page.svelte)
- ä¿å­˜æ™‚ï¼ˆã¾ãŸã¯ã€Œã‚³ãƒŸãƒƒãƒˆã€ãƒœã‚¿ãƒ³æŠ¼ä¸‹æ™‚ï¼‰ã«Diffç”Ÿæˆã‚’ãƒˆãƒªã‚¬ãƒ¼
- `history-store` ã¨ã®é€£æº

---

### çµ±åˆ (WebSocket)

#### [NEW] [websocket.ts](file:///home/gemini1/workspace3/spec-flow-studio/src/lib/services/websocket.ts)
- Spec-Flow Studio â†” Aether Console æ¥ç¶š
- ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚¿ã‚¤ãƒ—: `PATCH_CREATED`, `SYNC_REQUEST`, `SYNC_RESPONSE`

---

## æ¤œè¨¼è¨ˆç”»

### è‡ªå‹•ãƒ†ã‚¹ãƒˆ
- **Diffãƒ­ã‚¸ãƒƒã‚¯**: `diff-utils.ts` ã®ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆ
  - ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆè¿½åŠ ãƒ»å‰Šé™¤ã®æ¤œå‡ºç¢ºèª
  - ãƒã‚¹ãƒˆã•ã‚ŒãŸãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰å¤‰æ›´ï¼ˆconstraintsãªã©ï¼‰ã®æ¤œå‡ºç¢ºèª
  - ãƒ‘ãƒƒãƒé©ç”¨å¾Œã€å…ƒã®çŠ¶æ…‹ãŒå¾©å…ƒã§ãã‚‹ã“ã¨ã‚’ç¢ºèª

### æ‰‹å‹•æ¤œè¨¼
1. **Diffç”Ÿæˆ**
   - ã‚¨ãƒ‡ã‚£ã‚¿ã§Specã‚’å¤‰æ›´
   - å±¥æ­´ãƒ“ãƒ¥ãƒ¼ã«æ–°ã—ã„ãƒ‘ãƒƒãƒãŒä½œæˆã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª
   - Summaryã¨Diffsã®å†…å®¹ãŒæ­£ã—ã„ã“ã¨ã‚’ç¢ºèª
2. **ã‚¿ã‚¤ãƒ ãƒˆãƒ©ãƒ™ãƒ«**
   - è¤‡æ•°å›å¤‰æ›´ã‚’åŠ ãˆã‚‹
   - ã€ŒUndoã€ã¾ãŸã¯å¤ã„ãƒ‘ãƒƒãƒã‚’é¸æŠ
   - ã‚¨ãƒ‡ã‚£ã‚¿ã®å†…å®¹ãŒä»¥å‰ã®çŠ¶æ…‹ã«æˆ»ã‚‹ã“ã¨ã‚’ç¢ºèª
3. **æ°¸ç¶šåŒ–**
   - ãƒšãƒ¼ã‚¸ã‚’ãƒªãƒ­ãƒ¼ãƒ‰
   - å±¥æ­´ã¨ç¾åœ¨ã®çŠ¶æ…‹ãŒå¾©å…ƒã•ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèª
</file>

<file path="docs/integration.ts">
/**
 * Spec-Flow Studio Integration Types
 * 
 * Aether Consoleã¨Spec-Flow Studioã®é€£æºç”¨ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹å®šç¾©
 * Spec-Flow Studioå´ã§ã‚‚åŒã˜å‹å®šç¾©ã‚’ä½¿ç”¨ã™ã‚‹
 */

// ========================================
// Spec-Kitå½¢å¼ï¼ˆå…±é€šãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«ï¼‰
// ========================================

/**
 * ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆä»•æ§˜
 */
export interface AgentSpec {
    name: string;
    displayName: string;
    role: string;
    capabilities: string[];
    constraints: string[];
    communication: {
        canSendTo: string[];
        canReceiveFrom: string[];
    };
}

/**
 * Specå·®åˆ†ï¼ˆä»•æ§˜å¤‰æ›´ï¼‰
 */
export interface SpecDiff {
    id: string;
    agentName: string;
    operation: 'add' | 'remove' | 'modify';
    path: string;
    before?: unknown;
    after?: unknown;
    description: string;
    impact: 'low' | 'medium' | 'high';
}

/**
 * ãƒ‘ãƒƒãƒï¼ˆå·®åˆ†ã®é›†åˆï¼‰
 */
export interface SpecPatch {
    id: string;
    name: string;
    description: string;
    diffs: SpecDiff[];
    appliedAt?: Date;
}

// ========================================
// é€£æºã‚¤ãƒ™ãƒ³ãƒˆ
// ========================================

/**
 * Aether Console â†’ Spec-Flow Studio
 * ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã‹ã‚‰ã‚¹ã‚¿ã‚¸ã‚ªã¸é€ä¿¡ã™ã‚‹ã‚¤ãƒ™ãƒ³ãƒˆ
 */
export type ConsoleToStudioEvent =
    | { type: 'PATCH_APPLIED'; patch: SpecPatch }
    | { type: 'PATCH_REVERTED'; patchId: string }
    | { type: 'AGENT_EXECUTED'; agentName: string; input: string; output: string }
    | { type: 'PROPOSAL_GENERATED'; proposal: string; agentResults: AgentResultSummary[] }
    | { type: 'SYNC_REQUEST'; };

/**
 * Spec-Flow Studio â†’ Aether Console
 * ã‚¹ã‚¿ã‚¸ã‚ªã‹ã‚‰ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã¸é€ä¿¡ã™ã‚‹ã‚¤ãƒ™ãƒ³ãƒˆ
 */
export type StudioToConsoleEvent =
    | { type: 'SPEC_UPDATED'; agents: AgentSpec[] }
    | { type: 'PATCH_CREATED'; patch: SpecPatch }
    | { type: 'SCENARIO_CREATED'; scenario: ScenarioSummary }
    | { type: 'SYNC_RESPONSE'; agents: AgentSpec[]; patches: SpecPatch[] };

/**
 * ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆå®Ÿè¡Œçµæœã®æ¦‚è¦
 */
export interface AgentResultSummary {
    agentName: string;
    displayName: string;
    status: 'completed' | 'error';
    responseSummary: string;
}

/**
 * ã‚·ãƒŠãƒªã‚ªã®æ¦‚è¦
 */
export interface ScenarioSummary {
    id: string;
    name: string;
    description: string;
    messageCount: number;
}

// ========================================
// é€£æºè¨­å®š
// ========================================

/**
 * é€£æºæ¥ç¶šè¨­å®š
 */
export interface IntegrationConfig {
    /** Spec-Flow Studioã®WebSocket URL */
    studioUrl: string;
    /** è‡ªå‹•åŒæœŸã‚’æœ‰åŠ¹ã«ã™ã‚‹ã‹ */
    autoSync: boolean;
    /** åŒæœŸé–“éš”ï¼ˆãƒŸãƒªç§’ï¼‰ */
    syncInterval: number;
}

/**
 * ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®é€£æºè¨­å®š
 */
export const DEFAULT_INTEGRATION_CONFIG: IntegrationConfig = {
    studioUrl: 'ws://localhost:3001/api/ws',
    autoSync: false,
    syncInterval: 5000
};
</file>

<file path="docs/plan.md">
# Spec-Flow Studio å®Ÿè£…è¨ˆç”»

## ç›®çš„ãƒ»ã‚¹ã‚³ãƒ¼ãƒ—ãƒ»åˆ¶ç´„

> [!IMPORTANT]
> ä»¥ä¸‹ã®å†…å®¹ã¯äººé–“ã®æ‰¿èªãªã—ã«å¤‰æ›´ã—ã¦ã¯ãªã‚‰ãªã„ã€‚å¤‰æ›´ãŒå¿…è¦ãªå ´åˆã¯ã€Œå¤‰æ›´ææ¡ˆã€ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã«è¨˜è¿°ã™ã‚‹ã“ã¨ã€‚

### ç›®çš„

Spec-Flow Studioã¯ã€AIãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚’å¯è¦–åŒ–ãƒ»åˆ¶å¾¡ã™ã‚‹ãŸã‚ã®PWAã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã§ã‚ã‚‹ã€‚
Spec-Kitå½¢å¼ã§ä»•æ§˜ã‚’è¨˜è¿°ã—ã€AIãŒè‡ªå‹•çš„ã«ä»¥ä¸‹ã‚’ç”Ÿæˆã™ã‚‹ï¼š

- UIãƒ¢ãƒƒã‚¯
- APIä»•æ§˜
- ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹
- ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹å›³

Aether Consoleï¼ˆSFé¢¨å¸ä»¤å®¤ï¼‰ã¨é€£æºã—ã€ã€ŒAIã‚’ã©ã†åˆ¶å¾¡ã™ã‚‹ã‹ã€ã‚’å¯è¦–åŒ–ã§ãã‚‹ãƒ‡ãƒ¢ãƒ³ã‚¹ãƒˆãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ„ãƒ¼ãƒ«ã¨ãªã‚‹ã€‚

### ã‚¹ã‚³ãƒ¼ãƒ—

**å«ã‚ã‚‹ã‚‚ã®:**
- Spec-Kitã‚¨ãƒ‡ã‚£ã‚¿ï¼ˆYAMLå½¢å¼ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆä»•æ§˜ã®ç·¨é›†ï¼‰
- AIç”Ÿæˆã‚¨ãƒ³ã‚¸ãƒ³ï¼ˆGemini APIã«ã‚ˆã‚‹è‡ªå‹•ç”Ÿæˆï¼‰
- ç”Ÿæˆç‰©ãƒ“ãƒ¥ãƒ¼ã‚¢ï¼ˆPWAã§ä¸€è¦§è¡¨ç¤ºï¼‰
- å·®åˆ†ç®¡ç†ï¼ˆSpecPatchä½œæˆãƒ»é©ç”¨ãƒ»å±¥æ­´ï¼‰
- Aether Consoleé€£æºï¼ˆWebSocketåŒæ–¹å‘é€šä¿¡ï¼‰

**å«ã‚ãªã„ã‚‚ã®ï¼ˆPhase 1ã§ã¯ï¼‰:**
- è¤‡é›‘ãªãƒ¦ãƒ¼ã‚¶ãƒ¼èªè¨¼
- ãƒãƒ«ãƒãƒ†ãƒŠãƒ³ãƒˆå¯¾å¿œ
- ã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰ã§ã®æ°¸ç¶šåŒ–ï¼ˆlocalStorageã§ä»£æ›¿ï¼‰

### åˆ¶ç´„

1. **æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯**: SvelteKit + TypeScript + Vanilla CSS
2. **ãƒ‡ãƒ—ãƒ­ã‚¤**: GitHub Pagesï¼ˆPhase 1-2ï¼‰â†’ Vercelï¼ˆPhase 3ï¼‰
3. **AI API**: Gemini API ã‚’ä½¿ç”¨
4. **é€£æºãƒ—ãƒ­ãƒˆã‚³ãƒ«**: `integration.ts` ã§å®šç¾©ã•ã‚ŒãŸå‹ã‚’å³å®ˆ

---

## ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Spec-Flow Studio                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ Spec Editor â”‚  â”‚ AI Generator â”‚  â”‚ Artifact Viewer    â”‚ â”‚
â”‚  â”‚ (Desired)   â”‚â†’ â”‚ (Gemini)    â”‚â†’ â”‚ (Actual)           â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚         â†‘                                    â†“              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚         Diff Manager (SpecPatch) - Driftæ¤œå‡º           â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                           â†•                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚         Integration Layer (WebSocket)                   â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                           â†•                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â†•
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚    Aether Console      â”‚
              â”‚   (SFé¢¨AIå¸ä»¤å®¤)       â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### çŠ¶æ…‹ç®¡ç†ã®3å±¤ãƒ¢ãƒ‡ãƒ«

| ãƒ¬ã‚¤ãƒ¤ãƒ¼ | èª¬æ˜ | å¯¾å¿œUI |
|---------|------|--------|
| **Desired State** | Spec-Kitï¼ˆYAMLä»•æ§˜ï¼‰ | ã‚¨ãƒ‡ã‚£ã‚¿ |
| **Actual State** | ç”Ÿæˆã•ã‚ŒãŸArtifacts | ãƒ“ãƒ¥ãƒ¼ã‚¢ |
| **Drift** | ä¸¡è€…ã®ä¹–é›¢ãƒ»ãƒ‘ãƒƒãƒå±¥æ­´ | å±¥æ­´ãƒšãƒ¼ã‚¸ |

---

## Phase 1: åŸºç›¤æ§‹ç¯‰ï¼ˆç›®æ¨™: 1é€±é–“ï¼‰

**ç›®æ¨™**: ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆåŸºç›¤ãƒ»ãƒ‡ã‚¶ã‚¤ãƒ³ã‚·ã‚¹ãƒ†ãƒ ãƒ»åŸºæœ¬ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã®å®Œæˆ

### ã‚¿ã‚¹ã‚¯

| # | ã‚¿ã‚¹ã‚¯ | è©³ç´° |
|---|--------|------|
| 1.1 | ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹æˆæ•´ç† | ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ ã€å‹å®šç¾©ã€storesé…ç½® |
| 1.2 | å…±é€šå‹å®šç¾© | `integration.ts` ã‚’ `$lib/types` ã¸ç§»å‹•ãƒ»æ‹¡å¼µ |
| 1.3 | ãƒ‡ã‚¶ã‚¤ãƒ³ã‚·ã‚¹ãƒ†ãƒ  | SFé¢¨CSSå¤‰æ•°ã€å…±é€šã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ |
| 1.4 | åŸºæœ¬ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ | ã‚µã‚¤ãƒ‰ãƒãƒ¼ + ãƒ¡ã‚¤ãƒ³ã‚¨ãƒªã‚¢ + ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒãƒ¼ |
| 1.5 | PWAè¨­å®š | manifest.json, service worker |
| 1.6 | ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚° | `/editor`, `/viewer`, `/history`, `/settings` |
| 1.7 | ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰åˆæœŸè¡¨ç¤º | ç¾åœ¨ã®Specåã€Artifactä¸€è¦§ã€æ¥ç¶šçŠ¶æ…‹ |

### ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆï¼ˆäºˆå®šï¼‰

```
src/
â”œâ”€â”€ lib/
â”‚   â”œâ”€â”€ components/     # å…±é€šã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
â”‚   â”‚   â”œâ”€â”€ ui/         # åŸºæœ¬UI (Button, Panel, etc.)
â”‚   â”‚   â”œâ”€â”€ editor/     # ã‚¨ãƒ‡ã‚£ã‚¿é–¢é€£
â”‚   â”‚   â””â”€â”€ viewer/     # ãƒ“ãƒ¥ãƒ¼ã‚¢é–¢é€£
â”‚   â”œâ”€â”€ stores/         # Svelte stores
â”‚   â”‚   â”œâ”€â”€ spec-store.ts
â”‚   â”‚   â”œâ”€â”€ artifact-store.ts
â”‚   â”‚   â””â”€â”€ integration-store.ts
â”‚   â”œâ”€â”€ types/          # TypeScriptå‹å®šç¾©
â”‚   â”‚   â””â”€â”€ index.ts    # integration.ts ã®å†…å®¹ã‚’å«ã‚€
â”‚   â”œâ”€â”€ services/       # å¤–éƒ¨é€£æº
â”‚   â”‚   â”œâ”€â”€ ai-service.ts
â”‚   â”‚   â””â”€â”€ ws-service.ts
â”‚   â””â”€â”€ utils/          # ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
â”œâ”€â”€ routes/
â”‚   â”œâ”€â”€ +layout.svelte
â”‚   â”œâ”€â”€ +page.svelte    # ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰
â”‚   â”œâ”€â”€ editor/         # Spec-Kit ã‚¨ãƒ‡ã‚£ã‚¿
â”‚   â”œâ”€â”€ viewer/         # ç”Ÿæˆç‰©ãƒ“ãƒ¥ãƒ¼ã‚¢
â”‚   â”œâ”€â”€ history/        # å·®åˆ†å±¥æ­´
â”‚   â””â”€â”€ settings/       # è¨­å®š
â””â”€â”€ app.css             # ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚¹ã‚¿ã‚¤ãƒ«
```

---

## Phase 2: Spec-Kit ã‚¨ãƒ‡ã‚£ã‚¿ï¼ˆç›®æ¨™: 1é€±é–“ï¼‰

**ç›®æ¨™**: YAMLã§ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆä»•æ§˜ã‚’ç·¨é›†ã§ãã‚‹ã‚¨ãƒ‡ã‚£ã‚¿ã®å®Œæˆ

### ã‚¿ã‚¹ã‚¯

| # | ã‚¿ã‚¹ã‚¯ | è©³ç´° |
|---|--------|------|
| 2.1 | YAMLãƒ‘ãƒ¼ã‚µãƒ¼çµ±åˆ | js-yaml + ã‚·ãƒ³ã‚¿ãƒƒã‚¯ã‚¹ãƒã‚¤ãƒ©ã‚¤ãƒˆ |
| 2.2 | ã‚¨ãƒ‡ã‚£ã‚¿UI | CodeMirror or Monaco Editor |
| 2.3 | ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ | Spec-Kitå½¢å¼ã®ã‚¹ã‚­ãƒ¼ãƒæ¤œè¨¼ |
| 2.4 | **åˆ¶ç´„å¯è¦–åŒ–ãƒ‘ãƒãƒ«** | constraints ã‚’åˆ¥ãƒ‘ãƒãƒ«ã§å¼·èª¿è¡¨ç¤º |
| 2.5 | ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ | ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆå®šç¾©ã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ |
| 2.6 | ãƒ­ãƒ¼ã‚«ãƒ«ä¿å­˜ | localStorage ã¸ã®ä¿å­˜ãƒ»èª­è¾¼ |
| 2.7 | ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ | YAML â†’ æ§‹é€ åŒ–ãƒ“ãƒ¥ãƒ¼ |

---

## Phase 3.0: AIç”Ÿæˆã‚¨ãƒ³ã‚¸ãƒ³ãƒ»ã‚³ã‚¢ï¼ˆç›®æ¨™: 1é€±é–“ï¼‰

**ç›®æ¨™**: UIãƒ¢ãƒƒã‚¯ã¨APIä»•æ§˜ã®è‡ªå‹•ç”Ÿæˆ

### ã‚¿ã‚¹ã‚¯

| # | ã‚¿ã‚¹ã‚¯ | è©³ç´° |
|---|--------|------|
| 3.0.1 | Gemini APIçµ±åˆ | APIã‚­ãƒ¼ç®¡ç†ã€ãƒªã‚¯ã‚¨ã‚¹ãƒˆå‡¦ç† |
| 3.0.2 | ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆè¨­è¨ˆï¼ˆã‚³ã‚¢ï¼‰ | UIãƒ¢ãƒƒã‚¯ãƒ»APIä»•æ§˜ç”¨ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ |
| 3.0.3 | UIãƒ¢ãƒƒã‚¯ç”Ÿæˆ | HTML/CSSã‚³ãƒ¼ãƒ‰ç”Ÿæˆ |
| 3.0.4 | APIä»•æ§˜ç”Ÿæˆ | OpenAPIå½¢å¼ã§å‡ºåŠ›ï¼ˆStructured Outputæ´»ç”¨ï¼‰ |
| 3.0.5 | ç”Ÿæˆãƒ­ã‚°ä¿å­˜ | ä½¿ç”¨Specã€ç”Ÿæˆç†ç”±ï¼ˆrationaleï¼‰ã‚’è¨˜éŒ² |

---

## Phase 3.5: AIç”Ÿæˆã‚¨ãƒ³ã‚¸ãƒ³ãƒ»æ‹¡å¼µï¼ˆç›®æ¨™: 1é€±é–“ï¼‰

**ç›®æ¨™**: ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ãƒ»ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹å›³ã®ç”Ÿæˆã¨ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°å¯¾å¿œ

### ã‚¿ã‚¹ã‚¯

| # | ã‚¿ã‚¹ã‚¯ | è©³ç´° |
|---|--------|------|
| 3.5.1 | ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆè¨­è¨ˆï¼ˆæ‹¡å¼µï¼‰ | Testãƒ»UCç”¨ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ |
| 3.5.2 | ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ç”Ÿæˆ | Jest/Vitestå½¢å¼ã§å‡ºåŠ› |
| 3.5.3 | ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹å›³ç”Ÿæˆ | Mermaidå½¢å¼ã§å‡ºåŠ› |
| 3.5.4 | Mermaidãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚° | mermaid.jsçµ±åˆ |
| 3.5.5 | ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°å¯¾å¿œ | ç”Ÿæˆä¸­ã®ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ è¡¨ç¤º |

---

## Phase 4: å·®åˆ†ç®¡ç†ãƒ»é€£æºï¼ˆç›®æ¨™: 2é€±é–“ï¼‰

**ç›®æ¨™**: å·®åˆ†ç®¡ç†ã¨Aether Consoleé€£æº

### ã‚¿ã‚¹ã‚¯

| # | ã‚¿ã‚¹ã‚¯ | è©³ç´° |
|---|--------|------|
| 4.1 | SpecDiffç”Ÿæˆ | ä»•æ§˜å¤‰æ›´ã®å·®åˆ†æ¤œå‡º |
| 4.2 | SpecPatchç®¡ç† | ãƒ‘ãƒƒãƒã®ä½œæˆãƒ»é©ç”¨ãƒ»å±¥æ­´ |
| 4.3 | å·®åˆ†ãƒ“ã‚¸ãƒ¥ã‚¢ãƒ©ã‚¤ã‚º | å¤‰æ›´ç®‡æ‰€ã®ãƒã‚¤ãƒ©ã‚¤ãƒˆè¡¨ç¤º |
| 4.4 | WebSocketå®Ÿè£… | Aether Consoleã¨ã®é€šä¿¡åŸºç›¤ |
| 4.5 | ã‚¤ãƒ™ãƒ³ãƒˆé€å—ä¿¡ | ConsoleToStudioEvent / StudioToConsoleEvent |
| 4.6 | åŒæœŸæ©Ÿèƒ½ | ä»•æ§˜ãƒ»ãƒ‘ãƒƒãƒã®è‡ªå‹•åŒæœŸ |
| 4.7 | **Rollbackæ©Ÿèƒ½** | ä»»æ„ã®SpecPatchã¾ã§ä»•æ§˜ã‚’å·»ãæˆ»ã— |

---

## æˆæœç‰©ä¸€è¦§

| Phase | æˆæœç‰© | èª¬æ˜ |
|-------|--------|------|
| 1 | åŸºæœ¬ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ | SFé¢¨PWAã‚·ã‚§ãƒ« |
| 2 | Spec-Kitã‚¨ãƒ‡ã‚£ã‚¿ | YAMLç·¨é›†UI + åˆ¶ç´„å¯è¦–åŒ– |
| 3.0 | AIç”Ÿæˆï¼ˆã‚³ã‚¢ï¼‰ | UIãƒ¢ãƒƒã‚¯ + APIä»•æ§˜ |
| 3.5 | AIç”Ÿæˆï¼ˆæ‹¡å¼µï¼‰ | Test + UC + ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚° |
| 4 | å·®åˆ†ç®¡ç†ãƒ»é€£æº | Aether Consoleé€£æº + Rollback |

---

## é–¢é€£ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

- [spec-patch-format.md](./spec-patch-format.md) - SpecPatchå½¢å¼ã®å®šç¾©

---

## å¤‰æ›´ææ¡ˆ

ï¼ˆç¾æ™‚ç‚¹ã§ã¯ææ¡ˆãªã—ï¼‰

---

## æ‰¿èªå±¥æ­´

| æ—¥ä»˜ | æ‰¿èªè€… | å†…å®¹ |
|------|--------|------|
| 2026-01-15 | ChatGPT / Gemini | å¤–éƒ¨AIãƒ¬ãƒ“ãƒ¥ãƒ¼å®Œäº†ãƒ»GOåˆ¤æ–­ |
| 2026-01-15 | ãƒ¦ãƒ¼ã‚¶ãƒ¼ | Phaseåˆ†å‰²ãƒ»SpecPatchå½¢å¼ãƒ»AIé™çš„è§£æå»¶æœŸã‚’æ‰¿èª |
</file>

<file path="docs/roadmap.md">
# Aether Console ãƒ­ãƒ¼ãƒ‰ãƒãƒƒãƒ—

## æ¦‚è¦

Aether Consoleã¯SFé¢¨ã®AIã‚ªãƒšãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ«ãƒ¼ãƒ PWAã€‚è¤‡æ•°ã®AIã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚’å¯è¦–åŒ–ãƒ»åˆ¶å¾¡ã—ã€æœ€çµ‚çš„ã«ã¯Spec-Flow Studioã‚’ç›£è¦–ã™ã‚‹ã€‚

## é–‹ç™ºæ–¹é‡

```
Aether Console (å…ˆè¡Œé–‹ç™º)
     â†“
Spec-Kitå½¢å¼ã‚’è¨­è¨ˆãƒ»å…±é€šåŒ–
     â†“
Spec-Flow Studio (å¾Œç¶šé–‹ç™º)
     â†“
ä¸¡è€…é€£æºã§å®Œæˆ
```

---

## Phase 1: ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰å®Œæˆ

**ç›®æ¨™**: SFé¢¨å¸ä»¤å®¤UIã®å®Œæˆã€ãƒ¢ãƒƒã‚¯ãƒ‡ãƒ¼ã‚¿ã§ã®å‹•ä½œç¢ºèª

| ã‚¿ã‚¹ã‚¯ | çŠ¶æ…‹ | è©³ç´° |
|--------|------|------|
| SvelteKitãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆåˆæœŸåŒ– | âœ… | TypeScript, PWAè¨­å®šæ¸ˆã¿ |
| SFé¢¨ãƒ‡ã‚¶ã‚¤ãƒ³ã‚·ã‚¹ãƒ†ãƒ  | âœ… | global.css, Panel, GlitchText, StatusIndicator |
| å¸ä»¤å®¤ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ | â¬œ | è¤‡æ•°ãƒ‘ãƒãƒ«ã®ã‚°ãƒªãƒƒãƒ‰ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ |
| ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆãƒ‘ãƒãƒ« | â¬œ | å„ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã®çŠ¶æ…‹è¡¨ç¤º |
| ã‚³ãƒ³ã‚½ãƒ¼ãƒ«å‡ºåŠ›è¡¨ç¤º | â¬œ | ãƒ­ã‚°/ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®ã‚¹ãƒˆãƒªãƒ¼ãƒ è¡¨ç¤º |
| GitHub Pages ãƒ‡ãƒ—ãƒ­ã‚¤ | â¬œ | adapter-staticè¨­å®š |

**æˆæœç‰©**: é™çš„ãªSFé¢¨ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ï¼ˆãƒ¢ãƒƒã‚¯ãƒ‡ãƒ¼ã‚¿ï¼‰

---

## Phase 2: é™çš„ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³

**ç›®æ¨™**: ã€ŒAIãŒã„ãªãã¦ã‚‚ã€"AIãŒåˆ¶å¾¡ã•ã‚Œã¦ã„ã‚‹æ„Ÿè¦š"ãŒä½“é¨“ã§ãã‚‹ã€

| ã‚¿ã‚¹ã‚¯ | çŠ¶æ…‹ | è©³ç´° |
|--------|------|------|
| Spec-Kitå½¢å¼è¨­è¨ˆ | âœ… | ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆå®šç¾©ã®YAML/JSONå½¢å¼ |
| ãƒ¢ãƒƒã‚¯ã‚·ãƒŠãƒªã‚ªä½œæˆ | â¬œ | äº‹å‰å®šç¾©ã—ãŸä¼šè©±ã‚·ãƒŠãƒªã‚ª |
| ã‚·ãƒŠãƒªã‚ªå†ç”Ÿæ©Ÿèƒ½ | â¬œ | ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³ä¸Šã§ã‚·ãƒŠãƒªã‚ªã‚’å†ç”Ÿ |
| ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆé–“ä¼šè©±è¡¨ç¤º | â¬œ | ä¼šè©±ã®ãƒ“ã‚¸ãƒ¥ã‚¢ãƒ©ã‚¤ã‚º |
| Specå·®åˆ†ã®é©ç”¨ãƒ»å†ç”Ÿ | â¬œ | ä»•æ§˜å¤‰æ›´ã®å³æ™‚åæ˜  |
| å·®åˆ†ã«ã‚ˆã‚‹æŒ™å‹•å¤‰åŒ–ã®å¯è¦–åŒ– | â¬œ | ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆè²¬ä»»å¢ƒç•Œã®å¯è¦–åŒ– |

**æˆæœç‰©**: 
- ã‚·ãƒŠãƒªã‚ªå†ç”Ÿå¯èƒ½ãªãƒ‡ãƒ¢
- Specå·®åˆ† â†’ æŒ™å‹•å¤‰åŒ–ã®å¯è¦–åŒ–
- å°†æ¥ç”Ÿæˆã•ã‚Œã‚‹UI/API/Testã®"äºˆå‘Šè¡¨ç¤º"ï¼ˆSpec-Flow Studioã®"å½±"ï¼‰

---

## Phase 3: AIçµ±åˆ

**ç›®æ¨™**: å®Ÿéš›ã®AI APIã¨æ¥ç¶šã€ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ å‹•ä½œ

| ã‚¿ã‚¹ã‚¯ | çŠ¶æ…‹ | è©³ç´° |
|--------|------|------|
| AIã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆå®Ÿè¡ŒåŸºç›¤ | â¬œ | Gemini/Claude APIé€£æº |
| ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆçŠ¶æ…‹ç®¡ç† | â¬œ | Svelte storeã§ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ çŠ¶æ…‹ç®¡ç† |
| WebSocket/SSEæ¥ç¶š | â¬œ | ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ é€šä¿¡ |
| ææ¡ˆçµ±åˆæ©Ÿèƒ½ | â¬œ | è¤‡æ•°ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆå‡ºåŠ›ã®ã¾ã¨ã‚ |
| Spec-Flow Studioé€£æº | â¬œ | ç›£è¦–å¯¾è±¡ã¨ã®æ¥ç¶š |

**æˆæœç‰©**: å®Ÿéš›ã«AIãŒå‹•ä½œã™ã‚‹å¸ä»¤å®¤

---

## ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆæ§‹æˆï¼ˆäºˆå®šï¼‰

| ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ | å½¹å‰² | ç›£è¦–å¯¾è±¡ |
|-------------|------|---------|
| **Analyzer** | æƒ…å ±è§£æ | å…¥åŠ›ãƒ‡ãƒ¼ã‚¿ã®åˆ†æ |
| **Predictor** | äºˆæ¸¬ | ãƒˆãƒ¬ãƒ³ãƒ‰ãƒ»ãƒªã‚¹ã‚¯äºˆæ¸¬ |
| **Planner** | è¨ˆç”»ç«‹æ¡ˆ | æ¬¡ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ææ¡ˆ |
| **Monitor** | ãƒªã‚¹ã‚¯ç›£è¦– | ç•°å¸¸æ¤œçŸ¥ãƒ»ã‚¢ãƒ©ãƒ¼ãƒˆ |

---

## æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯

| ãƒ¬ã‚¤ãƒ¤ãƒ¼ | æŠ€è¡“ |
|---------|------|
| ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ | SvelteKit + TypeScript |
| ã‚¹ã‚¿ã‚¤ãƒªãƒ³ã‚° | Vanilla CSS |
| PWA | vite-plugin-pwa |
| ãƒ‡ãƒ—ãƒ­ã‚¤ | GitHub Pages â†’ Vercelï¼ˆPhase 3ï¼‰ |
| AI API | Gemini / Claudeï¼ˆPhase 3ï¼‰ |
| é€šä¿¡ | WebSocket / SSEï¼ˆPhase 3ï¼‰ |

---

## ãƒã‚¤ãƒ«ã‚¹ãƒˆãƒ¼ãƒ³

| ãƒã‚¤ãƒ«ã‚¹ãƒˆãƒ¼ãƒ³ | ç›®æ¨™æ—¥ | å†…å®¹ |
|---------------|--------|------|
| M1: UIåŸºç›¤å®Œæˆ | - | Phase 1å®Œäº† |
| M2: ãƒ‡ãƒ¢å¯èƒ½ | - | Phase 2å®Œäº†ã€ã‚·ãƒŠãƒªã‚ªå†ç”Ÿ |
| M3: AIçµ±åˆ | - | Phase 3å®Œäº†ã€ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ å‹•ä½œ |
| M4: Spec-Flowé€£æº | - | Spec-Flow Studioã¨é€£æº |
</file>

<file path="docs/spec-kit-format.md">
# Spec-Kit ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆå®šç¾©å½¢å¼ï¼ˆDraftï¼‰

## æ¦‚è¦

Spec-Kitã¯ã€AIã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã®å½¹å‰²ãƒ»èƒ½åŠ›ãƒ»åˆ¶ç´„ã‚’å®£è¨€çš„ã«å®šç¾©ã™ã‚‹ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã€‚
Aether Consoleã¨Spec-Flow Studioã®ä¸¡æ–¹ã§å…±é€šåˆ©ç”¨ã™ã‚‹ã€‚

---

## åŸºæœ¬æ§‹é€ 

```yaml
# agent.spec.yaml
kind: Agent
version: v1
metadata:
  name: analyzer
  displayName: "Analyzer"
  description: "æƒ…å ±è§£æã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ"
  icon: "ğŸ”"

spec:
  role: |
    å…¥åŠ›ãƒ‡ãƒ¼ã‚¿ã‚’åˆ†æã—ã€æ§‹é€ åŒ–ã•ã‚ŒãŸæƒ…å ±ã‚’æŠ½å‡ºã™ã‚‹ã€‚
    ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚„ç•°å¸¸ã‚’æ¤œå‡ºã—ã€ä»–ã®ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã«å ±å‘Šã™ã‚‹ã€‚

  capabilities:
    - data-analysis
    - pattern-recognition
    - anomaly-detection

  constraints:
    - "æ¨æ¸¬ã§æƒ…å ±ã‚’è£œå®Œã—ãªã„"
    - "ç¢ºä¿¡åº¦ãŒä½ã„å ´åˆã¯æ˜ç¤ºã™ã‚‹"

  inputs:
    - type: text
      description: "åˆ†æå¯¾è±¡ã®ãƒ†ã‚­ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿"
    - type: structured-data
      description: "JSONå½¢å¼ã®æ§‹é€ åŒ–ãƒ‡ãƒ¼ã‚¿"

  outputs:
    - type: analysis-report
      schema:
        findings: string[]
        confidence: number
        anomalies: string[]

  triggers:
    - event: data-received
      action: analyze
    - event: request-from-planner
      action: deep-analyze

  communication:
    canSendTo:
      - predictor
      - planner
      - monitor
    canReceiveFrom:
      - planner
      - monitor

  # Aether Consoleã¸ã®å…¬é–‹è¨­å®š
  observability:
    expose:
      - status
      - progress
      - metrics.errorRate
    logLevel: info
```

---

## ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆé–“é€šä¿¡

```yaml
# message.spec.yaml
kind: Message
version: v1
metadata:
  id: "msg-001"
  from: analyzer
  to: predictor
  timestamp: "2026-01-14T00:30:00Z"

spec:
  type: analysis-complete
  priority: normal
  content:
    summary: "ãƒ‡ãƒ¼ã‚¿åˆ†æå®Œäº†"
    findings:
      - "ãƒˆãƒ©ãƒ•ã‚£ãƒƒã‚¯ãƒ‘ã‚¿ãƒ¼ãƒ³ã«ç•°å¸¸ãªã—"
      - "CPUä½¿ç”¨ç‡ãŒé€šå¸¸ã‚ˆã‚Š20%é«˜ã„"
    confidence: 0.85
    requestPrediction: true
```

---

## ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆçŠ¶æ…‹

```yaml
# state.spec.yaml
kind: AgentState
version: v1
metadata:
  agentName: analyzer
  timestamp: "2026-01-14T00:30:00Z"

spec:
  status: active  # active | idle | warning | error | offline
  currentTask: "analyzing-input-001"
  progress: 0.65
  lastActivity: "2026-01-14T00:29:55Z"
  metrics:
    tasksCompleted: 42
    averageResponseTime: 1.2s
    errorRate: 0.02
```

---

## ã‚·ãƒŠãƒªã‚ªå®šç¾©ï¼ˆPhase 2ç”¨ï¼‰

```yaml
# scenario.spec.yaml
kind: Scenario
version: v1
metadata:
  name: "basic-analysis-flow"
  description: "åŸºæœ¬çš„ãªåˆ†æãƒ•ãƒ­ãƒ¼"

spec:
  steps:
    - time: 0
      action: set-state
      agent: analyzer
      state: { status: idle }

    - time: 1000
      action: set-state
      agent: analyzer
      state: { status: active, currentTask: "analyzing-input" }

    - time: 2000
      action: send-message
      from: analyzer
      to: predictor
      message:
        type: analysis-complete
        content: { summary: "åˆ†æå®Œäº†", confidence: 0.9 }

    - time: 3000
      action: set-state
      agent: predictor
      state: { status: active }

    - time: 5000
      action: console-log
      message: "[Predictor] äºˆæ¸¬ãƒ¢ãƒ‡ãƒ«ã‚’å®Ÿè¡Œä¸­..."
```

---

## è¨­è¨ˆåŸå‰‡

1. **å®£è¨€çš„**: ã€Œä½•ã‚’ã™ã‚‹ã‹ã€ã‚’è¨˜è¿°ã€ã€Œã©ã†ã‚„ã‚‹ã‹ã€ã¯å®Ÿè£…ãŒæ±ºã‚ã‚‹
2. **å‹å®‰å…¨**: ã‚¹ã‚­ãƒ¼ãƒã§input/outputã‚’æ˜ç¢ºåŒ–
3. **ç–çµåˆ**: ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆé–“ã¯ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã§é€šä¿¡
4. **å¯è¦–åŒ–ã—ã‚„ã™ã„**: Aether Consoleã§ã®è¡¨ç¤ºã‚’æ„è­˜ã—ãŸæ§‹é€ 

---

## ä»Šå¾Œã®æ¤œè¨äº‹é …

- [ ] ã‚¹ã‚­ãƒ¼ãƒãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆJSON Schema / Zodï¼‰
- [ ] ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã®ãƒ›ãƒƒãƒˆãƒªãƒ­ãƒ¼ãƒ‰
- [ ] ä¼šè©±å±¥æ­´ã®æ°¸ç¶šåŒ–
- [ ] è¤‡æ•°ã‚·ãƒŠãƒªã‚ªã®åˆ‡ã‚Šæ›¿ãˆ
</file>

<file path="docs/spec-patch-format.md">
# SpecPatch å½¢å¼å®šç¾©

## æ¦‚è¦

SpecPatchã¯ã€Spec-Kitä»•æ§˜ã®å·®åˆ†ã‚’ç®¡ç†ã™ã‚‹ãŸã‚ã®ãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰å½¢å¼ã€‚
æ©Ÿæ¢°çš„ãªå‡¦ç†ã¨äººé–“ãƒ»AIã®ç†è§£ã®ä¸¡æ–¹ã«å¯¾å¿œã™ã‚‹ã€‚

---

## åŸºæœ¬æ§‹é€ 

```yaml
kind: SpecPatch
version: v1
metadata:
  id: patch-001
  name: "æ¨æ¸¬ç¦æ­¢åˆ¶ç´„ã®è¿½åŠ "
  createdAt: 2026-01-15T23:00:00Z
  author: human  # human | ai | system

spec:
  # æ§‹é€ çš„å·®åˆ†ï¼ˆæ©Ÿæ¢°å‡¦ç†ç”¨ï¼‰
  diffs:
    - id: diff-001
      agentName: analyzer
      operation: add        # add | remove | modify
      path: spec.constraints
      before: null
      after: "å¤–éƒ¨ãƒ‡ãƒ¼ã‚¿ã‚’æ¨æ¸¬ã§è£œå®Œã—ãªã„"
      impact: medium        # low | medium | high
  
  # è‡ªç„¶è¨€èªè¦ç´„ï¼ˆäººé–“ãƒ»AIç†è§£ç”¨ï¼‰
  summary: "Analyzerã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã«æ¨æ¸¬ç¦æ­¢ã®åˆ¶ç´„ã‚’è¿½åŠ "
  rationale: "éåº¦ãªæ¨è«–ã«ã‚ˆã‚‹èª¤åˆ†æã‚’é˜²ããŸã‚"
  
  # é©ç”¨çŠ¶æ…‹
  appliedAt: null           # é©ç”¨æ—¥æ™‚ï¼ˆæœªé©ç”¨ã¯nullï¼‰
```

---

## ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰å®šç¾©

### metadata

| ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ | å‹ | å¿…é ˆ | èª¬æ˜ |
|-----------|-----|------|------|
| `id` | string | âœ“ | ãƒ‘ãƒƒãƒã®ä¸€æ„è­˜åˆ¥å­ |
| `name` | string | âœ“ | ãƒ‘ãƒƒãƒã®çŸ­ã„åå‰ |
| `createdAt` | ISO8601 | âœ“ | ä½œæˆæ—¥æ™‚ |
| `author` | enum | âœ“ | ä½œæˆè€…ç¨®åˆ¥ (`human` / `ai` / `system`) |

### spec.diffs[]

| ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ | å‹ | å¿…é ˆ | èª¬æ˜ |
|-----------|-----|------|------|
| `id` | string | âœ“ | å·®åˆ†ã®ä¸€æ„è­˜åˆ¥å­ |
| `agentName` | string | âœ“ | å¯¾è±¡ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆå |
| `operation` | enum | âœ“ | æ“ä½œç¨®åˆ¥ (`add` / `remove` / `modify`) |
| `path` | string | âœ“ | å¤‰æ›´ãƒ‘ã‚¹ï¼ˆJSONPathå½¢å¼ï¼‰ |
| `before` | any | - | å¤‰æ›´å‰ã®å€¤ï¼ˆaddæ™‚ã¯nullï¼‰ |
| `after` | any | - | å¤‰æ›´å¾Œã®å€¤ï¼ˆremoveæ™‚ã¯nullï¼‰ |
| `impact` | enum | âœ“ | å½±éŸ¿åº¦ (`low` / `medium` / `high`) |

### specï¼ˆãƒˆãƒƒãƒ—ãƒ¬ãƒ™ãƒ«ï¼‰

| ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ | å‹ | å¿…é ˆ | èª¬æ˜ |
|-----------|-----|------|------|
| `diffs` | array | âœ“ | å·®åˆ†ã®é…åˆ— |
| `summary` | string | âœ“ | å¤‰æ›´ã®è‡ªç„¶è¨€èªè¦ç´„ |
| `rationale` | string | - | å¤‰æ›´ç†ç”±ï¼ˆãªãœã“ã®å¤‰æ›´ãŒå¿…è¦ã‹ï¼‰ |
| `appliedAt` | ISO8601 | - | é©ç”¨æ—¥æ™‚ï¼ˆæœªé©ç”¨ã¯nullï¼‰ |

---

## æ“ä½œä¾‹

### 1. åˆ¶ç´„ã®è¿½åŠ 

```yaml
diffs:
  - id: diff-001
    agentName: analyzer
    operation: add
    path: spec.constraints
    before: null
    after: "å¤–éƒ¨ãƒ‡ãƒ¼ã‚¿ã‚’æ¨æ¸¬ã§è£œå®Œã—ãªã„"
    impact: medium
```

### 2. èƒ½åŠ›ã®å¤‰æ›´

```yaml
diffs:
  - id: diff-002
    agentName: predictor
    operation: modify
    path: spec.capabilities[0]
    before: "trend-prediction"
    after: "advanced-trend-prediction"
    impact: low
```

### 3. é€šä¿¡å…ˆã®å‰Šé™¤

```yaml
diffs:
  - id: diff-003
    agentName: monitor
    operation: remove
    path: spec.communication.canSendTo[2]
    before: "deprecated-agent"
    after: null
    impact: high
```

---

## TypeScriptå‹å®šç¾©

```typescript
export interface SpecPatch {
  kind: 'SpecPatch';
  version: 'v1';
  metadata: {
    id: string;
    name: string;
    createdAt: string;  // ISO8601
    author: 'human' | 'ai' | 'system';
  };
  spec: {
    diffs: SpecDiff[];
    summary: string;
    rationale?: string;
    appliedAt?: string;  // ISO8601
  };
}

export interface SpecDiff {
  id: string;
  agentName: string;
  operation: 'add' | 'remove' | 'modify';
  path: string;
  before?: unknown;
  after?: unknown;
  impact: 'low' | 'medium' | 'high';
}
```

---

## Aether Consoleé€£æº

### ãƒ‘ãƒƒãƒé©ç”¨ã‚¤ãƒ™ãƒ³ãƒˆ

```typescript
// Console â†’ Studio
{ type: 'PATCH_APPLIED', patch: SpecPatch }

// Studio â†’ Console
{ type: 'PATCH_CREATED', patch: SpecPatch }
```

### Rollback

Rollbackã¯ã€æŒ‡å®šã—ãŸãƒ‘ãƒƒãƒã¾ã§ã®å…¨ãƒ‘ãƒƒãƒã‚’é€†é †ã§ `remove` / `add` ã‚’åè»¢ã—ã¦é©ç”¨ã™ã‚‹ã€‚

---

## è¨­è¨ˆåŸå‰‡

1. **ãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰**: æ§‹é€ diffï¼ˆæ©Ÿæ¢°ç”¨ï¼‰+ è‡ªç„¶è¨€èªï¼ˆäººé–“ãƒ»AIç”¨ï¼‰
2. **è¿½è·¡å¯èƒ½**: èª°ãŒãƒ»ã„ã¤ãƒ»ãªãœå¤‰æ›´ã—ãŸã‹ã‚’è¨˜éŒ²
3. **å¯é€†**: Rollbackã«å¿…è¦ãªæƒ…å ±ã‚’ä¿æŒ
4. **é€£æºå¯¾å¿œ**: Aether Consoleã®ã‚¤ãƒ™ãƒ³ãƒˆå½¢å¼ã¨äº’æ›
</file>

<file path="src/lib/assets/favicon.svg">
<svg xmlns="http://www.w3.org/2000/svg" width="107" height="128" viewBox="0 0 107 128"><title>svelte-logo</title><path d="M94.157 22.819c-10.4-14.885-30.94-19.297-45.792-9.835L22.282 29.608A29.92 29.92 0 0 0 8.764 49.65a31.5 31.5 0 0 0 3.108 20.231 30 30 0 0 0-4.477 11.183 31.9 31.9 0 0 0 5.448 24.116c10.402 14.887 30.942 19.297 45.791 9.835l26.083-16.624A29.92 29.92 0 0 0 98.235 78.35a31.53 31.53 0 0 0-3.105-20.232 30 30 0 0 0 4.474-11.182 31.88 31.88 0 0 0-5.447-24.116" style="fill:#ff3e00"/><path d="M45.817 106.582a20.72 20.72 0 0 1-22.237-8.243 19.17 19.17 0 0 1-3.277-14.503 18 18 0 0 1 .624-2.435l.49-1.498 1.337.981a33.6 33.6 0 0 0 10.203 5.098l.97.294-.09.968a5.85 5.85 0 0 0 1.052 3.878 6.24 6.24 0 0 0 6.695 2.485 5.8 5.8 0 0 0 1.603-.704L69.27 76.28a5.43 5.43 0 0 0 2.45-3.631 5.8 5.8 0 0 0-.987-4.371 6.24 6.24 0 0 0-6.698-2.487 5.7 5.7 0 0 0-1.6.704l-9.953 6.345a19 19 0 0 1-5.296 2.326 20.72 20.72 0 0 1-22.237-8.243 19.17 19.17 0 0 1-3.277-14.502 17.99 17.99 0 0 1 8.13-12.052l26.081-16.623a19 19 0 0 1 5.3-2.329 20.72 20.72 0 0 1 22.237 8.243 19.17 19.17 0 0 1 3.277 14.503 18 18 0 0 1-.624 2.435l-.49 1.498-1.337-.98a33.6 33.6 0 0 0-10.203-5.1l-.97-.294.09-.968a5.86 5.86 0 0 0-1.052-3.878 6.24 6.24 0 0 0-6.696-2.485 5.8 5.8 0 0 0-1.602.704L37.73 51.72a5.42 5.42 0 0 0-2.449 3.63 5.79 5.79 0 0 0 .986 4.372 6.24 6.24 0 0 0 6.698 2.486 5.8 5.8 0 0 0 1.602-.704l9.952-6.342a19 19 0 0 1 5.295-2.328 20.72 20.72 0 0 1 22.237 8.242 19.17 19.17 0 0 1 3.277 14.503 18 18 0 0 1-8.13 12.053l-26.081 16.622a19 19 0 0 1-5.3 2.328" style="fill:#fff"/></svg>
</file>

<file path="src/lib/components/editor/ConstraintPanel.svelte">
<!--
  ConstraintPanel Component
  åˆ¶ç´„äº‹é …ï¼ˆConstraintsï¼‰ã‚’å¯è¦–åŒ–ãƒ»å¼·èª¿è¡¨ç¤ºã™ã‚‹ãƒ‘ãƒãƒ«
-->
<script lang="ts">
	import { Panel } from '$lib/components/ui';
	import type { AgentSpec } from '$lib/types';

	interface Props {
		specs: AgentSpec[];
	}

	let { specs }: Props = $props();

	// å…¨ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã®åˆ¶ç´„ã‚’åé›†
	let allConstraints = $derived(
		specs.flatMap((agent) =>
			agent.constraints.map((constraint) => ({
				agentName: agent.displayName,
				content: constraint
			}))
		)
	);
</script>

<Panel
	title="åˆ¶ç´„äº‹é … (Constraints)"
	variant="warning"
	glow={allConstraints.length > 0}
	class="constraint-panel"
>
	{#if allConstraints.length > 0}
		<div class="constraints-list">
			{#each allConstraints as item}
				<div class="constraint-item">
					<span class="constraint-agent">{item.agentName}</span>
					<span class="constraint-content">{item.content}</span>
				</div>
			{/each}
		</div>
	{:else}
		<div class="empty-constraints">
			<span class="empty-icon">âœ“</span>
			<p>åˆ¶ç´„äº‹é …ã¯å®šç¾©ã•ã‚Œã¦ã„ã¾ã›ã‚“</p>
		</div>
	{/if}
</Panel>

<style>
	.constraint-panel {
		height: 100%;
		overflow: hidden;
		display: flex;
		flex-direction: column;
	}

	.constraints-list {
		display: flex;
		flex-direction: column;
		gap: var(--space-2);
		overflow-y: auto;
		max-height: 200px; /* å¿…è¦ã«å¿œã˜ã¦èª¿æ•´ */
	}

	.constraint-item {
		display: flex;
		align-items: flex-start;
		gap: var(--space-3);
		padding: var(--space-2) var(--space-3);
		background: rgba(245, 158, 11, 0.1); /* Warning color alpha */
		border-left: 3px solid var(--color-accent-warning);
		border-radius: var(--radius-sm);
	}

	.constraint-agent {
		font-size: var(--font-size-xs);
		font-weight: 600;
		color: var(--color-accent-warning);
		background: rgba(0, 0, 0, 0.3);
		padding: 2px 6px;
		border-radius: var(--radius-sm);
		white-space: nowrap;
	}

	.constraint-content {
		font-size: var(--font-size-sm);
		color: var(--color-text-primary);
		line-height: 1.4;
	}

	.empty-constraints {
		display: flex;
		flex-direction: column;
		align-items: center;
		justify-content: center;
		padding: var(--space-4);
		color: var(--color-text-muted);
		gap: var(--space-2);
	}

	.empty-icon {
		font-size: var(--font-size-xl);
		color: var(--color-accent-success);
	}
</style>
</file>

<file path="src/lib/components/editor/index.ts">
export { default as SpecEditor } from './SpecEditor.svelte';
export { default as ConstraintPanel } from './ConstraintPanel.svelte';
</file>

<file path="src/lib/components/editor/SpecEditor.svelte">
<!--
  SpecEditor Component
  CodeMirror 6 ã‚’ä½¿ç”¨ã—ãŸYAMLã‚¨ãƒ‡ã‚£ã‚¿
-->
<script lang="ts">
	import { onMount, onDestroy } from 'svelte';
	import { EditorView, basicSetup } from 'codemirror';
	import { EditorState } from '@codemirror/state';
	import { yaml } from '@codemirror/lang-yaml';
	import { oneDark } from '@codemirror/theme-one-dark';
	import { keymap } from '@codemirror/view';
	import { defaultKeymap } from '@codemirror/commands';

	interface Props {
		value: string;
		readonly?: boolean;
		onChange?: (value: string) => void;
	}

	let { value = $bindable(), readonly = false, onChange }: Props = $props();

	let editorElement: HTMLElement;
	let editorView: EditorView;

	// ã‚¨ãƒ‡ã‚£ã‚¿ã®åˆæœŸåŒ–
	onMount(() => {
		if (!editorElement) return;

		const state = EditorState.create({
			doc: value,
			extensions: [
				basicSetup,
				keymap.of(defaultKeymap),
				yaml(),
				oneDark,
				EditorView.updateListener.of((update) => {
					if (update.docChanged) {
						const newValue = update.state.doc.toString();
						value = newValue; // åŒæ–¹å‘ãƒã‚¤ãƒ³ãƒ‡ã‚£ãƒ³ã‚°æ›´æ–°
						if (onChange) onChange(newValue);
					}
				}),
				EditorView.editable.of(!readonly),
				EditorView.theme({
					'&': { height: '100%', fontSize: '14px' },
					'.cm-scroller': { fontFamily: 'var(--font-mono)' }
				})
			]
		});

		editorView = new EditorView({
			state,
			parent: editorElement
		});
	});

	// props.value ãŒå¤–éƒ¨ã‹ã‚‰å¤‰æ›´ã•ã‚ŒãŸå ´åˆã«ã‚¨ãƒ‡ã‚£ã‚¿ã«åæ˜ 
	// (ã‚¨ãƒ‡ã‚£ã‚¿è‡ªèº«ã®å¤‰æ›´ã«ã‚ˆã‚‹æ›´æ–°ãƒ«ãƒ¼ãƒ—ã‚’é˜²ããŸã‚ã€å†…å®¹ãŒç•°ãªã‚‹å ´åˆã®ã¿æ›´æ–°)
	$effect(() => {
		if (editorView && value !== editorView.state.doc.toString()) {
			editorView.dispatch({
				changes: {
					from: 0,
					to: editorView.state.doc.length,
					insert: value
				}
			});
		}
	});

	onDestroy(() => {
		if (editorView) {
			editorView.destroy();
		}
	});
</script>

<div class="editor-container" bind:this={editorElement}></div>

<style>
	.editor-container {
		width: 100%;
		height: 100%;
		overflow: hidden;
		border-radius: var(--radius-md);
		border: 1px solid var(--color-border-primary);
	}
	
	/* CodeMirrorã®ã‚¹ã‚¿ã‚¤ãƒ«èª¿æ•´ */
	:global(.cm-editor) {
		height: 100%;
	}
	
	:global(.cm-scroller) {
		overflow: auto;
	}
</style>
</file>

<file path="src/lib/components/ui/Button.svelte">
<!--
  Button Component
  SFé¢¨ã®ãƒœã‚¿ãƒ³ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
-->
<script lang="ts">
	import type { Snippet } from 'svelte';
	import type { HTMLButtonAttributes } from 'svelte/elements';

	interface Props extends HTMLButtonAttributes {
		variant?: 'primary' | 'secondary' | 'ghost' | 'danger';
		size?: 'sm' | 'md' | 'lg';
		loading?: boolean;
		children?: Snippet;
	}

	let {
		variant = 'primary',
		size = 'md',
		loading = false,
		disabled,
		children,
		...restProps
	}: Props = $props();
</script>

<button
	class="btn btn--{variant} btn--{size}"
	class:btn--loading={loading}
	disabled={disabled || loading}
	{...restProps}
>
	{#if loading}
		<span class="btn__spinner"></span>
	{/if}
	<span class="btn__content" class:btn__content--hidden={loading}>
		{#if children}
			{@render children()}
		{/if}
	</span>
</button>

<style>
	.btn {
		display: inline-flex;
		align-items: center;
		justify-content: center;
		gap: var(--space-2);
		font-family: var(--font-sans);
		font-weight: 500;
		border: 1px solid transparent;
		border-radius: var(--radius-md);
		cursor: pointer;
		transition: all var(--transition-fast);
		position: relative;
		overflow: hidden;
	}

	.btn:disabled {
		opacity: 0.5;
		cursor: not-allowed;
	}

	/* Sizes */
	.btn--sm {
		padding: var(--space-1) var(--space-3);
		font-size: var(--font-size-xs);
	}

	.btn--md {
		padding: var(--space-2) var(--space-4);
		font-size: var(--font-size-sm);
	}

	.btn--lg {
		padding: var(--space-3) var(--space-6);
		font-size: var(--font-size-base);
	}

	/* Variants */
	.btn--primary {
		background: var(--gradient-primary);
		color: white;
		border-color: var(--color-accent-primary);
	}

	.btn--primary:hover:not(:disabled) {
		box-shadow: var(--shadow-glow);
		transform: translateY(-1px);
	}

	.btn--secondary {
		background: var(--color-bg-tertiary);
		color: var(--color-text-primary);
		border-color: var(--color-border-primary);
	}

	.btn--secondary:hover:not(:disabled) {
		background: var(--color-bg-hover);
		border-color: var(--color-accent-primary);
	}

	.btn--ghost {
		background: transparent;
		color: var(--color-text-secondary);
		border-color: transparent;
	}

	.btn--ghost:hover:not(:disabled) {
		background: var(--color-bg-hover);
		color: var(--color-text-primary);
	}

	.btn--danger {
		background: var(--color-accent-error);
		color: white;
		border-color: var(--color-accent-error);
	}

	.btn--danger:hover:not(:disabled) {
		background: #dc2626;
		box-shadow: 0 0 20px rgba(239, 68, 68, 0.3);
	}

	/* Loading */
	.btn__spinner {
		position: absolute;
		width: 16px;
		height: 16px;
		border: 2px solid transparent;
		border-top-color: currentColor;
		border-radius: 50%;
		animation: spin 0.8s linear infinite;
	}

	.btn__content--hidden {
		visibility: hidden;
	}

	@keyframes spin {
		to {
			transform: rotate(360deg);
		}
	}
</style>
</file>

<file path="src/lib/components/ui/index.ts">
// UI Components
export { default as Panel } from './Panel.svelte';
export { default as Button } from './Button.svelte';
export { default as StatusIndicator } from './StatusIndicator.svelte';
</file>

<file path="src/lib/components/ui/Panel.svelte">
<!--
  Panel Component
  SFé¢¨ã®ãƒ‘ãƒãƒ«ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
-->
<script lang="ts">
	interface Props {
		title?: string;
		variant?: 'default' | 'accent' | 'success' | 'warning' | 'error';
		glow?: boolean;
		class?: string;
		children?: import('svelte').Snippet;
		header?: import('svelte').Snippet;
	}

	let { title, variant = 'default', glow = false, class: className = '', children, header }: Props = $props();

	const variantColors = {
		default: 'var(--color-accent-primary)',
		accent: 'var(--color-accent-secondary)',
		success: 'var(--color-accent-success)',
		warning: 'var(--color-accent-warning)',
		error: 'var(--color-accent-error)'
	};
</script>

<div
	class="panel {className}"
	class:panel--glow={glow}
	style="--panel-accent: {variantColors[variant]}"
>
	{#if title || header}
		<div class="panel__header">
			{#if header}
				{@render header()}
			{:else if title}
				<h3 class="panel__title">{title}</h3>
			{/if}
		</div>
	{/if}
	<div class="panel__content">
		{#if children}
			{@render children()}
		{/if}
	</div>
</div>

<style>
	.panel {
		background: var(--gradient-panel);
		border: 1px solid var(--color-border-primary);
		border-radius: var(--radius-lg);
		overflow: hidden;
		transition: border-color var(--transition-fast), box-shadow var(--transition-fast);
	}

	.panel:hover {
		border-color: var(--panel-accent);
	}

	.panel--glow {
		box-shadow: var(--shadow-glow);
	}

	.panel--glow:hover {
		box-shadow: 0 0 30px rgba(0, 212, 255, 0.4);
	}

	.panel__header {
		padding: var(--space-4) var(--space-5);
		border-bottom: 1px solid var(--color-border-secondary);
		background: rgba(0, 0, 0, 0.2);
	}

	.panel__title {
		font-size: var(--font-size-sm);
		font-weight: 600;
		text-transform: uppercase;
		letter-spacing: 0.05em;
		color: var(--panel-accent);
		margin: 0;
	}

	.panel__content {
		padding: var(--space-5);
	}
</style>
</file>

<file path="src/lib/components/ui/StatusIndicator.svelte">
<!--
  StatusIndicator Component
  æ¥ç¶šçŠ¶æ…‹ãªã©ã‚’ç¤ºã™ã‚¤ãƒ³ã‚¸ã‚±ãƒ¼ã‚¿ãƒ¼
-->
<script lang="ts">
	interface Props {
		status: 'success' | 'warning' | 'error' | 'info' | 'offline';
		label?: string;
		pulse?: boolean;
		size?: 'sm' | 'md' | 'lg';
	}

	let { status, label, pulse = false, size = 'md' }: Props = $props();

	const statusColors = {
		success: 'var(--color-accent-success)',
		warning: 'var(--color-accent-warning)',
		error: 'var(--color-accent-error)',
		info: 'var(--color-accent-primary)',
		offline: 'var(--color-text-muted)'
	};

	const statusLabels = {
		success: 'æ¥ç¶šä¸­',
		warning: 'è­¦å‘Š',
		error: 'ã‚¨ãƒ©ãƒ¼',
		info: 'æƒ…å ±',
		offline: 'ã‚ªãƒ•ãƒ©ã‚¤ãƒ³'
	};
</script>

<div class="status status--{size}" style="--status-color: {statusColors[status]}">
	<span class="status__dot" class:status__dot--pulse={pulse}></span>
	{#if label !== undefined}
		<span class="status__label">{label}</span>
	{:else}
		<span class="status__label">{statusLabels[status]}</span>
	{/if}
</div>

<style>
	.status {
		display: inline-flex;
		align-items: center;
		gap: var(--space-2);
	}

	.status__dot {
		width: 8px;
		height: 8px;
		border-radius: 50%;
		background-color: var(--status-color);
		flex-shrink: 0;
	}

	.status--sm .status__dot {
		width: 6px;
		height: 6px;
	}

	.status--lg .status__dot {
		width: 10px;
		height: 10px;
	}

	.status__dot--pulse {
		animation: pulse-glow 2s ease-in-out infinite;
		box-shadow: 0 0 8px var(--status-color);
	}

	.status__label {
		font-size: var(--font-size-sm);
		color: var(--color-text-secondary);
	}

	.status--sm .status__label {
		font-size: var(--font-size-xs);
	}

	.status--lg .status__label {
		font-size: var(--font-size-base);
	}

	@keyframes pulse-glow {
		0%, 100% {
			opacity: 1;
			box-shadow: 0 0 4px var(--status-color);
		}
		50% {
			opacity: 0.6;
			box-shadow: 0 0 12px var(--status-color);
		}
	}
</style>
</file>

<file path="src/lib/components/Sidebar.svelte">
<!--
  Sidebar Component
  ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ã‚µã‚¤ãƒ‰ãƒãƒ¼
-->
<script lang="ts">
	import { page } from '$app/stores';

	const navItems = [
		{ href: '/', label: 'ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰', icon: 'â—ˆ' },
		{ href: '/editor', label: 'ã‚¨ãƒ‡ã‚£ã‚¿', icon: 'âœ' },
		{ href: '/viewer', label: 'ãƒ“ãƒ¥ãƒ¼ã‚¢', icon: 'â—' },
		{ href: '/history', label: 'å±¥æ­´', icon: 'â§–' },
		{ href: '/settings', label: 'è¨­å®š', icon: 'âš™' }
	];
</script>

<aside class="sidebar">
	<div class="sidebar__logo">
		<span class="sidebar__logo-icon">â—‡</span>
		<span class="sidebar__logo-text">Spec-Flow</span>
	</div>

	<nav class="sidebar__nav">
		{#each navItems as item}
			<a
				href={item.href}
				class="sidebar__link"
				class:sidebar__link--active={$page.url.pathname === item.href}
			>
				<span class="sidebar__link-icon">{item.icon}</span>
				<span class="sidebar__link-label">{item.label}</span>
			</a>
		{/each}
	</nav>

	<div class="sidebar__footer">
		<span class="sidebar__version">v0.1.0</span>
	</div>
</aside>

<style>
	.sidebar {
		position: fixed;
		top: 0;
		left: 0;
		width: var(--sidebar-width);
		height: 100vh;
		background: var(--gradient-panel);
		border-right: 1px solid var(--color-border-primary);
		display: flex;
		flex-direction: column;
		z-index: 100;
	}

	.sidebar__logo {
		padding: var(--space-5);
		display: flex;
		align-items: center;
		gap: var(--space-3);
		border-bottom: 1px solid var(--color-border-secondary);
	}

	.sidebar__logo-icon {
		font-size: var(--font-size-2xl);
		color: var(--color-accent-primary);
		animation: pulse-glow 3s ease-in-out infinite;
	}

	.sidebar__logo-text {
		font-size: var(--font-size-lg);
		font-weight: 600;
		color: var(--color-text-primary);
	}

	.sidebar__nav {
		flex: 1;
		padding: var(--space-4);
		display: flex;
		flex-direction: column;
		gap: var(--space-1);
	}

	.sidebar__link {
		display: flex;
		align-items: center;
		gap: var(--space-3);
		padding: var(--space-3) var(--space-4);
		border-radius: var(--radius-md);
		color: var(--color-text-secondary);
		text-decoration: none;
		transition: all var(--transition-fast);
	}

	.sidebar__link:hover {
		background: var(--color-bg-hover);
		color: var(--color-text-primary);
	}

	.sidebar__link--active {
		background: rgba(0, 212, 255, 0.1);
		color: var(--color-accent-primary);
		border-left: 2px solid var(--color-accent-primary);
	}

	.sidebar__link-icon {
		font-size: var(--font-size-lg);
		width: 24px;
		text-align: center;
	}

	.sidebar__link-label {
		font-size: var(--font-size-sm);
		font-weight: 500;
	}

	.sidebar__footer {
		padding: var(--space-4);
		border-top: 1px solid var(--color-border-secondary);
		text-align: center;
	}

	.sidebar__version {
		font-size: var(--font-size-xs);
		color: var(--color-text-muted);
		font-family: var(--font-mono);
	}

	@keyframes pulse-glow {
		0%, 100% {
			text-shadow: 0 0 5px var(--color-accent-primary);
		}
		50% {
			text-shadow: 0 0 15px var(--color-accent-primary);
		}
	}
</style>
</file>

<file path="src/lib/components/StatusBar.svelte">
<!--
  StatusBar Component
  ç”»é¢ä¸‹éƒ¨ã®ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒãƒ¼
-->
<script lang="ts">
	import { StatusIndicator } from '$lib/components/ui';
	import { connectionStatus } from '$lib/stores/integration-store';
	import { specCount } from '$lib/stores/spec-store';
	import { artifacts } from '$lib/stores/artifact-store';

	// æ¥ç¶šçŠ¶æ…‹ã‚’StatusIndicatorã®statuså½¢å¼ã«å¤‰æ›
	const statusMap = {
		disconnected: 'offline',
		connecting: 'warning',
		connected: 'success',
		error: 'error'
	} as const;

	let currentStatus = $derived(statusMap[$connectionStatus]);
	let artifactCount = $derived($artifacts.length);
</script>

<footer class="statusbar">
	<div class="statusbar__left">
		<StatusIndicator status={currentStatus} size="sm" pulse={$connectionStatus === 'connected'} />
	</div>

	<div class="statusbar__center">
		<span class="statusbar__info">
			<span class="statusbar__label">Specs:</span>
			<span class="statusbar__value">{$specCount}</span>
		</span>
		<span class="statusbar__divider">|</span>
		<span class="statusbar__info">
			<span class="statusbar__label">Artifacts:</span>
			<span class="statusbar__value">{artifactCount}</span>
		</span>
	</div>

	<div class="statusbar__right">
		<span class="statusbar__time font-mono">
			{new Date().toLocaleTimeString('ja-JP', { hour: '2-digit', minute: '2-digit' })}
		</span>
	</div>
</footer>

<style>
	.statusbar {
		position: fixed;
		bottom: 0;
		left: var(--sidebar-width);
		right: 0;
		height: var(--statusbar-height);
		background: var(--color-bg-secondary);
		border-top: 1px solid var(--color-border-primary);
		display: flex;
		align-items: center;
		justify-content: space-between;
		padding: 0 var(--space-4);
		z-index: 100;
	}

	.statusbar__left,
	.statusbar__right {
		display: flex;
		align-items: center;
		gap: var(--space-3);
	}

	.statusbar__center {
		display: flex;
		align-items: center;
		gap: var(--space-3);
	}

	.statusbar__info {
		display: flex;
		align-items: center;
		gap: var(--space-1);
		font-size: var(--font-size-xs);
	}

	.statusbar__label {
		color: var(--color-text-muted);
	}

	.statusbar__value {
		color: var(--color-text-primary);
		font-family: var(--font-mono);
	}

	.statusbar__divider {
		color: var(--color-text-muted);
	}

	.statusbar__time {
		font-size: var(--font-size-xs);
		color: var(--color-text-secondary);
	}
</style>
</file>

<file path="src/lib/server/gemini.ts">
/**
 * Gemini API Server Service
 *
 * Google Gemini API ã¨ã®é€šä¿¡ã‚’æ‹…å½“ã™ã‚‹ã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰ã‚µãƒ¼ãƒ“ã‚¹
 * ãƒªã‚¯ã‚¨ã‚¹ãƒˆã”ã¨ã«APIã‚­ãƒ¼ã¨è¨­å®šã‚’å—ã‘å–ã‚Šã€ç”Ÿæˆã‚’å®Ÿè¡Œã™ã‚‹
 */
import { GoogleGenerativeAI, HarmCategory, HarmBlockThreshold } from '@google/generative-ai';

interface GenerateOptions {
    apiKey: string;
    modelName: string;
    prompt: string;
    temperature?: number;
}

export async function generateContent({ apiKey, modelName, prompt, temperature = 0.7 }: GenerateOptions) {
    try {
        const genAI = new GoogleGenerativeAI(apiKey);
        const model = genAI.getGenerativeModel({
            model: modelName,
            safetySettings: [
                {
                    category: HarmCategory.HARM_CATEGORY_HARASSMENT,
                    threshold: HarmBlockThreshold.BLOCK_MEDIUM_AND_ABOVE,
                },
                {
                    category: HarmCategory.HARM_CATEGORY_HATE_SPEECH,
                    threshold: HarmBlockThreshold.BLOCK_MEDIUM_AND_ABOVE,
                },
                {
                    category: HarmCategory.HARM_CATEGORY_SEXUALLY_EXPLICIT,
                    threshold: HarmBlockThreshold.BLOCK_MEDIUM_AND_ABOVE,
                },
                {
                    category: HarmCategory.HARM_CATEGORY_DANGEROUS_CONTENT,
                    threshold: HarmBlockThreshold.BLOCK_MEDIUM_AND_ABOVE,
                },
            ],
            generationConfig: {
                temperature,
            }
        });

        const result = await model.generateContent(prompt);
        const response = await result.response;
        return response.text();
    } catch (error) {
        console.error('Gemini Generate Error:', error);
        throw error;
    }
}

// ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°å¯¾å¿œç‰ˆ (Phase 3.5ã§æœ¬æ ¼åˆ©ç”¨)
export async function generateContentStream({ apiKey, modelName, prompt, temperature = 0.7 }: GenerateOptions) {
    try {
        const genAI = new GoogleGenerativeAI(apiKey);
        const model = genAI.getGenerativeModel({ model: modelName });

        const result = await model.generateContentStream(prompt);
        return result.stream;
    } catch (error) {
        console.error('Gemini Stream Error:', error);
        throw error;
    }
}

interface ModelInfo {
    name: string; // models/gemini-pro
    displayName: string;
    description: string;
    supportedGenerationMethods: string[];
}

// ãƒ¢ãƒ‡ãƒ«ä¸€è¦§ã‚’å–å¾— (SDKã«æ©Ÿèƒ½ãŒãªã„å ´åˆãŒã‚ã‚‹ãŸã‚REST APIã‚’ä½¿ç”¨)
export async function listModels(apiKey: string): Promise<ModelInfo[]> {
    try {
        // APIã‚­ãƒ¼ã‚’ä½¿ã£ã¦ãƒ¢ãƒ‡ãƒ«ä¸€è¦§ã‚’å–å¾—
        const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models?key=${apiKey}`);

        if (!response.ok) {
            const errorText = await response.text();
            throw new Error(`Failed to fetch models: ${response.status} ${response.statusText} - ${errorText}`);
        }

        const data = await response.json();

        // generateContentã‚’ã‚µãƒãƒ¼ãƒˆã—ã¦ã„ã‚‹ãƒ¢ãƒ‡ãƒ«ã®ã¿ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°
        return (data.models || []).filter((m: any) =>
            m.supportedGenerationMethods && m.supportedGenerationMethods.includes('generateContent')
        ).map((m: any) => ({
            name: m.name.replace('models/', ''), // "models/" ãƒ—ãƒ¬ãƒ•ã‚£ãƒƒã‚¯ã‚¹ã‚’é™¤å»
            displayName: m.displayName,
            description: m.description,
            supportedGenerationMethods: m.supportedGenerationMethods
        }));
    } catch (error) {
        console.error('Gemini List Models Error:', error);
        throw error;
    }
}
</file>

<file path="src/lib/services/websocket.ts">
/**
 * WebSocket Service
 *
 * Aether Console ã¨ã® WebSocket é€šä¿¡ã‚’ç®¡ç†
 */
import { writable, get } from 'svelte/store';
import type {
    ConnectionStatus,
    ConsoleToStudioEvent,
    StudioToConsoleEvent,
    AgentSpec,
    SpecPatch
} from '$lib/types';
import { integrationConfig, updateStatus } from '$lib/stores/integration-store';
import { specs } from '$lib/stores/spec-store';
import { historyStore, patches } from '$lib/stores/history-store';

// æ¥ç¶šçŠ¶æ…‹ã‚¹ãƒˆã‚¢
export const wsStatus = writable<ConnectionStatus>('disconnected');

// å—ä¿¡ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚¹ãƒˆã‚¢ï¼ˆæœ€æ–°ã®ã‚‚ã®ï¼‰
export const lastReceivedEvent = writable<ConsoleToStudioEvent | null>(null);

let ws: WebSocket | null = null;
let reconnectTimer: ReturnType<typeof setTimeout> | null = null;
let reconnectAttempts = 0;
const MAX_RECONNECT_ATTEMPTS = 5;
const RECONNECT_DELAY = 3000;

/**
 * WebSocketæ¥ç¶šã‚’é–‹å§‹
 */
export function connect() {
    const config = get(integrationConfig);
    if (!config.consoleUrl) {
        console.warn('WebSocket URL is not configured');
        return;
    }

    if (ws && (ws.readyState === WebSocket.CONNECTING || ws.readyState === WebSocket.OPEN)) {
        console.log('WebSocket is already connected or connecting');
        return;
    }

    wsStatus.set('connecting');
    updateStatus('connecting');

    try {
        ws = new WebSocket(config.consoleUrl);

        ws.onopen = () => {
            console.log('WebSocket connected to Aether Console');
            wsStatus.set('connected');
            updateStatus('connected');
            reconnectAttempts = 0;
        };

        ws.onmessage = (event) => {
            try {
                const message = JSON.parse(event.data) as ConsoleToStudioEvent;
                handleMessage(message);
            } catch (e) {
                console.error('Failed to parse WebSocket message:', e);
            }
        };

        ws.onerror = (error) => {
            console.error('WebSocket error:', error);
            wsStatus.set('error');
            updateStatus('error');
        };

        ws.onclose = () => {
            console.log('WebSocket closed');
            wsStatus.set('disconnected');
            updateStatus('disconnected');
            ws = null;
            scheduleReconnect();
        };
    } catch (error) {
        console.error('Failed to create WebSocket:', error);
        wsStatus.set('error');
        updateStatus('error');
    }
}

/**
 * å†æ¥ç¶šã‚’ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«
 */
function scheduleReconnect() {
    if (reconnectAttempts >= MAX_RECONNECT_ATTEMPTS) {
        console.log('Max reconnect attempts reached');
        return;
    }

    if (reconnectTimer) {
        clearTimeout(reconnectTimer);
    }

    reconnectTimer = setTimeout(() => {
        reconnectAttempts++;
        console.log(`Reconnecting... (attempt ${reconnectAttempts})`);
        connect();
    }, RECONNECT_DELAY);
}

/**
 * æ¥ç¶šã‚’åˆ‡æ–­
 */
export function disconnect() {
    if (reconnectTimer) {
        clearTimeout(reconnectTimer);
        reconnectTimer = null;
    }

    if (ws) {
        ws.close();
        ws = null;
    }

    wsStatus.set('disconnected');
    updateStatus('disconnected');
}

/**
 * ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’é€ä¿¡
 */
export function send(event: StudioToConsoleEvent) {
    if (!ws || ws.readyState !== WebSocket.OPEN) {
        console.warn('WebSocket is not connected');
        return false;
    }

    try {
        ws.send(JSON.stringify(event));
        return true;
    } catch (e) {
        console.error('Failed to send WebSocket message:', e);
        return false;
    }
}

/**
 * å—ä¿¡ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
 */
function handleMessage(event: ConsoleToStudioEvent) {
    lastReceivedEvent.set(event);

    switch (event.type) {
        case 'SYNC_REQUEST':
            // Consoleã‹ã‚‰ã®åŒæœŸãƒªã‚¯ã‚¨ã‚¹ãƒˆã«å¿œç­”
            const currentSpecs = get(specs);
            const currentPatches = get(patches);
            send({
                type: 'SYNC_RESPONSE',
                agents: currentSpecs,
                patches: currentPatches
            });
            break;

        case 'PATCH_APPLIED':
            // Consoleã§ãƒ‘ãƒƒãƒãŒé©ç”¨ã•ã‚ŒãŸé€šçŸ¥
            console.log('Patch applied on Console:', event.patch.metadata.name);
            // TODO: å¿…è¦ã«å¿œã˜ã¦ãƒ­ãƒ¼ã‚«ãƒ«çŠ¶æ…‹ã‚’æ›´æ–°
            break;

        case 'PATCH_REVERTED':
            // Consoleã§ãƒ‘ãƒƒãƒãŒãƒªãƒãƒ¼ãƒˆã•ã‚ŒãŸé€šçŸ¥
            console.log('Patch reverted on Console:', event.patchId);
            break;

        case 'AGENT_EXECUTED':
            // ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆå®Ÿè¡Œé€šçŸ¥
            console.log(`Agent ${event.agentName} executed`);
            break;

        case 'PROPOSAL_GENERATED':
            // ææ¡ˆç”Ÿæˆé€šçŸ¥
            console.log('Proposal generated:', event.proposal);
            break;

        default:
            console.log('Unknown event type:', event);
    }
}

/**
 * ãƒ‘ãƒƒãƒã‚’Consoleã«é€ä¿¡
 */
export function sendPatch(patch: SpecPatch) {
    return send({
        type: 'PATCH_CREATED',
        patch
    });
}

/**
 * Specæ›´æ–°ã‚’Consoleã«é€ä¿¡
 */
export function sendSpecUpdate(agents: AgentSpec[]) {
    return send({
        type: 'SPEC_UPDATED',
        agents
    });
}
</file>

<file path="src/lib/stores/artifact-store.ts">
/**
 * Artifact Store
 *
 * AIç”Ÿæˆç‰©ã‚’ç®¡ç†ã™ã‚‹ã‚¹ãƒˆã‚¢
 */
import { writable, derived } from 'svelte/store';
import type { Artifact, ArtifactType } from '$lib/types';

// å…¨ã¦ã®ç”Ÿæˆç‰©
export const artifacts = writable<Artifact[]>([]);

// ç”Ÿæˆç‰©ãŒå­˜åœ¨ã™ã‚‹ã‹ã©ã†ã‹
export const hasArtifacts = derived(artifacts, ($artifacts) => $artifacts.length > 0);

// ç¨®é¡åˆ¥ã®ç”Ÿæˆç‰©æ•°
export const artifactCounts = derived(artifacts, ($artifacts) => {
    const counts: Record<ArtifactType, number> = {
        'ui-mock': 0,
        'api-spec': 0,
        'test-case': 0,
        'use-case': 0
    };
    $artifacts.forEach((a) => {
        counts[a.type]++;
    });
    return counts;
});

// æœ€æ–°ã®ç”Ÿæˆç‰©
export const latestArtifacts = derived(artifacts, ($artifacts) =>
    [...$artifacts].sort((a, b) => new Date(b.generatedAt).getTime() - new Date(a.generatedAt).getTime()).slice(0, 5)
);

/**
 * ç”Ÿæˆç‰©ã‚’è¿½åŠ 
 */
export function addArtifact(artifact: Artifact) {
    artifacts.update((current) => [...current, artifact]);
}

/**
 * ç”Ÿæˆç‰©ã‚’å‰Šé™¤
 */
export function removeArtifact(id: string) {
    artifacts.update((current) => current.filter((a) => a.id !== id));
}

/**
 * å…¨ã¦ã®ç”Ÿæˆç‰©ã‚’ã‚¯ãƒªã‚¢
 */
export function clearArtifacts() {
    artifacts.set([]);
}

/**
 * ç¨®é¡ã§ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°
 */
export function getArtifactsByType(type: ArtifactType): Artifact[] {
    let result: Artifact[] = [];
    artifacts.subscribe((a) => {
        result = a.filter((artifact) => artifact.type === type);
    })();
    return result;
}
</file>

<file path="src/lib/stores/history-store.ts">
import { writable, derived, get } from 'svelte/store';
import type { SpecPatch, AgentSpec } from '$lib/types';
import { saveToStorage, loadFromStorage } from '$lib/utils/storage-utils';
import { generateSpecPatch, applySpecPatch, revertSpecPatch, isPatchEmpty } from '$lib/utils/diff-utils';

const STORAGE_KEY = 'spec-flow-studio:history';

interface HistoryState {
    patches: SpecPatch[];
    currentIndex: number; // ç¾åœ¨é©ç”¨ã•ã‚Œã¦ã„ã‚‹ãƒ‘ãƒƒãƒã®ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ (-1 = åˆæœŸçŠ¶æ…‹)
    baseSpecs: AgentSpec[]; // å±¥æ­´ã®èµ·ç‚¹ã¨ãªã‚‹Specs
}

const DEFAULT_STATE: HistoryState = {
    patches: [],
    currentIndex: -1,
    baseSpecs: []
};

function createHistoryStore() {
    const stored = loadFromStorage<HistoryState>(STORAGE_KEY, DEFAULT_STATE);
    const { subscribe, set, update } = writable<HistoryState>(stored);

    // çŠ¶æ…‹ãŒå¤‰æ›´ã•ã‚Œã‚‹ãŸã³ã«æ°¸ç¶šåŒ–
    subscribe((state) => {
        saveToStorage(STORAGE_KEY, state);
    });

    return {
        subscribe,

        /**
         * å±¥æ­´ã®åˆæœŸåŒ–ï¼ˆã‚¨ãƒ‡ã‚£ã‚¿åˆå›ãƒ­ãƒ¼ãƒ‰æ™‚ã«å‘¼ã¶ï¼‰
         */
        initialize: (specs: AgentSpec[]) => {
            update((state) => {
                if (state.patches.length === 0) {
                    return { ...state, baseSpecs: specs };
                }
                return state;
            });
        },

        /**
         * æ–°ã—ã„ãƒ‘ãƒƒãƒã‚’è¨˜éŒ²
         */
        commit: (beforeSpecs: AgentSpec[], afterSpecs: AgentSpec[], name?: string): SpecPatch | null => {
            const patch = generateSpecPatch(beforeSpecs, afterSpecs, { name, author: 'human' });

            if (isPatchEmpty(patch)) {
                return null; // å¤‰æ›´ãªã—
            }

            update((state) => {
                // ç¾åœ¨ä½ç½®ã‚ˆã‚Šå¾Œã®ãƒ‘ãƒƒãƒã‚’ç ´æ£„ï¼ˆãƒ–ãƒ©ãƒ³ãƒã‚’åˆ‡ã‚‰ãªã„ï¼‰
                const newPatches = state.patches.slice(0, state.currentIndex + 1);
                newPatches.push(patch);

                return {
                    ...state,
                    patches: newPatches,
                    currentIndex: newPatches.length - 1
                };
            });

            return patch;
        },

        /**
         * Undo: 1ã¤å‰ã®çŠ¶æ…‹ã«æˆ»ã‚‹
         */
        undo: (): AgentSpec[] | null => {
            const state = get({ subscribe });
            if (state.currentIndex < 0) return null; // ã“ã‚Œä»¥ä¸Šæˆ»ã‚Œãªã„

            const targetIndex = state.currentIndex - 1;
            const specs = rebuildSpecs(state.baseSpecs, state.patches, targetIndex);

            update((s) => ({ ...s, currentIndex: targetIndex }));
            return specs;
        },

        /**
         * Redo: 1ã¤å…ˆã®çŠ¶æ…‹ã«é€²ã‚€
         */
        redo: (): AgentSpec[] | null => {
            const state = get({ subscribe });
            if (state.currentIndex >= state.patches.length - 1) return null; // ã“ã‚Œä»¥ä¸Šé€²ã‚ãªã„

            const targetIndex = state.currentIndex + 1;
            const specs = rebuildSpecs(state.baseSpecs, state.patches, targetIndex);

            update((s) => ({ ...s, currentIndex: targetIndex }));
            return specs;
        },

        /**
         * ç‰¹å®šã®ãƒ‘ãƒƒãƒã¾ã§å·»ãæˆ»ã™
         */
        revertTo: (patchId: string): AgentSpec[] | null => {
            const state = get({ subscribe });
            const targetIndex = state.patches.findIndex((p) => p.metadata.id === patchId);
            if (targetIndex === -1) return null;

            const specs = rebuildSpecs(state.baseSpecs, state.patches, targetIndex);
            update((s) => ({ ...s, currentIndex: targetIndex }));
            return specs;
        },

        /**
         * ç¾åœ¨ã®çŠ¶æ…‹ã‚’å–å¾—
         */
        getCurrentSpecs: (): AgentSpec[] => {
            const state = get({ subscribe });
            return rebuildSpecs(state.baseSpecs, state.patches, state.currentIndex);
        },

        /**
         * å±¥æ­´ã‚’ã‚¯ãƒªã‚¢
         */
        clear: () => {
            set(DEFAULT_STATE);
        }
    };
}

/**
 * baseSpecsã«ãƒ‘ãƒƒãƒã‚’é †ç•ªã«é©ç”¨ã—ã¦targetIndexã¾ã§ã®çŠ¶æ…‹ã‚’å†æ§‹ç¯‰
 */
function rebuildSpecs(baseSpecs: AgentSpec[], patches: SpecPatch[], targetIndex: number): AgentSpec[] {
    let specs = [...baseSpecs];
    for (let i = 0; i <= targetIndex && i < patches.length; i++) {
        specs = applySpecPatch(specs, patches[i]);
    }
    return specs;
}

export const historyStore = createHistoryStore();

// æ´¾ç”Ÿã‚¹ãƒˆã‚¢: Undoå¯èƒ½ã‹ã©ã†ã‹
export const canUndo = derived(historyStore, ($history) => $history.currentIndex >= 0);

// æ´¾ç”Ÿã‚¹ãƒˆã‚¢: Redoå¯èƒ½ã‹ã©ã†ã‹
export const canRedo = derived(
    historyStore,
    ($history) => $history.currentIndex < $history.patches.length - 1
);

// æ´¾ç”Ÿã‚¹ãƒˆã‚¢: ãƒ‘ãƒƒãƒä¸€è¦§
export const patches = derived(historyStore, ($history) => $history.patches);

// æ´¾ç”Ÿã‚¹ãƒˆã‚¢: ç¾åœ¨ã®ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹
export const currentPatchIndex = derived(historyStore, ($history) => $history.currentIndex);
</file>

<file path="src/lib/stores/integration-store.ts">
/**
 * Integration Store
 *
 * Aether Consoleã¨ã®é€£æºçŠ¶æ…‹ã‚’ç®¡ç†ã™ã‚‹ã‚¹ãƒˆã‚¢
 */
import { writable, derived } from 'svelte/store';
import type { ConnectionStatus, IntegrationConfig, SpecPatch } from '$lib/types';
import { DEFAULT_INTEGRATION_CONFIG } from '$lib/types';

// æ¥ç¶šçŠ¶æ…‹
export const connectionStatus = writable<ConnectionStatus>('disconnected');

// é€£æºè¨­å®š
export const integrationConfig = writable<IntegrationConfig>(DEFAULT_INTEGRATION_CONFIG);

// ãƒ‘ãƒƒãƒå±¥æ­´
export const patches = writable<SpecPatch[]>([]);

// æ¥ç¶šä¸­ã‹ã©ã†ã‹
export const isConnected = derived(connectionStatus, ($status) => $status === 'connected');

// æ¥ç¶šä¸­ï¼ˆè©¦è¡Œä¸­ï¼‰ã‹ã©ã†ã‹
export const isConnecting = derived(connectionStatus, ($status) => $status === 'connecting');

// ã‚¨ãƒ©ãƒ¼çŠ¶æ…‹ã‹ã©ã†ã‹
export const hasError = derived(connectionStatus, ($status) => $status === 'error');

// ãƒ‘ãƒƒãƒæ•°
export const patchCount = derived(patches, ($patches) => $patches.length);

// é©ç”¨æ¸ˆã¿ãƒ‘ãƒƒãƒ
export const appliedPatches = derived(patches, ($patches) =>
    $patches.filter((p) => p.spec.appliedAt !== undefined)
);

/**
 * æ¥ç¶šçŠ¶æ…‹ã‚’æ›´æ–°
 */
export function setConnectionStatus(status: ConnectionStatus) {
    connectionStatus.set(status);
}

/**
 * è¨­å®šã‚’æ›´æ–°
 */
export function updateConfig(updates: Partial<IntegrationConfig>) {
    integrationConfig.update((current) => ({ ...current, ...updates }));
}

/**
 * ãƒ‘ãƒƒãƒã‚’è¿½åŠ 
 */
export function addPatch(patch: SpecPatch) {
    patches.update((current) => [...current, patch]);
}

/**
 * ãƒ‘ãƒƒãƒã‚’é©ç”¨æ¸ˆã¿ã«ã™ã‚‹
 */
export function applyPatch(patchId: string) {
    patches.update((current) =>
        current.map((p) =>
            p.metadata.id === patchId
                ? { ...p, spec: { ...p.spec, appliedAt: new Date().toISOString() } }
                : p
        )
    );
}

/**
 * ãƒ‘ãƒƒãƒã‚’å‰Šé™¤
 */
export function removePatch(patchId: string) {
    patches.update((current) => current.filter((p) => p.metadata.id !== patchId));
}

/**
 * å…¨ã¦ã®ãƒ‘ãƒƒãƒã‚’ã‚¯ãƒªã‚¢
 */
export function clearPatches() {
    patches.set([]);
}
</file>

<file path="src/lib/stores/session-store.ts">
import { writable } from 'svelte/store';

interface SessionState {
    encryptionPassword: string | null;
}

const initialState: SessionState = {
    encryptionPassword: null
};

function createSessionStore() {
    const { subscribe, set, update } = writable<SessionState>(initialState);

    return {
        subscribe,
        setPassword: (password: string) => update((s) => ({ ...s, encryptionPassword: password })),
        clearPassword: () => update((s) => ({ ...s, encryptionPassword: null })),
        reset: () => set(initialState)
    };
}

export const session = createSessionStore();
</file>

<file path="src/lib/stores/settings-store.ts">
import { writable } from 'svelte/store';
import { saveToStorage, loadFromStorage, STORAGE_KEYS } from '$lib/utils/storage-utils';

export interface Settings {
    // Gemini API
    geminiModel: string;
    hasApiKey: boolean;
    availableModels: string[]; // åˆ©ç”¨å¯èƒ½ãªãƒ¢ãƒ‡ãƒ«åã®ãƒªã‚¹ãƒˆ
}

const DEFAULT_SETTINGS: Settings = {
    geminiModel: 'gemini-2.0-flash-exp', // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯
    hasApiKey: false,
    availableModels: [
        'gemini-2.0-flash-exp',
        'gemini-1.5-pro',
        'gemini-1.5-flash',
        'gemini-1.0-pro'
    ] // åˆæœŸãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ãƒªã‚¹ãƒˆ
};

function createSettingsStore() {
    const stored = loadFromStorage<Settings>(STORAGE_KEYS.SETTINGS, DEFAULT_SETTINGS);

    // ä»¥å‰ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã¨ã®äº’æ›æ€§ç¢ºä¿ï¼ˆavailableModelsãŒãªã„å ´åˆãªã©ï¼‰
    const initialValue = {
        ...DEFAULT_SETTINGS,
        ...stored,
        availableModels: stored.availableModels?.length > 0 ? stored.availableModels : DEFAULT_SETTINGS.availableModels
    };

    const { subscribe, set, update } = writable<Settings>(initialValue);

    return {
        subscribe,
        updateSettings: (newSettings: Partial<Settings>) => {
            update(current => {
                const updated = { ...current, ...newSettings };
                saveToStorage(STORAGE_KEYS.SETTINGS, updated);
                return updated;
            });
        },
        reset: () => {
            set(DEFAULT_SETTINGS);
            saveToStorage(STORAGE_KEYS.SETTINGS, DEFAULT_SETTINGS);
        }
    };
}

export const settings = createSettingsStore();
</file>

<file path="src/lib/stores/spec-store.ts">
/**
 * Spec Store
 *
 * ç¾åœ¨ç·¨é›†ä¸­ã®Spec-Kitä»•æ§˜ã‚’ç®¡ç†ã™ã‚‹ã‚¹ãƒˆã‚¢
 */
import { writable, derived } from 'svelte/store';
import type { AgentSpec } from '$lib/types';

// ç¾åœ¨ã®Specä¸€è¦§
export const specs = writable<AgentSpec[]>([]);

// ç¾åœ¨ã®Specåï¼ˆãƒ•ã‚¡ã‚¤ãƒ«åãªã©ï¼‰
export const currentSpecName = writable<string | null>(null);

// SpecãŒå­˜åœ¨ã™ã‚‹ã‹ã©ã†ã‹
export const hasSpec = derived(specs, ($specs) => $specs.length > 0);

// Specæ•°
export const specCount = derived(specs, ($specs) => $specs.length);

/**
 * Specã‚’è¨­å®š
 */
export function setSpecs(newSpecs: AgentSpec[], name?: string) {
    specs.set(newSpecs);
    if (name) {
        currentSpecName.set(name);
    }
}

/**
 * Specã‚’ã‚¯ãƒªã‚¢
 */
export function clearSpecs() {
    specs.set([]);
    currentSpecName.set(null);
}

/**
 * å˜ä¸€ã®ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚’è¿½åŠ 
 */
export function addAgent(agent: AgentSpec) {
    specs.update((current) => [...current, agent]);
}

/**
 * ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚’æ›´æ–°
 */
export function updateAgent(name: string, updates: Partial<AgentSpec>) {
    specs.update((current) =>
        current.map((agent) => (agent.name === name ? { ...agent, ...updates } : agent))
    );
}

/**
 * ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚’å‰Šé™¤
 */
export function removeAgent(name: string) {
    specs.update((current) => current.filter((agent) => agent.name !== name));
}
</file>

<file path="src/lib/types/index.ts">
/**
 * Spec-Flow Studio Type Definitions
 *
 * Aether Consoleã¨Spec-Flow Studioã®é€£æºç”¨ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹å®šç¾©
 * ãŠã‚ˆã³ Spec-Flow Studio å›ºæœ‰ã®å‹å®šç¾©
 */

// ========================================
// Spec-Kitå½¢å¼ï¼ˆå…±é€šãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«ï¼‰
// ========================================

/**
 * ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆä»•æ§˜
 */
export interface AgentSpec {
    name: string;
    displayName: string;
    role: string;
    capabilities: string[];
    constraints: string[];
    communication: {
        canSendTo: string[];
        canReceiveFrom: string[];
    };
}

/**
 * Specå·®åˆ†ï¼ˆä»•æ§˜å¤‰æ›´ï¼‰
 */
export interface SpecDiff {
    id: string;
    agentName: string;
    operation: 'add' | 'remove' | 'modify';
    path: string;
    before?: unknown;
    after?: unknown;
    impact: 'low' | 'medium' | 'high';
}

/**
 * ãƒ‘ãƒƒãƒï¼ˆå·®åˆ†ã®é›†åˆï¼‰- ãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰å½¢å¼
 */
export interface SpecPatch {
    kind: 'SpecPatch';
    version: 'v1';
    metadata: {
        id: string;
        name: string;
        createdAt: string; // ISO8601
        author: 'human' | 'ai' | 'system';
    };
    spec: {
        diffs: SpecDiff[];
        summary: string;
        rationale?: string;
        appliedAt?: string; // ISO8601
    };
}

// ========================================
// é€£æºã‚¤ãƒ™ãƒ³ãƒˆ
// ========================================

/**
 * ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆå®Ÿè¡Œçµæœã®æ¦‚è¦
 */
export interface AgentResultSummary {
    agentName: string;
    displayName: string;
    status: 'completed' | 'error';
    responseSummary: string;
}

/**
 * ã‚·ãƒŠãƒªã‚ªã®æ¦‚è¦
 */
export interface ScenarioSummary {
    id: string;
    name: string;
    description: string;
    messageCount: number;
}

/**
 * Aether Console â†’ Spec-Flow Studio
 * ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã‹ã‚‰ã‚¹ã‚¿ã‚¸ã‚ªã¸é€ä¿¡ã™ã‚‹ã‚¤ãƒ™ãƒ³ãƒˆ
 */
export type ConsoleToStudioEvent =
    | { type: 'PATCH_APPLIED'; patch: SpecPatch }
    | { type: 'PATCH_REVERTED'; patchId: string }
    | { type: 'AGENT_EXECUTED'; agentName: string; input: string; output: string }
    | { type: 'PROPOSAL_GENERATED'; proposal: string; agentResults: AgentResultSummary[] }
    | { type: 'SYNC_REQUEST' };

/**
 * Spec-Flow Studio â†’ Aether Console
 * ã‚¹ã‚¿ã‚¸ã‚ªã‹ã‚‰ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã¸é€ä¿¡ã™ã‚‹ã‚¤ãƒ™ãƒ³ãƒˆ
 */
export type StudioToConsoleEvent =
    | { type: 'SPEC_UPDATED'; agents: AgentSpec[] }
    | { type: 'PATCH_CREATED'; patch: SpecPatch }
    | { type: 'SCENARIO_CREATED'; scenario: ScenarioSummary }
    | { type: 'SYNC_RESPONSE'; agents: AgentSpec[]; patches: SpecPatch[] };

// ========================================
// é€£æºè¨­å®š
// ========================================

/**
 * é€£æºæ¥ç¶šè¨­å®š
 */
export interface IntegrationConfig {
    /** Aether Consoleã®WebSocket URL */
    consoleUrl: string;
    /** è‡ªå‹•åŒæœŸã‚’æœ‰åŠ¹ã«ã™ã‚‹ã‹ */
    autoSync: boolean;
    /** åŒæœŸé–“éš”ï¼ˆãƒŸãƒªç§’ï¼‰ */
    syncInterval: number;
}

/**
 * ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®é€£æºè¨­å®š
 */
export const DEFAULT_INTEGRATION_CONFIG: IntegrationConfig = {
    consoleUrl: 'ws://localhost:5173/api/ws',
    autoSync: false,
    syncInterval: 5000
};

// ========================================
// ç”Ÿæˆç‰©ï¼ˆArtifactsï¼‰
// ========================================

/**
 * ç”Ÿæˆç‰©ã®ç¨®é¡
 */
export type ArtifactType = 'ui-mock' | 'api-spec' | 'test-case' | 'use-case-diagram';

/**
 * ç”Ÿæˆç‰©
 */
export interface Artifact {
    id: string;
    type: ArtifactType;
    name: string;
    content: string;
    generatedAt: string; // ISO8601
    sourceSpec: string; // ç”Ÿæˆå…ƒã®Specå
    rationale?: string; // AIã®ç”Ÿæˆç†ç”±
}

// ========================================
// ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³çŠ¶æ…‹
// ========================================

/**
 * æ¥ç¶šçŠ¶æ…‹
 */
export type ConnectionStatus = 'disconnected' | 'connecting' | 'connected' | 'error';

/**
 * ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å…¨ä½“ã®çŠ¶æ…‹
 */
export interface AppState {
    currentSpec: AgentSpec[] | null;
    currentSpecName: string | null;
    artifacts: Artifact[];
    patches: SpecPatch[];
    connectionStatus: ConnectionStatus;
}
</file>

<file path="src/lib/utils/crypto-utils.ts">
/**
 * Crypto Utils
 *
 * Web Crypto API ã‚’ä½¿ç”¨ã—ãŸAES-GCMæš—å·åŒ–ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
 */

const ALGORITHM = 'AES-GCM';
const KEY_LENGTH = 256;
const SALT_LENGTH = 16;
const IV_LENGTH = 12;
const ITERATIONS = 100000;

/**
 * ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‹ã‚‰æš—å·åŒ–ã‚­ãƒ¼ã‚’ç”Ÿæˆï¼ˆPBKDF2ï¼‰
 */
async function deriveKey(password: string, salt: Uint8Array): Promise<CryptoKey> {
    const enc = new TextEncoder();
    const keyMaterial = await window.crypto.subtle.importKey(
        'raw',
        enc.encode(password),
        'PBKDF2',
        false,
        ['deriveKey']
    );

    return window.crypto.subtle.deriveKey(
        {
            name: 'PBKDF2',
            salt,
            iterations: ITERATIONS,
            hash: 'SHA-256'
        },
        keyMaterial,
        { name: ALGORITHM, length: KEY_LENGTH },
        false,
        ['encrypt', 'decrypt']
    );
}

/**
 * ãƒ‡ãƒ¼ã‚¿ã‚’æš—å·åŒ–
 * @returns {salt, iv, data} Base64ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã•ã‚ŒãŸæ–‡å­—åˆ—
 */
export async function encryptData(text: string, password: string): Promise<string> {
    const salt = window.crypto.getRandomValues(new Uint8Array(SALT_LENGTH));
    const iv = window.crypto.getRandomValues(new Uint8Array(IV_LENGTH));
    const key = await deriveKey(password, salt);
    const enc = new TextEncoder();

    const encrypted = await window.crypto.subtle.encrypt(
        { name: ALGORITHM, iv },
        key,
        enc.encode(text)
    );

    // salt + iv + encrypted data ã‚’çµåˆã—ã¦Base64åŒ–
    const combined = new Uint8Array(salt.length + iv.length + encrypted.byteLength);
    combined.set(salt, 0);
    combined.set(iv, salt.length);
    combined.set(new Uint8Array(encrypted), salt.length + iv.length);

    return btoa(String.fromCharCode(...combined));
}

/**
 * ãƒ‡ãƒ¼ã‚¿ã‚’å¾©å·åŒ–
 */
export async function decryptData(encryptedBase64: string, password: string): Promise<string> {
    try {
        const combined = new Uint8Array(
            atob(encryptedBase64)
                .split('')
                .map((c) => c.charCodeAt(0))
        );

        const salt = combined.slice(0, SALT_LENGTH);
        const iv = combined.slice(SALT_LENGTH, SALT_LENGTH + IV_LENGTH);
        const data = combined.slice(SALT_LENGTH + IV_LENGTH);

        const key = await deriveKey(password, salt);

        const decrypted = await window.crypto.subtle.decrypt(
            { name: ALGORITHM, iv },
            key,
            data
        );

        return new TextDecoder().decode(decrypted);
    } catch (error) {
        console.error('Decryption failed:', error);
        throw new Error('ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒé–“é•ã£ã¦ã„ã‚‹ã‹ã€ãƒ‡ãƒ¼ã‚¿ãŒç ´æã—ã¦ã„ã¾ã™');
    }
}

/**
 * APIã‚­ãƒ¼ãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèªã™ã‚‹ãŸã‚ã®ãƒãƒƒã‚·ãƒ¥ç”Ÿæˆ
 */
export async function hashKey(text: string): Promise<string> {
    const enc = new TextEncoder();
    const hash = await window.crypto.subtle.digest('SHA-256', enc.encode(text));
    return btoa(String.fromCharCode(...new Uint8Array(hash)));
}
</file>

<file path="src/lib/utils/diff-utils.ts">
/**
 * Diff Utils
 *
 * Spec-Kitã®å·®åˆ†æ¤œå‡ºã¨ãƒ‘ãƒƒãƒç”Ÿæˆãƒ»é©ç”¨ãƒ­ã‚¸ãƒƒã‚¯
 */
import type { AgentSpec, SpecDiff, SpecPatch } from '$lib/types';

/**
 * 2ã¤ã®AgentSpecé…åˆ—ã‚’æ¯”è¼ƒã—ã€å·®åˆ†ã‚’æ¤œå‡ºã—ã¦SpecPatchã‚’ç”Ÿæˆ
 */
export function generateSpecPatch(
    before: AgentSpec[],
    after: AgentSpec[],
    options?: { name?: string; author?: 'human' | 'ai' | 'system' }
): SpecPatch {
    const diffs: SpecDiff[] = [];
    const beforeMap = new Map(before.map((s) => [s.name, s]));
    const afterMap = new Map(after.map((s) => [s.name, s]));

    // å‰Šé™¤ã•ã‚ŒãŸã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ
    for (const [name, spec] of beforeMap) {
        if (!afterMap.has(name)) {
            diffs.push({
                id: `diff-${crypto.randomUUID().slice(0, 8)}`,
                agentName: name,
                operation: 'remove',
                path: 'agent',
                before: spec,
                after: undefined,
                impact: 'high'
            });
        }
    }

    // è¿½åŠ ã•ã‚ŒãŸã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ
    for (const [name, spec] of afterMap) {
        if (!beforeMap.has(name)) {
            diffs.push({
                id: `diff-${crypto.randomUUID().slice(0, 8)}`,
                agentName: name,
                operation: 'add',
                path: 'agent',
                before: undefined,
                after: spec,
                impact: 'high'
            });
        }
    }

    // å¤‰æ›´ã•ã‚ŒãŸã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ
    for (const [name, afterSpec] of afterMap) {
        const beforeSpec = beforeMap.get(name);
        if (beforeSpec) {
            const fieldDiffs = detectFieldChanges(name, beforeSpec, afterSpec);
            diffs.push(...fieldDiffs);
        }
    }

    // è‡ªç„¶è¨€èªã‚µãƒãƒªãƒ¼ã®ç”Ÿæˆ
    const summary = generateSummary(diffs);

    return {
        kind: 'SpecPatch',
        version: 'v1',
        metadata: {
            id: `patch-${crypto.randomUUID().slice(0, 8)}`,
            name: options?.name || summary.slice(0, 50),
            createdAt: new Date().toISOString(),
            author: options?.author || 'human'
        },
        spec: {
            diffs,
            summary
        }
    };
}

/**
 * ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆå†…ã®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰å¤‰æ›´ã‚’æ¤œå‡º
 */
function detectFieldChanges(agentName: string, before: AgentSpec, after: AgentSpec): SpecDiff[] {
    const diffs: SpecDiff[] = [];

    // role
    if (before.role !== after.role) {
        diffs.push(createDiff(agentName, 'spec.role', before.role, after.role, 'medium'));
    }

    // displayName
    if (before.displayName !== after.displayName) {
        diffs.push(createDiff(agentName, 'spec.displayName', before.displayName, after.displayName, 'low'));
    }

    // constraints (é…åˆ—æ¯”è¼ƒ)
    const constraintDiffs = detectArrayChanges(
        agentName,
        'spec.constraints',
        before.constraints,
        after.constraints,
        'medium' // åˆ¶ç´„å¤‰æ›´ã¯ä¸­ç¨‹åº¦ã®å½±éŸ¿
    );
    diffs.push(...constraintDiffs);

    // capabilities (é…åˆ—æ¯”è¼ƒ)
    const capabilityDiffs = detectArrayChanges(
        agentName,
        'spec.capabilities',
        before.capabilities,
        after.capabilities,
        'low'
    );
    diffs.push(...capabilityDiffs);

    // communication.canSendTo
    const sendToDiffs = detectArrayChanges(
        agentName,
        'spec.communication.canSendTo',
        before.communication.canSendTo,
        after.communication.canSendTo,
        'medium'
    );
    diffs.push(...sendToDiffs);

    // communication.canReceiveFrom
    const receiveFromDiffs = detectArrayChanges(
        agentName,
        'spec.communication.canReceiveFrom',
        before.communication.canReceiveFrom,
        after.communication.canReceiveFrom,
        'medium'
    );
    diffs.push(...receiveFromDiffs);

    return diffs;
}

/**
 * é…åˆ—ã®å¤‰æ›´ã‚’æ¤œå‡º
 */
function detectArrayChanges(
    agentName: string,
    basePath: string,
    before: string[],
    after: string[],
    defaultImpact: 'low' | 'medium' | 'high'
): SpecDiff[] {
    const diffs: SpecDiff[] = [];
    const beforeSet = new Set(before);
    const afterSet = new Set(after);

    // å‰Šé™¤ã•ã‚ŒãŸè¦ç´ 
    for (const item of before) {
        if (!afterSet.has(item)) {
            diffs.push(createDiff(agentName, `${basePath}[]`, item, undefined, defaultImpact, 'remove'));
        }
    }

    // è¿½åŠ ã•ã‚ŒãŸè¦ç´ 
    for (const item of after) {
        if (!beforeSet.has(item)) {
            diffs.push(createDiff(agentName, `${basePath}[]`, undefined, item, defaultImpact, 'add'));
        }
    }

    return diffs;
}

/**
 * SpecDiffã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆ
 */
function createDiff(
    agentName: string,
    path: string,
    before: unknown,
    after: unknown,
    impact: 'low' | 'medium' | 'high',
    operation?: 'add' | 'remove' | 'modify'
): SpecDiff {
    let op: 'add' | 'remove' | 'modify' = operation || 'modify';
    if (!operation) {
        if (before === undefined) op = 'add';
        else if (after === undefined) op = 'remove';
        else op = 'modify';
    }

    return {
        id: `diff-${crypto.randomUUID().slice(0, 8)}`,
        agentName,
        operation: op,
        path,
        before,
        after,
        impact
    };
}

/**
 * å·®åˆ†ã‹ã‚‰è‡ªç„¶è¨€èªã‚µãƒãƒªãƒ¼ã‚’ç”Ÿæˆ
 */
function generateSummary(diffs: SpecDiff[]): string {
    if (diffs.length === 0) return 'å¤‰æ›´ãªã—';

    const parts: string[] = [];
    const agentAdded = diffs.filter((d) => d.path === 'agent' && d.operation === 'add');
    const agentRemoved = diffs.filter((d) => d.path === 'agent' && d.operation === 'remove');
    const fieldChanges = diffs.filter((d) => d.path !== 'agent');

    if (agentAdded.length > 0) {
        parts.push(`${agentAdded.map((d) => d.agentName).join(', ')} ã‚’è¿½åŠ `);
    }
    if (agentRemoved.length > 0) {
        parts.push(`${agentRemoved.map((d) => d.agentName).join(', ')} ã‚’å‰Šé™¤`);
    }
    if (fieldChanges.length > 0) {
        const agents = [...new Set(fieldChanges.map((d) => d.agentName))];
        parts.push(`${agents.join(', ')} ã®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’ ${fieldChanges.length} ä»¶å¤‰æ›´`);
    }

    return parts.join(' / ');
}

/**
 * ãƒ‘ãƒƒãƒã‚’é©ç”¨ã—ã¦AgentSpecé…åˆ—ã‚’æ›´æ–°
 */
export function applySpecPatch(specs: AgentSpec[], patch: SpecPatch): AgentSpec[] {
    let result = [...specs];

    for (const diff of patch.spec.diffs) {
        if (diff.path === 'agent') {
            // ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆå…¨ä½“ã®è¿½åŠ /å‰Šé™¤
            if (diff.operation === 'add' && diff.after) {
                result.push(diff.after as AgentSpec);
            } else if (diff.operation === 'remove') {
                result = result.filter((s) => s.name !== diff.agentName);
            }
        } else {
            // ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãƒ¬ãƒ™ãƒ«ã®å¤‰æ›´
            result = result.map((spec) => {
                if (spec.name !== diff.agentName) return spec;
                return applyFieldDiff(spec, diff);
            });
        }
    }

    return result;
}

/**
 * ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãƒ¬ãƒ™ãƒ«ã®å·®åˆ†ã‚’é©ç”¨
 */
function applyFieldDiff(spec: AgentSpec, diff: SpecDiff): AgentSpec {
    const updated = { ...spec };

    // ãƒ‘ã‚¹ã«åŸºã¥ã„ã¦é©ç”¨
    if (diff.path === 'spec.role') {
        updated.role = diff.after as string;
    } else if (diff.path === 'spec.displayName') {
        updated.displayName = diff.after as string;
    } else if (diff.path === 'spec.constraints[]') {
        updated.constraints = applyArrayDiff(updated.constraints, diff);
    } else if (diff.path === 'spec.capabilities[]') {
        updated.capabilities = applyArrayDiff(updated.capabilities, diff);
    } else if (diff.path === 'spec.communication.canSendTo[]') {
        updated.communication = {
            ...updated.communication,
            canSendTo: applyArrayDiff(updated.communication.canSendTo, diff)
        };
    } else if (diff.path === 'spec.communication.canReceiveFrom[]') {
        updated.communication = {
            ...updated.communication,
            canReceiveFrom: applyArrayDiff(updated.communication.canReceiveFrom, diff)
        };
    }

    return updated;
}

/**
 * é…åˆ—ã¸ã®å·®åˆ†é©ç”¨
 */
function applyArrayDiff(arr: string[], diff: SpecDiff): string[] {
    if (diff.operation === 'add' && diff.after) {
        return [...arr, diff.after as string];
    } else if (diff.operation === 'remove' && diff.before) {
        return arr.filter((item) => item !== diff.before);
    }
    return arr;
}

/**
 * ãƒ‘ãƒƒãƒã‚’é€†é©ç”¨ï¼ˆãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯ç”¨ï¼‰
 */
export function revertSpecPatch(specs: AgentSpec[], patch: SpecPatch): AgentSpec[] {
    // é€†é †ã§ã€æ“ä½œã‚’åè»¢ã—ã¦é©ç”¨
    const reversedDiffs = [...patch.spec.diffs].reverse().map((diff) => ({
        ...diff,
        operation: reverseOperation(diff.operation),
        before: diff.after,
        after: diff.before
    }));

    const reversedPatch: SpecPatch = {
        ...patch,
        spec: {
            ...patch.spec,
            diffs: reversedDiffs
        }
    };

    return applySpecPatch(specs, reversedPatch);
}

function reverseOperation(op: 'add' | 'remove' | 'modify'): 'add' | 'remove' | 'modify' {
    if (op === 'add') return 'remove';
    if (op === 'remove') return 'add';
    return 'modify';
}

/**
 * ãƒ‘ãƒƒãƒãŒç©ºï¼ˆå¤‰æ›´ãªã—ï¼‰ã‹ã©ã†ã‹ã‚’ç¢ºèª
 */
export function isPatchEmpty(patch: SpecPatch): boolean {
    return patch.spec.diffs.length === 0;
}
</file>

<file path="src/lib/utils/prompt-utils.ts">
/**
 * Prompt Utils
 * 
 * Spec-Kitã‹ã‚‰å„ç¨®ã‚¢ãƒ¼ãƒ†ã‚£ãƒ•ã‚¡ã‚¯ãƒˆã‚’ç”Ÿæˆã™ã‚‹ãŸã‚ã®ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ
 */
import type { AgentSpec } from '$lib/types';
import { stringifyYaml } from '$lib/utils/yaml-utils';

/**
 * UI Mockç”Ÿæˆç”¨ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ
 */
export function buildUiPrompt(spec: AgentSpec): string {
    return `Generate a high-quality, modern UI mockup in a single HTML file using Tailwind CSS based on the following agent specification.

# Agent Specification
Role: ${spec.role}
Constraints:
${spec.constraints.map(c => `- ${c}`).join('\n')}

# Requirements for the Output
1. **Single HTML File**: Return ONLY the HTML code. Do not wrap it in markdown block.
2. **Tailwind CSS**: Use CDN <script src="https://cdn.tailwindcss.com"></script>.
3. **Design**: Modern, clean, and responsive design. Use Lucide Icons or similar via CDN if needed.
4. **Content**: The UI should reflect the agent's role and capabilities. Include form inputs if inputs are specified (or inferred from role).
5. **No Explanations**: Output pure HTML code only.

# Capability Context
${spec.capabilities.join(', ')}
`;
}

/**
 * API Spec (OpenAPI) ç”Ÿæˆç”¨ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ
 */
export function buildApiPrompt(spec: AgentSpec): string {
    return `Generate an OpenAPI 3.0 (YAML) specification based on the following agent specification.

# Agent Specification
Name: ${spec.name}
Role: ${spec.role}
Inputs: (Inferred from role)
Outputs: (Inferred from role)

# Requirements for the Output
1. **YAML Only**: Return ONLY the YAML code. Do not wrap it in markdown block.
2. **OpenAPI 3.0**: Use standard OpenAPI 3.0 format.
3. **Paths**: Define endpoints that correspond to the agent's capabilities.
4. **Schemas**: Define request/response schemas based on the inputs/outputs.
5. **No Explanations**: Output pure YAML code only.

# Input YAML
${stringifyYaml(spec)}
`;
}

/**
 * ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ç”Ÿæˆç”¨ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ
 */
export function buildTestCasePrompt(spec: AgentSpec): string {
    return `Generate comprehensive test cases for the following AI agent specification.

# Agent Specification
Name: ${spec.name}
Display Name: ${spec.displayName}
Role: ${spec.role}
Capabilities: ${spec.capabilities.join(', ')}
Constraints: ${spec.constraints.join(', ')}

# Requirements for the Output
1. **Markdown Format**: Return test cases in Markdown format with tables.
2. **Categories**: Include positive tests, negative tests, edge cases, and constraint validation tests.
3. **Structure**: Each test case should have: ID, Category, Description, Input, Expected Output, Priority.
4. **Constraint Tests**: Specifically test that each constraint is enforced.
5. **No Explanations**: Start directly with the test case table.

# Example Format
| ID | Category | Description | Input | Expected Output | Priority |
|----|----------|-------------|-------|-----------------|----------|
| TC-001 | Positive | ... | ... | ... | High |
`;
}

/**
 * ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹å›³(Mermaid)ç”Ÿæˆç”¨ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ
 */
export function buildUseCasePrompt(specs: AgentSpec[]): string {
    const agentList = specs.map(s => `- ${s.displayName}: ${s.role}`).join('\n');

    return `Generate a Mermaid use case diagram based on the following multi-agent system specification.

# Agents
${agentList}

# Communication
${specs.map(s => `${s.name} can send to: ${s.communication.canSendTo.join(', ') || 'none'}`).join('\n')}

# Requirements for the Output
1. **Mermaid Only**: Return ONLY the Mermaid diagram code. Do not wrap it in markdown code block.
2. **Use Case Diagram**: Use Mermaid's flowchart syntax to represent actors and use cases.
3. **Show Relationships**: Show which agents interact with which use cases.
4. **Clean Layout**: Use subgraphs to group related elements.
5. **No Explanations**: Output pure Mermaid code only.

Start with: graph TB
`;
}

/**
 * ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆé–“é€šä¿¡å›³(Mermaid)ç”Ÿæˆ
 * â€» ã“ã‚Œã¯AIç”Ÿæˆã§ã¯ãªãã€Specã‹ã‚‰ç›´æ¥ç”Ÿæˆ
 */
export function buildCommunicationDiagram(specs: AgentSpec[]): string {
    if (specs.length === 0) return 'graph LR\n  NoAgents[No agents defined]';

    const lines: string[] = ['graph LR'];

    // ãƒãƒ¼ãƒ‰å®šç¾©
    specs.forEach(spec => {
        const icon = spec.role.includes('è§£æ') || spec.displayName.includes('Analyzer') ? 'ğŸ”' : 'ğŸ¤–';
        lines.push(`  ${spec.name}["${icon} ${spec.displayName}"]`);
    });

    // é€šä¿¡é–¢ä¿‚
    const validNames = new Set(specs.map(s => s.name));
    specs.forEach(spec => {
        spec.communication.canSendTo.forEach(target => {
            if (validNames.has(target)) {
                lines.push(`  ${spec.name} --> ${target}`);
            }
        });
    });

    return lines.join('\n');
}
</file>

<file path="src/lib/utils/storage-utils.ts">
/**
 * Local Storage Utilities
 *
 * Specã€è¨­å®šãªã©ã®ãƒ­ãƒ¼ã‚«ãƒ«ä¿å­˜ç”¨ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
 */

const STORAGE_KEYS = {
    SPECS: 'spec-flow-studio:specs',
    SPEC_NAME: 'spec-flow-studio:spec-name',
    ARTIFACTS: 'spec-flow-studio:artifacts',
    PATCHES: 'spec-flow-studio:patches',
    SETTINGS: 'spec-flow-studio:settings'
} as const;

/**
 * ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã«ä¿å­˜
 */
export function saveToStorage<T>(key: string, data: T): void {
    try {
        localStorage.setItem(key, JSON.stringify(data));
    } catch (error) {
        console.error('Failed to save to localStorage:', error);
    }
}

/**
 * ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‹ã‚‰èª­ã¿è¾¼ã¿
 */
export function loadFromStorage<T>(key: string, defaultValue: T): T {
    try {
        const item = localStorage.getItem(key);
        if (item === null) {
            return defaultValue;
        }
        return JSON.parse(item) as T;
    } catch (error) {
        console.error('Failed to load from localStorage:', error);
        return defaultValue;
    }
}

/**
 * ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‹ã‚‰å‰Šé™¤
 */
export function removeFromStorage(key: string): void {
    try {
        localStorage.removeItem(key);
    } catch (error) {
        console.error('Failed to remove from localStorage:', error);
    }
}

/**
 * Spec YAMLã‚’ä¿å­˜
 */
export function saveSpecYaml(yaml: string, name?: string): void {
    saveToStorage(STORAGE_KEYS.SPECS, yaml);
    if (name) {
        saveToStorage(STORAGE_KEYS.SPEC_NAME, name);
    }
}

/**
 * Spec YAMLã‚’èª­ã¿è¾¼ã¿
 */
export function loadSpecYaml(): { yaml: string; name: string | null } {
    return {
        yaml: loadFromStorage(STORAGE_KEYS.SPECS, ''),
        name: loadFromStorage<string | null>(STORAGE_KEYS.SPEC_NAME, null)
    };
}

/**
 * å…¨ãƒ‡ãƒ¼ã‚¿ã‚’ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
 */
export function exportAllData(): string {
    const data = {
        specs: loadFromStorage(STORAGE_KEYS.SPECS, ''),
        specName: loadFromStorage(STORAGE_KEYS.SPEC_NAME, null),
        artifacts: loadFromStorage(STORAGE_KEYS.ARTIFACTS, []),
        patches: loadFromStorage(STORAGE_KEYS.PATCHES, []),
        settings: loadFromStorage(STORAGE_KEYS.SETTINGS, {}),
        exportedAt: new Date().toISOString()
    };
    return JSON.stringify(data, null, 2);
}

/**
 * ãƒ‡ãƒ¼ã‚¿ã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆ
 */
export function importAllData(jsonString: string): void {
    try {
        const data = JSON.parse(jsonString);
        if (data.specs) saveToStorage(STORAGE_KEYS.SPECS, data.specs);
        if (data.specName) saveToStorage(STORAGE_KEYS.SPEC_NAME, data.specName);
        if (data.artifacts) saveToStorage(STORAGE_KEYS.ARTIFACTS, data.artifacts);
        if (data.patches) saveToStorage(STORAGE_KEYS.PATCHES, data.patches);
        if (data.settings) saveToStorage(STORAGE_KEYS.SETTINGS, data.settings);
    } catch (error) {
        console.error('Failed to import data:', error);
        throw new Error('Invalid JSON format');
    }
}

/**
 * å…¨ãƒ‡ãƒ¼ã‚¿ã‚’å‰Šé™¤
 */
export function clearAllData(): void {
    Object.values(STORAGE_KEYS).forEach((key) => {
        removeFromStorage(key);
    });
}

export { STORAGE_KEYS };
</file>

<file path="src/lib/utils/yaml-utils.ts">
/**
 * YAML Utilities
 *
 * Spec-Kit YAML ã®ãƒ‘ãƒ¼ã‚¹ãƒ»ã‚·ãƒªã‚¢ãƒ©ã‚¤ã‚ºç”¨ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
 */
import yaml from 'js-yaml';
import type { AgentSpec } from '$lib/types';

/**
 * YAMLæ–‡å­—åˆ—ã‚’AgentSpecã®é…åˆ—ã«ãƒ‘ãƒ¼ã‚¹
 */
export function parseSpecYaml(content: string): AgentSpec[] {
    try {
        const docs = yaml.loadAll(content) as Record<string, unknown>[];
        return docs
            .filter((doc) => doc && doc.kind === 'Agent')
            .map((doc) => convertToAgentSpec(doc));
    } catch (error) {
        console.error('YAML parse error:', error);
        throw new YamlParseError(error instanceof Error ? error.message : 'Unknown parse error');
    }
}

/**
 * å˜ä¸€ã®YAMLãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ãƒ‘ãƒ¼ã‚¹
 */
export function parseYaml<T>(content: string): T {
    try {
        return yaml.load(content) as T;
    } catch (error) {
        console.error('YAML parse error:', error);
        throw new YamlParseError(error instanceof Error ? error.message : 'Unknown parse error');
    }
}

/**
 * ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’YAMLæ–‡å­—åˆ—ã«ã‚·ãƒªã‚¢ãƒ©ã‚¤ã‚º
 */
export function stringifyYaml(obj: unknown): string {
    return yaml.dump(obj, {
        indent: 2,
        lineWidth: 120,
        noRefs: true,
        sortKeys: false
    });
}

/**
 * AgentSpecé…åˆ—ã‚’YAMLæ–‡å­—åˆ—ã«ã‚·ãƒªã‚¢ãƒ©ã‚¤ã‚ºï¼ˆè¤‡æ•°ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆï¼‰
 */
export function stringifySpecs(specs: AgentSpec[]): string {
    return specs.map((spec) => stringifyYaml(convertFromAgentSpec(spec))).join('---\n');
}

/**
 * YAMLãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’AgentSpecã«å¤‰æ›
 */
function convertToAgentSpec(doc: Record<string, unknown>): AgentSpec {
    const metadata = doc.metadata as Record<string, unknown> || {};
    const spec = doc.spec as Record<string, unknown> || {};
    const communication = spec.communication as Record<string, string[]> || {};

    return {
        name: String(metadata.name || ''),
        displayName: String(metadata.displayName || metadata.name || ''),
        role: String(spec.role || ''),
        capabilities: Array.isArray(spec.capabilities) ? spec.capabilities : [],
        constraints: Array.isArray(spec.constraints) ? spec.constraints : [],
        communication: {
            canSendTo: Array.isArray(communication.canSendTo) ? communication.canSendTo : [],
            canReceiveFrom: Array.isArray(communication.canReceiveFrom) ? communication.canReceiveFrom : []
        }
    };
}

/**
 * AgentSpecã‚’YAMLãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆå½¢å¼ã«å¤‰æ›
 */
function convertFromAgentSpec(spec: AgentSpec): Record<string, unknown> {
    return {
        kind: 'Agent',
        version: 'v1',
        metadata: {
            name: spec.name,
            displayName: spec.displayName
        },
        spec: {
            role: spec.role,
            capabilities: spec.capabilities,
            constraints: spec.constraints,
            communication: spec.communication
        }
    };
}

/**
 * YAMLãƒ‘ãƒ¼ã‚¹ã‚¨ãƒ©ãƒ¼
 */
export class YamlParseError extends Error {
    constructor(message: string) {
        super(message);
        this.name = 'YamlParseError';
    }
}

/**
 * YAMLã®æ§‹æ–‡ã‚¨ãƒ©ãƒ¼æƒ…å ±ã‚’å–å¾—
 */
export function getYamlErrors(content: string): YamlError[] {
    const errors: YamlError[] = [];

    try {
        yaml.loadAll(content);
    } catch (error) {
        if (error instanceof yaml.YAMLException) {
            errors.push({
                line: error.mark?.line ?? 0,
                column: error.mark?.column ?? 0,
                message: error.reason || error.message
            });
        }
    }

    return errors;
}

export interface YamlError {
    line: number;
    column: number;
    message: string;
}

/**
 * ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ
 */
export const AGENT_TEMPLATE = `kind: Agent
version: v1
metadata:
  name: new-agent
  displayName: "New Agent"
  description: "ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã®èª¬æ˜"
  icon: "ğŸ¤–"

spec:
  role: |
    ã“ã®ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã®å½¹å‰²ã‚’è¨˜è¿°ã—ã¾ã™ã€‚

  capabilities:
    - capability-1
    - capability-2

  constraints:
    - "åˆ¶ç´„1: ã‚„ã£ã¦ã¯ã„ã‘ãªã„ã“ã¨"
    - "åˆ¶ç´„2: éµå®ˆã™ã¹ããƒ«ãƒ¼ãƒ«"

  inputs:
    - type: text
      description: "å…¥åŠ›ãƒ‡ãƒ¼ã‚¿ã®èª¬æ˜"

  outputs:
    - type: result
      schema:
        summary: string
        confidence: number

  communication:
    canSendTo:
      - other-agent
    canReceiveFrom:
      - other-agent
`;

/**
 * Analyzerã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ
 */
export const ANALYZER_TEMPLATE = `kind: Agent
version: v1
metadata:
  name: analyzer
  displayName: "Analyzer"
  description: "æƒ…å ±è§£æã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ"
  icon: "ğŸ”"

spec:
  role: |
    å…¥åŠ›ãƒ‡ãƒ¼ã‚¿ã‚’åˆ†æã—ã€æ§‹é€ åŒ–ã•ã‚ŒãŸæƒ…å ±ã‚’æŠ½å‡ºã™ã‚‹ã€‚
    ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚„ç•°å¸¸ã‚’æ¤œå‡ºã—ã€ä»–ã®ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã«å ±å‘Šã™ã‚‹ã€‚

  capabilities:
    - data-analysis
    - pattern-recognition
    - anomaly-detection

  constraints:
    - "æ¨æ¸¬ã§æƒ…å ±ã‚’è£œå®Œã—ãªã„"
    - "ç¢ºä¿¡åº¦ãŒä½ã„å ´åˆã¯æ˜ç¤ºã™ã‚‹"
    - "å¤–éƒ¨ãƒ‡ãƒ¼ã‚¿ã‚’æ¨æ¸¬ã§è£œå®Œã—ãªã„"

  communication:
    canSendTo:
      - predictor
      - planner
      - monitor
    canReceiveFrom:
      - planner
      - monitor
`;
</file>

<file path="src/lib/index.ts">
// place files you want to import through the `$lib` alias in this folder.
</file>

<file path="src/routes/api/generate/+server.ts">
import { json } from '@sveltejs/kit';
import type { RequestHandler } from './$types';
import { generateContent } from '$lib/server/gemini';
import { buildUiPrompt, buildApiPrompt, buildTestCasePrompt, buildUseCasePrompt } from '$lib/utils/prompt-utils';
import type { AgentSpec } from '$lib/types';

export const POST: RequestHandler = async ({ request }) => {
    const apiKey = request.headers.get('x-api-key');

    if (!apiKey) {
        return json({ error: 'API Key is required' }, { status: 401 });
    }

    try {
        const { spec, specs, artifactType, model } = await request.json();
        const agentSpec = spec as AgentSpec;
        const agentSpecs = specs as AgentSpec[] | undefined;

        let prompt = '';

        switch (artifactType) {
            case 'ui-mock':
                prompt = buildUiPrompt(agentSpec);
                break;
            case 'api-spec':
                prompt = buildApiPrompt(agentSpec);
                break;
            case 'test-case':
                prompt = buildTestCasePrompt(agentSpec);
                break;
            case 'use-case-diagram':
                if (!agentSpecs || agentSpecs.length === 0) {
                    return json({ error: 'Multiple specs required for use-case diagram' }, { status: 400 });
                }
                prompt = buildUseCasePrompt(agentSpecs);
                break;
            default:
                return json({ error: 'Invalid artifact type' }, { status: 400 });
        }

        const result = await generateContent({
            apiKey,
            modelName: model || 'gemini-2.0-flash-exp',
            prompt
        });

        // ã‚³ãƒ¼ãƒ‰ãƒ–ãƒ­ãƒƒã‚¯ã®é™¤å» (```html ... ``` -> ...)
        let content = result;
        // Markdownã‚³ãƒ¼ãƒ‰ãƒ–ãƒ­ãƒƒã‚¯é™¤å»ã®ç°¡æ˜“æ­£è¦è¡¨ç¾
        const codeBlockRegex = /^```(?:html|yaml|json|markdown|mermaid)?\s*([\s\S]*?)```$/;
        const match = content.match(codeBlockRegex);
        if (match) {
            content = match[1].trim();
        }

        return json({ content });

    } catch (error) {
        console.error('API Error:', error);
        return json({ error: 'Generation failed', details: error instanceof Error ? error.message : String(error) }, { status: 500 });
    }
};
</file>

<file path="src/routes/api/models/+server.ts">
import { json } from '@sveltejs/kit';
import type { RequestHandler } from './$types';
import { listModels } from '$lib/server/gemini';

export const GET: RequestHandler = async ({ request }) => {
    const apiKey = request.headers.get('x-api-key');

    if (!apiKey) {
        return json({ error: 'API Key is required' }, { status: 401 });
    }

    try {
        const models = await listModels(apiKey);
        return json({ models });
    } catch (error) {
        console.error('Model List API Error:', error);
        return json({ error: 'Failed to fetch models', details: error instanceof Error ? error.message : String(error) }, { status: 500 });
    }
};
</file>

<file path="src/app.css">
/**
 * Spec-Flow Studio - Global Styles
 * SFé¢¨ãƒ‡ã‚¶ã‚¤ãƒ³ã‚·ã‚¹ãƒ†ãƒ 
 */

/* ========================================
   CSS Variables - Design Tokens
   ======================================== */

:root {
	/* Colors - Dark Theme */
	--color-bg-primary: #0a0a0f;
	--color-bg-secondary: #12121a;
	--color-bg-tertiary: #1a1a25;
	--color-bg-panel: rgba(20, 20, 30, 0.85);
	--color-bg-hover: rgba(40, 40, 60, 0.5);

	/* Accent Colors */
	--color-accent-primary: #00d4ff;
	--color-accent-secondary: #7c3aed;
	--color-accent-success: #10b981;
	--color-accent-warning: #f59e0b;
	--color-accent-error: #ef4444;

	/* Text Colors */
	--color-text-primary: #e5e7eb;
	--color-text-secondary: #9ca3af;
	--color-text-muted: #6b7280;
	--color-text-accent: var(--color-accent-primary);

	/* Border Colors */
	--color-border-primary: rgba(0, 212, 255, 0.2);
	--color-border-secondary: rgba(255, 255, 255, 0.1);
	--color-border-glow: rgba(0, 212, 255, 0.5);

	/* Gradients */
	--gradient-primary: linear-gradient(135deg, var(--color-accent-primary), var(--color-accent-secondary));
	--gradient-panel: linear-gradient(180deg, rgba(20, 20, 30, 0.9) 0%, rgba(10, 10, 15, 0.95) 100%);
	--gradient-glow: radial-gradient(ellipse at center, rgba(0, 212, 255, 0.15) 0%, transparent 70%);

	/* Typography */
	--font-sans: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
	--font-mono: 'JetBrains Mono', 'Fira Code', monospace;

	--font-size-xs: 0.75rem;
	--font-size-sm: 0.875rem;
	--font-size-base: 1rem;
	--font-size-lg: 1.125rem;
	--font-size-xl: 1.25rem;
	--font-size-2xl: 1.5rem;
	--font-size-3xl: 2rem;

	/* Spacing */
	--space-1: 0.25rem;
	--space-2: 0.5rem;
	--space-3: 0.75rem;
	--space-4: 1rem;
	--space-5: 1.25rem;
	--space-6: 1.5rem;
	--space-8: 2rem;
	--space-10: 2.5rem;
	--space-12: 3rem;

	/* Border Radius */
	--radius-sm: 4px;
	--radius-md: 8px;
	--radius-lg: 12px;
	--radius-xl: 16px;

	/* Shadows */
	--shadow-sm: 0 1px 2px rgba(0, 0, 0, 0.3);
	--shadow-md: 0 4px 6px rgba(0, 0, 0, 0.4);
	--shadow-lg: 0 10px 15px rgba(0, 0, 0, 0.5);
	--shadow-glow: 0 0 20px rgba(0, 212, 255, 0.3);

	/* Transitions */
	--transition-fast: 150ms ease;
	--transition-base: 250ms ease;
	--transition-slow: 400ms ease;

	/* Layout */
	--sidebar-width: 240px;
	--header-height: 56px;
	--statusbar-height: 32px;
}

/* ========================================
   Reset & Base Styles
   ======================================== */

*,
*::before,
*::after {
	box-sizing: border-box;
	margin: 0;
	padding: 0;
}

html {
	font-size: 16px;
	-webkit-font-smoothing: antialiased;
	-moz-osx-font-smoothing: grayscale;
}

body {
	font-family: var(--font-sans);
	font-size: var(--font-size-base);
	line-height: 1.6;
	color: var(--color-text-primary);
	background-color: var(--color-bg-primary);
	min-height: 100vh;
	overflow-x: hidden;
}

/* ========================================
   Typography
   ======================================== */

h1, h2, h3, h4, h5, h6 {
	font-weight: 600;
	line-height: 1.3;
	color: var(--color-text-primary);
}

h1 { font-size: var(--font-size-3xl); }
h2 { font-size: var(--font-size-2xl); }
h3 { font-size: var(--font-size-xl); }
h4 { font-size: var(--font-size-lg); }

p {
	color: var(--color-text-secondary);
}

code, pre {
	font-family: var(--font-mono);
	font-size: var(--font-size-sm);
}

a {
	color: var(--color-accent-primary);
	text-decoration: none;
	transition: color var(--transition-fast);
}

a:hover {
	color: var(--color-accent-secondary);
}

/* ========================================
   Utility Classes
   ======================================== */

.text-accent { color: var(--color-accent-primary); }
.text-success { color: var(--color-accent-success); }
.text-warning { color: var(--color-accent-warning); }
.text-error { color: var(--color-accent-error); }
.text-muted { color: var(--color-text-muted); }

.font-mono { font-family: var(--font-mono); }

.sr-only {
	position: absolute;
	width: 1px;
	height: 1px;
	padding: 0;
	margin: -1px;
	overflow: hidden;
	clip: rect(0, 0, 0, 0);
	white-space: nowrap;
	border: 0;
}

/* ========================================
   Focus States
   ======================================== */

:focus-visible {
	outline: 2px solid var(--color-accent-primary);
	outline-offset: 2px;
}

/* ========================================
   Scrollbar
   ======================================== */

::-webkit-scrollbar {
	width: 8px;
	height: 8px;
}

::-webkit-scrollbar-track {
	background: var(--color-bg-secondary);
}

::-webkit-scrollbar-thumb {
	background: var(--color-border-primary);
	border-radius: var(--radius-sm);
}

::-webkit-scrollbar-thumb:hover {
	background: var(--color-accent-primary);
}

/* ========================================
   Animations
   ======================================== */

@keyframes pulse-glow {
	0%, 100% {
		box-shadow: 0 0 5px var(--color-accent-primary);
	}
	50% {
		box-shadow: 0 0 20px var(--color-accent-primary);
	}
}

@keyframes fade-in {
	from {
		opacity: 0;
		transform: translateY(10px);
	}
	to {
		opacity: 1;
		transform: translateY(0);
	}
}

@keyframes slide-in-left {
	from {
		opacity: 0;
		transform: translateX(-20px);
	}
	to {
		opacity: 1;
		transform: translateX(0);
	}
}

.animate-fade-in {
	animation: fade-in var(--transition-base) ease-out;
}

.animate-slide-in {
	animation: slide-in-left var(--transition-base) ease-out;
}
</file>

<file path="src/app.d.ts">
// See https://svelte.dev/docs/kit/types#app.d.ts
// for information about these interfaces
declare global {
	namespace App {
		// interface Error {}
		// interface Locals {}
		// interface PageData {}
		// interface PageState {}
		// interface Platform {}
	}
}

export {};
</file>

<file path="static/favicon.svg">
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32" fill="none">
  <rect width="32" height="32" rx="6" fill="#0a0a0f"/>
  <path d="M16 6L26 16L16 26L6 16L16 6Z" stroke="#00d4ff" stroke-width="2" fill="none"/>
  <circle cx="16" cy="16" r="4" fill="#00d4ff"/>
</svg>
</file>

<file path="static/manifest.json">
{
    "name": "Spec-Flow Studio",
    "short_name": "Spec-Flow",
    "description": "AIãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼å¯è¦–åŒ–ãƒ»åˆ¶å¾¡ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ",
    "start_url": "/",
    "display": "standalone",
    "background_color": "#0a0a0f",
    "theme_color": "#0a0a0f",
    "orientation": "portrait-primary",
    "icons": [
        {
            "src": "/favicon.png",
            "sizes": "192x192",
            "type": "image/png"
        },
        {
            "src": "/favicon.png",
            "sizes": "512x512",
            "type": "image/png"
        }
    ],
    "categories": [
        "productivity",
        "developer tools"
    ]
}
</file>

<file path="static/robots.txt">
# allow crawling everything by default
User-agent: *
Disallow:
</file>

<file path=".gitignore">
node_modules

# Output
.output
.vercel
.netlify
.wrangler
/.svelte-kit
/build

# OS
.DS_Store
Thumbs.db

# Env
.env
.env.*
!.env.example
!.env.test

# Vite
vite.config.js.timestamp-*
vite.config.ts.timestamp-*
</file>

<file path=".npmrc">
engine-strict=true
</file>

<file path=".prettierignore">
# Package Managers
package-lock.json
pnpm-lock.yaml
yarn.lock
bun.lock
bun.lockb

# Miscellaneous
/static/
</file>

<file path=".prettierrc">
{
	"useTabs": true,
	"singleQuote": true,
	"trailingComma": "none",
	"printWidth": 100,
	"plugins": ["prettier-plugin-svelte"],
	"overrides": [
		{
			"files": "*.svelte",
			"options": {
				"parser": "svelte"
			}
		}
	]
}
</file>

<file path="eslint.config.js">
import prettier from 'eslint-config-prettier';
import { fileURLToPath } from 'node:url';
import { includeIgnoreFile } from '@eslint/compat';
import js from '@eslint/js';
import svelte from 'eslint-plugin-svelte';
import { defineConfig } from 'eslint/config';
import globals from 'globals';
import ts from 'typescript-eslint';
import svelteConfig from './svelte.config.js';

const gitignorePath = fileURLToPath(new URL('./.gitignore', import.meta.url));

export default defineConfig(
	includeIgnoreFile(gitignorePath),
	js.configs.recommended,
	...ts.configs.recommended,
	...svelte.configs.recommended,
	prettier,
	...svelte.configs.prettier,
	{
		languageOptions: { globals: { ...globals.browser, ...globals.node } },

		rules: {
			// typescript-eslint strongly recommend that you do not use the no-undef lint rule on TypeScript projects.
			// see: https://typescript-eslint.io/troubleshooting/faqs/eslint/#i-get-errors-from-the-no-undef-rule-about-global-variables-not-being-defined-even-though-there-are-no-typescript-errors
			'no-undef': 'off'
		}
	},
	{
		files: ['**/*.svelte', '**/*.svelte.ts', '**/*.svelte.js'],

		languageOptions: {
			parserOptions: {
				projectService: true,
				extraFileExtensions: ['.svelte'],
				parser: ts.parser,
				svelteConfig
			}
		}
	}
);
</file>

<file path="README.md">
# sv

Everything you need to build a Svelte project, powered by [`sv`](https://github.com/sveltejs/cli).

## Creating a project

If you're seeing this, you've probably already done this step. Congrats!

```sh
# create a new project in the current directory
npx sv create

# create a new project in my-app
npx sv create my-app
```

## Developing

Once you've created a project and installed dependencies with `npm install` (or `pnpm install` or `yarn`), start a development server:

```sh
npm run dev

# or start the server and open the app in a new browser tab
npm run dev -- --open
```

## Building

To create a production version of your app:

```sh
npm run build
```

You can preview the production build with `npm run preview`.

> To deploy your app, you may need to install an [adapter](https://svelte.dev/docs/kit/adapters) for your target environment.
</file>

<file path="svelte.config.js">
import adapter from '@sveltejs/adapter-auto';
import { vitePreprocess } from '@sveltejs/vite-plugin-svelte';

/** @type {import('@sveltejs/kit').Config} */
const config = {
	// Consult https://svelte.dev/docs/kit/integrations
	// for more information about preprocessors
	preprocess: vitePreprocess(),

	kit: {
		// adapter-auto only supports some environments, see https://svelte.dev/docs/kit/adapter-auto for a list.
		// If your environment is not supported, or you settled on a specific environment, switch out the adapter.
		// See https://svelte.dev/docs/kit/adapters for more information about adapters.
		adapter: adapter()
	}
};

export default config;
</file>

<file path="tsconfig.json">
{
	"extends": "./.svelte-kit/tsconfig.json",
	"compilerOptions": {
		"rewriteRelativeImportExtensions": true,
		"allowJs": true,
		"checkJs": true,
		"esModuleInterop": true,
		"forceConsistentCasingInFileNames": true,
		"resolveJsonModule": true,
		"skipLibCheck": true,
		"sourceMap": true,
		"strict": true,
		"moduleResolution": "bundler"
	}
	// Path aliases are handled by https://svelte.dev/docs/kit/configuration#alias
	// except $lib which is handled by https://svelte.dev/docs/kit/configuration#files
	//
	// To make changes to top-level options such as include and exclude, we recommend extending
	// the generated config; see https://svelte.dev/docs/kit/configuration#typescript
}
</file>

<file path="vite.config.ts">
import { sveltekit } from '@sveltejs/kit/vite';
import { defineConfig } from 'vite';

export default defineConfig({
	plugins: [sveltekit()]
});
</file>

<file path="src/routes/history/+page.svelte">
<!--
  History Page
  ãƒ‘ãƒƒãƒå±¥æ­´ã®ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³è¡¨ç¤ºã¨ã‚¿ã‚¤ãƒ ãƒˆãƒ©ãƒ™ãƒ«
-->
<script lang="ts">
	import { Panel, Button } from '$lib/components/ui';
	import {
		historyStore,
		patches,
		currentPatchIndex,
		canUndo,
		canRedo
	} from '$lib/stores/history-store';
	import { specs, setSpecs } from '$lib/stores/spec-store';
	import type { SpecPatch } from '$lib/types';

	// Undo
	function handleUndo() {
		const newSpecs = historyStore.undo();
		if (newSpecs) {
			setSpecs(newSpecs, 'draft-spec');
		}
	}

	// Redo
	function handleRedo() {
		const newSpecs = historyStore.redo();
		if (newSpecs) {
			setSpecs(newSpecs, 'draft-spec');
		}
	}

	// ç‰¹å®šã®ãƒ‘ãƒƒãƒã«ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯
	function handleRevertTo(patchId: string) {
		if (confirm('ã“ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã«æˆ»ã—ã¾ã™ã‹ï¼Ÿç¾åœ¨ã®å¤‰æ›´ã¯å¤±ã‚ã‚Œã¾ã™ã€‚')) {
			const newSpecs = historyStore.revertTo(patchId);
			if (newSpecs) {
				setSpecs(newSpecs, 'draft-spec');
			}
		}
	}

	// å½±éŸ¿åº¦ã«å¿œã˜ãŸè‰²
	function getImpactColor(impact: 'low' | 'medium' | 'high'): string {
		switch (impact) {
			case 'high':
				return 'var(--color-accent-error)';
			case 'medium':
				return 'var(--color-accent-warning)';
			default:
				return 'var(--color-accent-success)';
		}
	}

	// æ“ä½œã«å¿œã˜ãŸã‚¢ã‚¤ã‚³ãƒ³
	function getOperationIcon(op: 'add' | 'remove' | 'modify'): string {
		switch (op) {
			case 'add':
				return '+';
			case 'remove':
				return 'âˆ’';
			default:
				return '~';
		}
	}
</script>

<div class="history-page">
	<header class="page-header">
		<div class="header-left">
			<h1>å±¥æ­´</h1>
			<span class="patch-count">{$patches.length} ãƒ‘ãƒƒãƒ</span>
		</div>
		<div class="header-right">
			<Button variant="secondary" size="sm" onclick={handleUndo} disabled={!$canUndo}>
				â†¶ å…ƒã«æˆ»ã™
			</Button>
			<Button variant="secondary" size="sm" onclick={handleRedo} disabled={!$canRedo}>
				ã‚„ã‚Šç›´ã™ â†·
			</Button>
		</div>
	</header>

	<div class="history-content">
		{#if $patches.length === 0}
			<Panel>
				<div class="empty-state">
					<p>å±¥æ­´ãŒã‚ã‚Šã¾ã›ã‚“</p>
					<p class="text-muted">
						ã‚¨ãƒ‡ã‚£ã‚¿ã§å¤‰æ›´ã‚’åŠ ãˆã¦ã€Œã‚³ãƒŸãƒƒãƒˆã€ã™ã‚‹ã¨ã€ã“ã“ã«å±¥æ­´ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚
					</p>
				</div>
			</Panel>
		{:else}
			<div class="timeline">
				{#each $patches as patch, index}
					<div class="timeline-item" class:current={index === $currentPatchIndex}>
						<div class="timeline-marker">
							<div class="marker-dot"></div>
							{#if index < $patches.length - 1}
								<div class="marker-line"></div>
							{/if}
						</div>
						<div class="timeline-content">
							<Panel>
								<div class="patch-header">
									<div class="patch-info">
										<span class="patch-name">{patch.metadata.name}</span>
										<span class="patch-meta">
											{new Date(patch.metadata.createdAt).toLocaleString()} ãƒ» {patch.metadata
												.author}
										</span>
									</div>
									{#if index !== $currentPatchIndex}
										<Button
											variant="ghost"
											size="sm"
											onclick={() => handleRevertTo(patch.metadata.id)}
										>
											æˆ»ã™
										</Button>
									{:else}
										<span class="current-badge">ç¾åœ¨</span>
									{/if}
								</div>

								<p class="patch-summary">{patch.spec.summary}</p>

								{#if patch.spec.rationale}
									<p class="patch-rationale">ç†ç”±: {patch.spec.rationale}</p>
								{/if}

								<div class="diff-list">
									{#each patch.spec.diffs as diff}
										<div class="diff-item">
											<span class="diff-op" style="color: {getImpactColor(diff.impact)}">
												{getOperationIcon(diff.operation)}
											</span>
											<span class="diff-agent">{diff.agentName}</span>
											<span class="diff-path">{diff.path}</span>
											{#if diff.operation === 'add' && diff.after}
												<span class="diff-value add">"{diff.after}"</span>
											{:else if diff.operation === 'remove' && diff.before}
												<span class="diff-value remove">"{diff.before}"</span>
											{:else if diff.operation === 'modify'}
												<span class="diff-value remove">"{diff.before}"</span>
												â†’
												<span class="diff-value add">"{diff.after}"</span>
											{/if}
										</div>
									{/each}
								</div>
							</Panel>
						</div>
					</div>
				{/each}
			</div>
		{/if}
	</div>
</div>

<style>
	.history-page {
		animation: fade-in var(--transition-base) ease-out;
	}

	.page-header {
		display: flex;
		justify-content: space-between;
		align-items: center;
		margin-bottom: var(--space-6);
	}

	.header-left {
		display: flex;
		align-items: baseline;
		gap: var(--space-3);
	}

	.patch-count {
		font-size: var(--font-size-sm);
		color: var(--color-text-muted);
	}

	.header-right {
		display: flex;
		gap: var(--space-2);
	}

	.empty-state {
		text-align: center;
		padding: var(--space-8);
		color: var(--color-text-secondary);
	}

	.text-muted {
		color: var(--color-text-muted);
		font-size: var(--font-size-sm);
		margin-top: var(--space-2);
	}

	/* Timeline */
	.timeline {
		display: flex;
		flex-direction: column;
		gap: var(--space-4);
	}

	.timeline-item {
		display: flex;
		gap: var(--space-4);
	}

	.timeline-item.current .marker-dot {
		background: var(--color-accent-primary);
		box-shadow: 0 0 8px var(--color-accent-primary);
	}

	.timeline-marker {
		display: flex;
		flex-direction: column;
		align-items: center;
		width: 20px;
		flex-shrink: 0;
	}

	.marker-dot {
		width: 12px;
		height: 12px;
		border-radius: 50%;
		background: var(--color-border-primary);
		border: 2px solid var(--color-bg-secondary);
	}

	.marker-line {
		flex: 1;
		width: 2px;
		background: var(--color-border-secondary);
		margin-top: var(--space-2);
	}

	.timeline-content {
		flex: 1;
		max-width: 600px;
	}

	/* Patch Card */
	.patch-header {
		display: flex;
		justify-content: space-between;
		align-items: flex-start;
		margin-bottom: var(--space-3);
	}

	.patch-info {
		display: flex;
		flex-direction: column;
		gap: var(--space-1);
	}

	.patch-name {
		font-weight: 600;
		color: var(--color-text-primary);
	}

	.patch-meta {
		font-size: var(--font-size-xs);
		color: var(--color-text-muted);
	}

	.current-badge {
		font-size: var(--font-size-xs);
		padding: var(--space-1) var(--space-2);
		background: rgba(0, 212, 255, 0.2);
		color: var(--color-accent-primary);
		border-radius: var(--radius-sm);
	}

	.patch-summary {
		font-size: var(--font-size-sm);
		color: var(--color-text-secondary);
		margin-bottom: var(--space-2);
	}

	.patch-rationale {
		font-size: var(--font-size-xs);
		color: var(--color-text-muted);
		font-style: italic;
		margin-bottom: var(--space-3);
	}

	/* Diff List */
	.diff-list {
		display: flex;
		flex-direction: column;
		gap: var(--space-2);
		padding-top: var(--space-3);
		border-top: 1px solid var(--color-border-secondary);
	}

	.diff-item {
		display: flex;
		align-items: center;
		gap: var(--space-2);
		font-size: var(--font-size-xs);
		font-family: var(--font-mono);
	}

	.diff-op {
		font-weight: bold;
		width: 16px;
		text-align: center;
	}

	.diff-agent {
		color: var(--color-accent-secondary);
	}

	.diff-path {
		color: var(--color-text-muted);
	}

	.diff-value {
		padding: 0 var(--space-1);
		border-radius: var(--radius-sm);
	}

	.diff-value.add {
		background: rgba(16, 185, 129, 0.2);
		color: var(--color-accent-success);
	}

	.diff-value.remove {
		background: rgba(239, 68, 68, 0.2);
		color: var(--color-accent-error);
		text-decoration: line-through;
	}
</style>
</file>

<file path="src/routes/settings/+page.svelte">
<!--
  Settings Page - è¨­å®š
-->
<script lang="ts">
	import { Panel, Button, StatusIndicator } from '$lib/components/ui';
	import { integrationConfig, updateConfig } from '$lib/stores/integration-store';
	import { settings } from '$lib/stores/settings-store';
	import { session } from '$lib/stores/session-store';
	import { encryptData, decryptData } from '$lib/utils/crypto-utils';
	import { saveToStorage, loadFromStorage, STORAGE_KEYS } from '$lib/utils/storage-utils';

	// Aether Console Settings
	let consoleUrl = $state($integrationConfig.consoleUrl);
	let autoSync = $state($integrationConfig.autoSync);
	let syncInterval = $state($integrationConfig.syncInterval);

	function saveIntegrationSettings() {
		updateConfig({
			consoleUrl,
			autoSync,
			syncInterval
		});
		alert('é€£æºè¨­å®šã‚’ä¿å­˜ã—ã¾ã—ãŸ');
	}

	// AI Settings
	let apiKeyInput = $state('');
	let passwordInput = $state('');
	let isApiKeyLoading = $state(false);
	let isModelRefreshing = $state(false);

	async function saveApiKey() {
		if (!apiKeyInput || !passwordInput) {
			alert('APIã‚­ãƒ¼ã¨ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
			return;
		}

		isApiKeyLoading = true;
		try {
			// æš—å·åŒ–ã—ã¦ä¿å­˜
			const encrypted = await encryptData(apiKeyInput, passwordInput);
			saveToStorage('spec-flow-studio:api-key-encrypted', encrypted);

			// ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’ã‚»ãƒƒã‚·ãƒ§ãƒ³ã«ä¿æŒ
			session.setPassword(passwordInput);

			// è¨­å®šæ›´æ–°
			settings.updateSettings({ hasApiKey: true });

			// ãƒ¢ãƒ‡ãƒ«ä¸€è¦§ã®å–å¾—ã‚’è©¦è¡Œ
			await refreshModels(apiKeyInput);

			// å…¥åŠ›ã‚¯ãƒªã‚¢
			apiKeyInput = '';
			passwordInput = '';

			alert('APIã‚­ãƒ¼ã‚’æš—å·åŒ–ã—ã¦ä¿å­˜ã—ã€ãƒ¢ãƒ‡ãƒ«ä¸€è¦§ã‚’æ›´æ–°ã—ã¾ã—ãŸ');
		} catch (error) {
			console.error(error);
			alert('APIã‚­ãƒ¼ã®ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸ');
		} finally {
			isApiKeyLoading = false;
		}
	}

	async function refreshModels(apiKeyRaw?: string) {
		let apiKey = apiKeyRaw;

		// å¼•æ•°ãŒãªã„å ´åˆã¯ä¿å­˜ã•ã‚ŒãŸã‚­ãƒ¼ã‚’å¾©å·åŒ–ã—ã¦ä½¿ç”¨
		if (!apiKey && $settings.hasApiKey && $session.encryptionPassword) {
			const encryptedKey = loadFromStorage('spec-flow-studio:api-key-encrypted', '');
			if (encryptedKey) {
				try {
					apiKey = await decryptData(encryptedKey, $session.encryptionPassword);
				} catch (e) {
					console.error('Failed to decrypt API key for model refresh', e);
				}
			}
		}

		if (!apiKey) {
			console.log('Skipping model refresh: No API key available');
			return;
		}

		isModelRefreshing = true;
		try {
			const res = await fetch('/api/models', {
				headers: { 'x-api-key': apiKey }
			});
			if (res.ok) {
				const data = await res.json();
				const models = data.models.map((m: any) => m.name);
				if (models.length > 0) {
					settings.updateSettings({ availableModels: models });
					// ç¾åœ¨é¸æŠã•ã‚Œã¦ã„ã‚‹ãƒ¢ãƒ‡ãƒ«ãŒãƒªã‚¹ãƒˆã«ãªã‘ã‚Œã°ã€ãƒªã‚¹ãƒˆã®æœ€åˆã‚’é¸æŠ
					if (!$settings.geminiModel || !models.includes($settings.geminiModel)) {
						settings.updateSettings({ geminiModel: models[0] });
					}
				}
			}
		} catch (e) {
			console.error('Failed to refresh models', e);
		} finally {
			isModelRefreshing = false;
		}
	}

	// æ‰‹å‹•æ›´æ–°ãƒœã‚¿ãƒ³ç”¨ãƒãƒ³ãƒ‰ãƒ©
	async function handleRefreshClick() {
		if (!$session.encryptionPassword) {
			alert('ãƒ¢ãƒ‡ãƒ«ä¸€è¦§ã‚’æ›´æ–°ã™ã‚‹ã«ã¯ã€ã¾ãšAPIã‚­ãƒ¼ã‚’ä¿å­˜ï¼ˆã¾ãŸã¯å†å…¥åŠ›ï¼‰ã—ã¦ãã ã•ã„');
			return;
		}
		await refreshModels();
		alert('ãƒ¢ãƒ‡ãƒ«ä¸€è¦§ã‚’æ›´æ–°ã—ã¾ã—ãŸ');
	}

	function handleModelChange(e: Event) {
		const select = e.target as HTMLSelectElement;
		settings.updateSettings({ geminiModel: select.value });
	}
</script>

<div class="page">
	<header class="page__header">
		<h1>è¨­å®š</h1>
		<p class="page__subtitle">ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³è¨­å®š</p>
	</header>

	<div class="settings-grid">
		<!-- AIè¨­å®š -->
		<Panel title="AI ç”Ÿæˆè¨­å®š (Gemini API)">
			<div class="settings-form">
				<div class="form-group">
					<div class="model-select-header">
						<label for="geminiModel">ä½¿ç”¨ãƒ¢ãƒ‡ãƒ«</label>
						<button
							class="refresh-btn"
							onclick={handleRefreshClick}
							disabled={isModelRefreshing || !$settings.hasApiKey}
							title="ãƒ¢ãƒ‡ãƒ«ä¸€è¦§ã‚’æ›´æ–°"
						>
							{#if isModelRefreshing}
								âŸ³ Updating...
							{:else}
								âŸ³ ãƒ¢ãƒ‡ãƒ«ä¸€è¦§ã‚’æ›´æ–°
							{/if}
						</button>
					</div>
					<select
						id="geminiModel"
						value={$settings.geminiModel}
						onchange={handleModelChange}
						class="form-select"
					>
						{#each $settings.availableModels as model}
							<option value={model}>{model}</option>
						{/each}
					</select>
				</div>

				<div class="api-key-section">
					<div class="status-row">
						<span class="status-label">APIã‚­ãƒ¼çŠ¶æ…‹:</span>
						<StatusIndicator
							status={$settings.hasApiKey ? 'success' : 'warning'}
							label={$settings.hasApiKey ? 'è¨­å®šæ¸ˆã¿ (æš—å·åŒ–)' : 'æœªè¨­å®š'}
						/>
					</div>

					<div class="form-group">
						<label for="apiKey">Gemini API Key</label>
						<input
							id="apiKey"
							type="password"
							bind:value={apiKeyInput}
							placeholder={$settings.hasApiKey ? 'â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢' : 'AIza...'}
						/>
					</div>

					<div class="form-group">
						<label for="password">æš—å·åŒ–ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰</label>
						<input
							id="password"
							type="password"
							bind:value={passwordInput}
							placeholder="APIã‚­ãƒ¼ã‚’ä¿è­·ã™ã‚‹ãŸã‚ã®ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰"
						/>
						<p class="help-text">
							â€» APIã‚­ãƒ¼ã¯ã“ã®ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã§æš—å·åŒ–ã•ã‚Œã€ãƒ–ãƒ©ã‚¦ã‚¶ã®LocalStorageã«ä¿å­˜ã•ã‚Œã¾ã™ã€‚<br />
							â€» ã‚µãƒ¼ãƒãƒ¼ã«ã¯æš—å·åŒ–ã•ã‚ŒãŸçŠ¶æ…‹ã§ã‚‚ä¿å­˜ã•ã‚Œã¾ã›ã‚“ã€‚<br />
							â€» ç”Ÿæˆæ©Ÿèƒ½ã‚’ä½¿ç”¨ã™ã‚‹ãŸã³ã«ã“ã®ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒå¿…è¦ã«ãªã‚Šã¾ã™ï¼ˆã‚»ãƒƒã‚·ãƒ§ãƒ³ä¸­ã¯ä¿æŒï¼‰ã€‚
						</p>
					</div>

					<div class="form-actions">
						<Button
							variant="primary"
							onclick={saveApiKey}
							disabled={!apiKeyInput || !passwordInput || isApiKeyLoading}
							loading={isApiKeyLoading}
						>
							APIã‚­ãƒ¼ã‚’ä¿å­˜
						</Button>
					</div>
				</div>
			</div>
		</Panel>

		<!-- Aether Console é€£æº -->
		<Panel title="Aether Console é€£æº">
			<form
				class="settings-form"
				onsubmit={(e) => {
					e.preventDefault();
					saveIntegrationSettings();
				}}
			>
				<div class="form-group">
					<label for="consoleUrl">Console URL</label>
					<input
						id="consoleUrl"
						type="text"
						bind:value={consoleUrl}
						placeholder="ws://localhost:5173/api/ws"
					/>
				</div>

				<div class="form-group form-group--inline">
					<input id="autoSync" type="checkbox" bind:checked={autoSync} />
					<label for="autoSync">è‡ªå‹•åŒæœŸã‚’æœ‰åŠ¹ã«ã™ã‚‹</label>
				</div>

				<div class="form-group">
					<label for="syncInterval">åŒæœŸé–“éš” (ms)</label>
					<input
						id="syncInterval"
						type="number"
						bind:value={syncInterval}
						min="1000"
						max="60000"
						step="1000"
					/>
				</div>

				<div class="form-actions">
					<Button type="submit" variant="secondary">é€£æºè¨­å®šã‚’ä¿å­˜</Button>
				</div>
			</form>
		</Panel>

		<Panel title="ãƒ‡ãƒ¼ã‚¿ç®¡ç†">
			<div class="data-actions">
				<div class="data-action">
					<div class="data-action__info">
						<h4>ãƒ­ãƒ¼ã‚«ãƒ«ãƒ‡ãƒ¼ã‚¿ã®ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ</h4>
						<p>Specã€ç”Ÿæˆç‰©ã€ãƒ‘ãƒƒãƒå±¥æ­´ã‚’JSONã§ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ</p>
					</div>
					<Button variant="secondary" size="sm">ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ</Button>
				</div>

				<div class="data-action">
					<div class="data-action__info">
						<h4>ãƒ­ãƒ¼ã‚«ãƒ«ãƒ‡ãƒ¼ã‚¿ã®ã‚¤ãƒ³ãƒãƒ¼ãƒˆ</h4>
						<p>ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã—ãŸJSONãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿è¾¼ã¿</p>
					</div>
					<Button variant="secondary" size="sm">ã‚¤ãƒ³ãƒãƒ¼ãƒˆ</Button>
				</div>

				<div class="data-action data-action--danger">
					<div class="data-action__info">
						<h4>å…¨ãƒ‡ãƒ¼ã‚¿ã‚’å‰Šé™¤</h4>
						<p>ãƒ­ãƒ¼ã‚«ãƒ«ã«ä¿å­˜ã•ã‚ŒãŸå…¨ã¦ã®ãƒ‡ãƒ¼ã‚¿ã‚’å‰Šé™¤</p>
					</div>
					<Button variant="danger" size="sm">å‰Šé™¤</Button>
				</div>
			</div>
		</Panel>
	</div>
</div>

<style>
	.page {
		animation: fade-in var(--transition-base) ease-out;
	}

	.page__header {
		margin-bottom: var(--space-8);
	}

	.page__header h1 {
		margin-bottom: var(--space-2);
	}

	.page__subtitle {
		color: var(--color-text-muted);
	}

	.settings-grid {
		display: flex;
		flex-direction: column;
		gap: var(--space-6);
		max-width: 600px;
	}

	/* Form */
	.settings-form {
		display: flex;
		flex-direction: column;
		gap: var(--space-5);
	}

	.form-group {
		display: flex;
		flex-direction: column;
		gap: var(--space-2);
	}

	.form-group--inline {
		flex-direction: row;
		align-items: center;
	}

	.model-select-header {
		display: flex;
		justify-content: space-between;
		align-items: center;
		margin-bottom: var(--space-2);
	}

	.refresh-btn {
		background: none;
		border: none;
		color: var(--color-accent-primary);
		font-size: var(--font-size-xs);
		cursor: pointer;
		padding: 0;
		opacity: 0.8;
		transition: opacity 0.2s;
	}

	.refresh-btn:hover {
		opacity: 1;
		text-decoration: underline;
	}

	.refresh-btn:disabled {
		opacity: 0.5;
		cursor: not-allowed;
		text-decoration: none;
	}

	.form-group label {
		font-size: var(--font-size-sm);
		color: var(--color-text-secondary);
	}

	.form-group input[type='text'],
	.form-group input[type='password'],
	.form-group input[type='number'],
	.form-select {
		padding: var(--space-3);
		background: var(--color-bg-tertiary);
		border: 1px solid var(--color-border-primary);
		border-radius: var(--radius-md);
		color: var(--color-text-primary);
		font-family: var(--font-mono);
		font-size: var(--font-size-sm);
		width: 100%;
	}

	.form-group input:focus,
	.form-select:focus {
		outline: none;
		border-color: var(--color-accent-primary);
		box-shadow: 0 0 0 2px rgba(0, 212, 255, 0.2);
	}

	.form-group input[type='checkbox'] {
		accent-color: var(--color-accent-primary);
		width: auto;
	}

	.help-text {
		font-size: var(--font-size-xs);
		color: var(--color-text-muted);
		line-height: 1.4;
		margin-top: var(--space-1);
	}

	.status-row {
		display: flex;
		align-items: center;
		gap: var(--space-3);
		margin-bottom: var(--space-4);
		padding-bottom: var(--space-4);
		border-bottom: 1px solid var(--color-border-secondary);
	}

	.status-label {
		font-size: var(--font-size-sm);
		color: var(--color-text-secondary);
	}

	.form-actions {
		display: flex;
		justify-content: flex-end;
		margin-top: var(--space-2);
	}

	/* Data Actions */
	.data-actions {
		display: flex;
		flex-direction: column;
		gap: var(--space-4);
	}

	.data-action {
		display: flex;
		justify-content: space-between;
		align-items: center;
		padding: var(--space-4);
		background: var(--color-bg-tertiary);
		border-radius: var(--radius-md);
	}

	.data-action--danger {
		border: 1px solid rgba(239, 68, 68, 0.3);
	}

	.data-action__info h4 {
		font-size: var(--font-size-sm);
		margin-bottom: var(--space-1);
	}

	.data-action__info p {
		font-size: var(--font-size-xs);
		color: var(--color-text-muted);
	}
</style>
</file>

<file path="src/routes/viewer/+page.svelte">
<!--
  Viewer Page
  AIç”Ÿæˆç‰©ãƒ“ãƒ¥ãƒ¼ã‚¢ (UI Mock / API Spec)
-->
<script lang="ts">
	import { onDestroy } from 'svelte';
	import { Panel, Button } from '$lib/components/ui';
	import { artifacts, removeArtifact, latestArtifacts } from '$lib/stores/artifact-store';
	import { SpecEditor } from '$lib/components/editor';
	import type { Artifact } from '$lib/types';

	// çŠ¶æ…‹
	let selectedArtifactId = $state<string | null>(null);
	let viewMode = $state<'preview' | 'code'>('preview');

	// é¸æŠä¸­ã®Artifact
	let selectedArtifact = $derived.by(() => {
		if ($artifacts.length === 0) return null;
		if (selectedArtifactId) {
			return $artifacts.find((a) => a.id === selectedArtifactId) || $artifacts[0];
		}
		return $artifacts[$artifacts.length - 1]; // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§æœ€æ–°
	});

	// Artifacté¸æŠãƒãƒ³ãƒ‰ãƒ©
	function selectArtifact(id: string) {
		selectedArtifactId = id;
	}

	// å‰Šé™¤ãƒãƒ³ãƒ‰ãƒ©
	function handleDelete(id: string) {
		if (confirm('ã“ã®ç”Ÿæˆç‰©ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ')) {
			removeArtifact(id);
			if (selectedArtifactId === id) {
				selectedArtifactId = null;
			}
		}
	}

	// UI Mock ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ç”¨ã®Blob URL
	let previewUrl = $state<string | null>(null);

	$effect(() => {
		if (previewUrl) {
			URL.revokeObjectURL(previewUrl);
			previewUrl = null;
		}

		if (selectedArtifact && selectedArtifact.type === 'ui-mock') {
			const blob = new Blob([selectedArtifact.content], { type: 'text/html' });
			previewUrl = URL.createObjectURL(blob);
		}
	});

	onDestroy(() => {
		if (previewUrl) URL.revokeObjectURL(previewUrl);
	});
</script>

<div class="viewer-page">
	<header class="viewer-header">
		<h1>ç”Ÿæˆç‰©ãƒ“ãƒ¥ãƒ¼ã‚¢</h1>

		{#if selectedArtifact}
			<div class="header-controls">
				<div class="view-mode-toggle">
					<button
						class="toggle-btn"
						class:active={viewMode === 'preview'}
						onclick={() => (viewMode = 'preview')}
					>
						Preview
					</button>
					<button
						class="toggle-btn"
						class:active={viewMode === 'code'}
						onclick={() => (viewMode = 'code')}
					>
						Code
					</button>
				</div>
				<Button variant="danger" size="sm" onclick={() => handleDelete(selectedArtifact.id)}
					>å‰Šé™¤</Button
				>
			</div>
		{/if}
	</header>

	<div class="viewer-layout">
		<!-- å·¦å´: Artifactãƒªã‚¹ãƒˆ -->
		<div class="viewer-sidebar">
			<Panel title="Artifacts" class="h-full">
				<div class="artifact-list">
					{#each $artifacts as artifact}
						<button
							class="artifact-item"
							class:active={selectedArtifact?.id === artifact.id}
							onclick={() => selectArtifact(artifact.id)}
						>
							<div class="artifact-icon">
								{#if artifact.type === 'ui-mock'}ğŸ¨{:else}ğŸ“„{/if}
							</div>
							<div class="artifact-info">
								<span class="artifact-name">{artifact.name}</span>
								<span class="artifact-date">
									{new Date(artifact.generatedAt).toLocaleTimeString()}
								</span>
							</div>
						</button>
					{/each}

					{#if $artifacts.length === 0}
						<div class="empty-list">
							<p>ç”Ÿæˆç‰©ãŒã‚ã‚Šã¾ã›ã‚“</p>
							<a href="/editor" class="text-accent underline">ã‚¨ãƒ‡ã‚£ã‚¿ã§ç”Ÿæˆ</a>
						</div>
					{/if}
				</div>
			</Panel>
		</div>

		<!-- å³å´: ãƒ“ãƒ¥ãƒ¼ã‚¢ã‚¨ãƒªã‚¢ -->
		<div class="viewer-main">
			{#if selectedArtifact}
				<div class="artifact-content">
					<!-- Preview Mode -->
					<div class="content-view" class:hidden={viewMode !== 'preview'}>
						{#if selectedArtifact.type === 'ui-mock'}
							<div class="preview-container">
								{#if previewUrl}
									<iframe src={previewUrl} title="UI Preview" class="preview-iframe"></iframe>
								{/if}
							</div>
						{:else if selectedArtifact.type === 'api-spec'}
							<div class="api-preview-placeholder">
								<p>OpenAPIãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã¯ç¾åœ¨ã‚³ãƒ¼ãƒ‰ãƒ¢ãƒ¼ãƒ‰ã®ã¿å¯¾å¿œã—ã¦ã„ã¾ã™ã€‚</p>
								<Button size="sm" onclick={() => (viewMode = 'code')}>ã‚³ãƒ¼ãƒ‰ã‚’è¡¨ç¤º</Button>
							</div>
						{:else}
							<div class="text-preview">
								<pre>{selectedArtifact.content}</pre>
							</div>
						{/if}
					</div>

					<!-- Code Mode -->
					<div class="content-view" class:hidden={viewMode !== 'code'}>
						<SpecEditor value={selectedArtifact.content} readonly={true} />
					</div>
				</div>
			{:else}
				<div class="empty-state">
					<p>å·¦å´ã®ãƒªã‚¹ãƒˆã‹ã‚‰ç”Ÿæˆç‰©ã‚’é¸æŠã™ã‚‹ã‹ã€ã‚¨ãƒ‡ã‚£ã‚¿ã§æ–°ã—ãç”Ÿæˆã—ã¦ãã ã•ã„ã€‚</p>
				</div>
			{/if}
		</div>
	</div>
</div>

<style>
	.viewer-page {
		height: calc(100vh - var(--header-height));
		display: flex;
		flex-direction: column;
		gap: var(--space-4);
		animation: fade-in var(--transition-base) ease-out;
	}

	.viewer-header {
		display: flex;
		justify-content: space-between;
		align-items: center;
		height: var(--space-10);
	}

	.header-controls {
		display: flex;
		align-items: center;
		gap: var(--space-4);
	}

	.view-mode-toggle {
		display: flex;
		background: var(--color-bg-tertiary);
		border-radius: var(--radius-md);
		padding: 2px;
		border: 1px solid var(--color-border-primary);
	}

	.toggle-btn {
		padding: var(--space-1) var(--space-3);
		border: none;
		background: transparent;
		color: var(--color-text-secondary);
		border-radius: var(--radius-sm);
		cursor: pointer;
		font-size: var(--font-size-sm);
		transition: all 0.2s;
	}

	.toggle-btn.active {
		background: var(--color-bg-primary);
		color: var(--color-text-primary);
		box-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
	}

	.viewer-layout {
		flex: 1;
		display: grid;
		grid-template-columns: 250px 1fr;
		gap: var(--space-4);
		min-height: 0;
	}

	/* Sidebar */
	.viewer-sidebar {
		height: 100%;
		overflow-y: auto;
	}

	:global(.h-full) {
		height: 100%;
	}

	.artifact-list {
		display: flex;
		flex-direction: column;
		gap: var(--space-2);
	}

	.artifact-item {
		display: flex;
		align-items: center;
		gap: var(--space-3);
		padding: var(--space-3);
		background: transparent;
		border: 1px solid transparent;
		border-radius: var(--radius-md);
		cursor: pointer;
		text-align: left;
		transition: all 0.2s;
		width: 100%;
	}

	.artifact-item:hover {
		background: var(--color-bg-hover);
	}

	.artifact-item.active {
		background: rgba(0, 212, 255, 0.1);
		border-color: var(--color-accent-primary);
	}

	.artifact-icon {
		font-size: var(--font-size-lg);
	}

	.artifact-info {
		display: flex;
		flex-direction: column;
		overflow: hidden;
	}

	.artifact-name {
		font-size: var(--font-size-sm);
		color: var(--color-text-primary);
		white-space: nowrap;
		overflow: hidden;
		text-overflow: ellipsis;
	}

	.artifact-date {
		font-size: var(--font-size-xs);
		color: var(--color-text-muted);
	}

	.empty-list {
		padding: var(--space-4);
		text-align: center;
		color: var(--color-text-muted);
		font-size: var(--font-size-sm);
	}

	/* Main */
	.viewer-main {
		background: var(--color-bg-secondary);
		border: 1px solid var(--color-border-primary);
		border-radius: var(--radius-lg);
		overflow: hidden;
		display: flex;
		flex-direction: column;
	}

	.artifact-content {
		flex: 1;
		display: flex;
		flex-direction: column;
		overflow: hidden;
	}

	.content-view {
		flex: 1;
		display: flex;
		flex-direction: column;
		overflow: hidden;
		height: 100%;
	}

	.content-view.hidden {
		display: none;
	}

	.preview-container {
		flex: 1;
		background: white; /* ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã¯è¦‹ã‚„ã™ãç™½èƒŒæ™¯ */
	}

	.preview-iframe {
		width: 100%;
		height: 100%;
		border: none;
	}

	.api-preview-placeholder {
		display: flex;
		flex-direction: column;
		align-items: center;
		justify-content: center;
		height: 100%;
		gap: var(--space-4);
		color: var(--color-text-muted);
	}

	.text-preview {
		padding: var(--space-4);
		overflow: auto;
		font-family: var(--font-mono);
		white-space: pre-wrap;
	}

	.empty-state {
		display: flex;
		align-items: center;
		justify-content: center;
		height: 100%;
		color: var(--color-text-secondary);
	}

	.text-accent {
		color: var(--color-accent-primary);
	}

	.underline {
		text-decoration: underline;
	}
</style>
</file>

<file path="src/routes/+layout.svelte">
<script lang="ts">
	import '../app.css';
	import Sidebar from '$lib/components/Sidebar.svelte';
	import StatusBar from '$lib/components/StatusBar.svelte';

	let { children } = $props();
</script>

<svelte:head>
	<title>Spec-Flow Studio</title>
</svelte:head>

<div class="app">
	<Sidebar />
	<main class="main">
		{@render children()}
	</main>
	<StatusBar />
</div>

<style>
	.app {
		min-height: 100vh;
		background: var(--color-bg-primary);
	}

	.main {
		margin-left: var(--sidebar-width);
		min-height: 100vh;
		padding: var(--space-6);
		padding-bottom: calc(var(--statusbar-height) + var(--space-6));
	}

	/* èƒŒæ™¯ã®ã‚°ãƒ­ãƒ¼åŠ¹æœ */
	.app::before {
		content: '';
		position: fixed;
		top: 0;
		left: 0;
		right: 0;
		bottom: 0;
		background: var(--gradient-glow);
		pointer-events: none;
		z-index: -1;
	}
</style>
</file>

<file path="src/routes/+page.svelte">
<!--
  Dashboard Page
  ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ - ç¾åœ¨ã®Specåã€Artifactä¸€è¦§ã€æ¥ç¶šçŠ¶æ…‹ã‚’è¡¨ç¤º
-->
<script lang="ts">
	import { Panel, Button, StatusIndicator } from '$lib/components/ui';
	import { specs, currentSpecName, hasSpec } from '$lib/stores/spec-store';
	import { latestArtifacts, artifactCounts, hasArtifacts } from '$lib/stores/artifact-store';
	import { connectionStatus, patchCount } from '$lib/stores/integration-store';

	const statusMap = {
		disconnected: 'offline',
		connecting: 'warning',
		connected: 'success',
		error: 'error'
	} as const;

	const artifactTypeLabels = {
		'ui-mock': 'UIãƒ¢ãƒƒã‚¯',
		'api-spec': 'APIä»•æ§˜',
		'test-case': 'ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹',
		'use-case': 'ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹'
	};

	let currentStatus = $derived(statusMap[$connectionStatus]);
</script>

<div class="dashboard">
	<header class="dashboard__header">
		<h1>ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</h1>
		<p class="dashboard__subtitle">Spec-Flow Studio ã¸ã‚ˆã†ã“ã</p>
	</header>

	<div class="dashboard__grid">
		<!-- ç¾åœ¨ã®Spec -->
		<Panel title="ç¾åœ¨ã®ä»•æ§˜" variant="accent" glow={$hasSpec}>
			{#if $hasSpec}
				<div class="spec-info">
					<div class="spec-info__name">{$currentSpecName || 'Untitled'}</div>
					<div class="spec-info__count">{$specs.length} ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ</div>
					<div class="spec-info__agents">
						{#each $specs as agent}
							<span class="spec-info__agent">{agent.displayName}</span>
						{/each}
					</div>
				</div>
			{:else}
				<div class="empty-state">
					<span class="empty-state__icon">â—‡</span>
					<p class="empty-state__text">ä»•æ§˜ãŒèª­ã¿è¾¼ã¾ã‚Œã¦ã„ã¾ã›ã‚“</p>
					<Button variant="primary" size="sm">
						ã‚¨ãƒ‡ã‚£ã‚¿ã‚’é–‹ã
					</Button>
				</div>
			{/if}
		</Panel>

		<!-- æ¥ç¶šçŠ¶æ…‹ -->
		<Panel title="Aether Console æ¥ç¶š">
			<div class="connection-info">
				<StatusIndicator
					status={currentStatus}
					pulse={$connectionStatus === 'connected'}
					size="lg"
				/>
				<div class="connection-info__details">
					{#if $connectionStatus === 'connected'}
						<p>Aether Console ã¨æ¥ç¶šä¸­</p>
						<span class="connection-info__patches">{$patchCount} ãƒ‘ãƒƒãƒ</span>
					{:else if $connectionStatus === 'connecting'}
						<p>æ¥ç¶šã‚’è©¦è¡Œä¸­...</p>
					{:else if $connectionStatus === 'error'}
						<p class="text-error">æ¥ç¶šã‚¨ãƒ©ãƒ¼</p>
						<Button variant="secondary" size="sm">å†æ¥ç¶š</Button>
					{:else}
						<p>æœªæ¥ç¶š</p>
						<Button variant="primary" size="sm">æ¥ç¶š</Button>
					{/if}
				</div>
			</div>
		</Panel>

		<!-- ç”Ÿæˆç‰©ã‚µãƒãƒªãƒ¼ -->
		<Panel title="ç”Ÿæˆç‰©">
			{#if $hasArtifacts}
				<div class="artifacts-summary">
					<div class="artifacts-summary__counts">
						{#each Object.entries($artifactCounts) as [type, count]}
							<div class="artifacts-summary__item">
								<span class="artifacts-summary__count">{count}</span>
								<span class="artifacts-summary__type">{artifactTypeLabels[type as keyof typeof artifactTypeLabels]}</span>
							</div>
						{/each}
					</div>
				</div>
			{:else}
				<div class="empty-state">
					<span class="empty-state__icon">â—</span>
					<p class="empty-state__text">ç”Ÿæˆç‰©ã¯ã‚ã‚Šã¾ã›ã‚“</p>
					<p class="empty-state__hint">ã‚¨ãƒ‡ã‚£ã‚¿ã§ä»•æ§˜ã‚’ä½œæˆã—ã€AIã§ç”Ÿæˆã—ã¦ãã ã•ã„</p>
				</div>
			{/if}
		</Panel>

		<!-- æœ€è¿‘ã®ç”Ÿæˆç‰© -->
		<Panel title="æœ€è¿‘ã®ç”Ÿæˆç‰©" class="dashboard__recent">
			{#if $latestArtifacts.length > 0}
				<ul class="recent-list">
					{#each $latestArtifacts as artifact}
						<li class="recent-list__item">
							<span class="recent-list__type">{artifactTypeLabels[artifact.type]}</span>
							<span class="recent-list__name">{artifact.name}</span>
							<span class="recent-list__time font-mono">
								{new Date(artifact.generatedAt).toLocaleDateString('ja-JP')}
							</span>
						</li>
					{/each}
				</ul>
			{:else}
				<p class="text-muted">ã¾ã ç”Ÿæˆç‰©ãŒã‚ã‚Šã¾ã›ã‚“</p>
			{/if}
		</Panel>
	</div>
</div>

<style>
	.dashboard {
		animation: fade-in var(--transition-base) ease-out;
	}

	.dashboard__header {
		margin-bottom: var(--space-8);
	}

	.dashboard__header h1 {
		margin-bottom: var(--space-2);
	}

	.dashboard__subtitle {
		color: var(--color-text-muted);
	}

	.dashboard__grid {
		display: grid;
		grid-template-columns: repeat(2, 1fr);
		gap: var(--space-6);
	}

	.dashboard__recent {
		grid-column: span 2;
	}

	/* Spec Info */
	.spec-info__name {
		font-size: var(--font-size-xl);
		font-weight: 600;
		color: var(--color-accent-primary);
		margin-bottom: var(--space-2);
	}

	.spec-info__count {
		font-size: var(--font-size-sm);
		color: var(--color-text-secondary);
		margin-bottom: var(--space-3);
	}

	.spec-info__agents {
		display: flex;
		flex-wrap: wrap;
		gap: var(--space-2);
	}

	.spec-info__agent {
		padding: var(--space-1) var(--space-2);
		background: var(--color-bg-tertiary);
		border-radius: var(--radius-sm);
		font-size: var(--font-size-xs);
		color: var(--color-text-secondary);
	}

	/* Connection Info */
	.connection-info {
		display: flex;
		flex-direction: column;
		gap: var(--space-4);
	}

	.connection-info__details {
		display: flex;
		flex-direction: column;
		gap: var(--space-2);
	}

	.connection-info__patches {
		font-size: var(--font-size-sm);
		color: var(--color-text-muted);
		font-family: var(--font-mono);
	}

	/* Artifacts Summary */
	.artifacts-summary__counts {
		display: grid;
		grid-template-columns: repeat(2, 1fr);
		gap: var(--space-4);
	}

	.artifacts-summary__item {
		display: flex;
		flex-direction: column;
		align-items: center;
		padding: var(--space-4);
		background: var(--color-bg-tertiary);
		border-radius: var(--radius-md);
	}

	.artifacts-summary__count {
		font-size: var(--font-size-2xl);
		font-weight: 600;
		color: var(--color-accent-primary);
		font-family: var(--font-mono);
	}

	.artifacts-summary__type {
		font-size: var(--font-size-xs);
		color: var(--color-text-muted);
		margin-top: var(--space-1);
	}

	/* Empty State */
	.empty-state {
		display: flex;
		flex-direction: column;
		align-items: center;
		text-align: center;
		padding: var(--space-6);
		gap: var(--space-3);
	}

	.empty-state__icon {
		font-size: var(--font-size-3xl);
		color: var(--color-text-muted);
	}

	.empty-state__text {
		color: var(--color-text-secondary);
	}

	.empty-state__hint {
		font-size: var(--font-size-sm);
		color: var(--color-text-muted);
	}

	/* Recent List */
	.recent-list {
		list-style: none;
	}

	.recent-list__item {
		display: flex;
		align-items: center;
		gap: var(--space-4);
		padding: var(--space-3) 0;
		border-bottom: 1px solid var(--color-border-secondary);
	}

	.recent-list__item:last-child {
		border-bottom: none;
	}

	.recent-list__type {
		font-size: var(--font-size-xs);
		color: var(--color-accent-primary);
		background: rgba(0, 212, 255, 0.1);
		padding: var(--space-1) var(--space-2);
		border-radius: var(--radius-sm);
		min-width: 80px;
		text-align: center;
	}

	.recent-list__name {
		flex: 1;
		color: var(--color-text-primary);
	}

	.recent-list__time {
		font-size: var(--font-size-xs);
		color: var(--color-text-muted);
	}

	/* Responsive */
	@media (max-width: 900px) {
		.dashboard__grid {
			grid-template-columns: 1fr;
		}

		.dashboard__recent {
			grid-column: span 1;
		}
	}
</style>
</file>

<file path="src/app.html">
<!doctype html>
<html lang="ja">
	<head>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		<meta name="theme-color" content="#0a0a0f" />
		<meta name="description" content="Spec-Flow Studio - AIãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼å¯è¦–åŒ–ãƒ»åˆ¶å¾¡ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ " />
		<link rel="icon" href="%sveltekit.assets%/favicon.png" />
		<link rel="manifest" href="%sveltekit.assets%/manifest.json" />
		<link rel="preconnect" href="https://fonts.googleapis.com" />
		<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
		<link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet" />
		%sveltekit.head%
	</head>
	<body data-sveltekit-preload-data="hover">
		<div style="display: contents">%sveltekit.body%</div>
	</body>
</html>
</file>

<file path="src/lib/utils/index.ts">
// Utilities
export * from './yaml-utils';
export * from './storage-utils';
export * from './crypto-utils';
export * from './diff-utils';
</file>

<file path="package.json">
{
	"name": "spec-flow-studio",
	"private": true,
	"version": "0.0.1",
	"type": "module",
	"scripts": {
		"dev": "vite dev",
		"build": "vite build",
		"preview": "vite preview",
		"prepare": "svelte-kit sync || echo ''",
		"check": "svelte-kit sync && svelte-check --tsconfig ./tsconfig.json",
		"check:watch": "svelte-kit sync && svelte-check --tsconfig ./tsconfig.json --watch",
		"format": "prettier --write .",
		"lint": "prettier --check . && eslint ."
	},
	"devDependencies": {
		"@eslint/compat": "^1.4.0",
		"@eslint/js": "^9.39.1",
		"@sveltejs/adapter-auto": "^7.0.0",
		"@sveltejs/kit": "^2.49.1",
		"@sveltejs/vite-plugin-svelte": "^6.2.1",
		"@types/js-yaml": "^4.0.9",
		"@types/node": "^22",
		"eslint": "^9.39.1",
		"eslint-config-prettier": "^10.1.8",
		"eslint-plugin-svelte": "^3.13.1",
		"globals": "^16.5.0",
		"prettier": "^3.7.4",
		"prettier-plugin-svelte": "^3.4.0",
		"svelte": "^5.45.6",
		"svelte-check": "^4.3.4",
		"typescript": "^5.9.3",
		"typescript-eslint": "^8.48.1",
		"vite": "^7.2.6"
	},
	"dependencies": {
		"@codemirror/lang-yaml": "^6.1.2",
		"@codemirror/state": "^6.5.4",
		"@codemirror/theme-one-dark": "^6.1.3",
		"@codemirror/view": "^6.39.11",
		"@google/generative-ai": "^0.24.1",
		"codemirror": "^6.0.2",
		"js-yaml": "^4.1.1",
		"mermaid": "^11.12.2"
	}
}
</file>

<file path="docs/task.md">
# Phase 3.5: AIç”Ÿæˆæ‹¡å¼µ ã‚¿ã‚¹ã‚¯ãƒªã‚¹ãƒˆ

## æ¦‚è¦
Phase 3ã§å®Ÿè£…ã—ãŸAIç”Ÿæˆã‚¨ãƒ³ã‚¸ãƒ³ã‚’æ‹¡å¼µã€‚è¿½åŠ ã®ç”Ÿæˆã‚¿ã‚¤ãƒ—ï¼ˆãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ã€ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹å›³ï¼‰ã€ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆé–“é€šä¿¡ã®å¯è¦–åŒ–ã‚’å®Ÿè£…ã€‚

---

## ã‚¿ã‚¹ã‚¯

### 3.5.1 è¿½åŠ ç”Ÿæˆã‚¿ã‚¤ãƒ—
- [x] ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ç”¨ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆè¿½åŠ  (`prompt-utils.ts`)
- [x] ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹å›³(Mermaid)ç”¨ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆè¿½åŠ 
- [x] ç”Ÿæˆã‚¿ã‚¤ãƒ—é¸æŠã«æ–°ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’è¿½åŠ 
- [x] APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆæ›´æ–° (`/api/generate`)

### 3.5.2 ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆé–“é€šä¿¡å›³
- [x] `buildCommunicationDiagram()` - Specã‹ã‚‰ç›´æ¥Mermaidå›³ã‚’ç”Ÿæˆ
- [x] MermaidDiagramã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆä½œæˆ
- [x] ã‚¨ãƒ‡ã‚£ã‚¿ã‚µã‚¤ãƒ‰ãƒãƒ¼ã«é€šä¿¡å›³ãƒ‘ãƒãƒ«è¿½åŠ 

### 3.5.3 ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°ãƒ¬ã‚¹ãƒãƒ³ã‚¹å¯¾å¿œ (TODO)
- [ ] `/api/generate` ã‚’ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°å¯¾å¿œã«å¤‰æ›´
- [ ] ç”Ÿæˆãƒ¢ãƒ¼ãƒ€ãƒ«ã«ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹è¡¨ç¤ºã‚’è¿½åŠ 

---

## é€²æ—
- é–‹å§‹æ—¥: 2026-01-16
- å®Œäº†æ—¥: 2026-01-16
- çŠ¶æ…‹: **å®Œäº†** (ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°ã¯åˆ¥é€”å®Ÿè£…äºˆå®š)
- æˆæœç‰©: `prompt-utils.ts`, `MermaidDiagram.svelte`, `editor/+page.svelte`
</file>

<file path="src/routes/editor/+page.svelte">
<!--
  Editor Page
  Spec-Kit ã‚¨ãƒ‡ã‚£ã‚¿ã®å®Ÿè£…
-->
<script lang="ts">
	import { onMount } from 'svelte';
	import { Panel, Button, StatusIndicator } from '$lib/components/ui';
	import { SpecEditor, ConstraintPanel } from '$lib/components/editor';
	import MermaidDiagram from '$lib/components/MermaidDiagram.svelte';
	import {
		parseSpecYaml,
		getYamlErrors,
		AGENT_TEMPLATE,
		ANALYZER_TEMPLATE
	} from '$lib/utils/yaml-utils';
	import { saveSpecYaml, loadSpecYaml, loadFromStorage } from '$lib/utils/storage-utils';
	import { setSpecs, specs } from '$lib/stores/spec-store';
	import { settings } from '$lib/stores/settings-store';
	import { session } from '$lib/stores/session-store';
	import { decryptData } from '$lib/utils/crypto-utils';
	import { addArtifact } from '$lib/stores/artifact-store';
	import { historyStore, canUndo, canRedo } from '$lib/stores/history-store';
	import { stringifyYaml } from '$lib/utils/yaml-utils';
	import { buildCommunicationDiagram } from '$lib/utils/prompt-utils';
	import type { YamlError } from '$lib/utils/yaml-utils';
	import type { ArtifactType, AgentSpec } from '$lib/types';
	import { goto } from '$app/navigation';

	// çŠ¶æ…‹
	let yamlContent = $state('');
	let yamlErrors = $state<YamlError[]>([]);
	let isDirty = $state(false);
	let currentTemplate = $state('default');

	// ç”Ÿæˆãƒ¢ãƒ¼ãƒ€ãƒ«çŠ¶æ…‹
	let showGenerateModal = $state(false);
	let isGenerating = $state(false);
	let selectedArtifactType = $state<ArtifactType>('ui-mock');
	let tempPassword = $state(''); // ã‚»ãƒƒã‚·ãƒ§ãƒ³ã«ãªã„å ´åˆã®ä¸€æ™‚å…¥åŠ›ç”¨

	// å±¥æ­´ç®¡ç†ç”¨ã®çŠ¶æ…‹
	let previousSpecs = $state<AgentSpec[]>([]);
	let commitName = $state('');

	// åˆæœŸåŒ–
	onMount(() => {
		const saved = loadSpecYaml();
		if (saved.yaml) {
			yamlContent = saved.yaml;
			validateYaml(saved.yaml);
			// å±¥æ­´ã®åˆæœŸåŒ–
			historyStore.initialize($specs);
			previousSpecs = [...$specs];
		} else {
			yamlContent = AGENT_TEMPLATE;
			validateYaml(AGENT_TEMPLATE);
		}
	});

	// YAMLã®æ¤œè¨¼ã¨ãƒ‘ãƒ¼ã‚¹
	function validateYaml(content: string) {
		const errors = getYamlErrors(content);
		yamlErrors = errors;

		if (errors.length === 0) {
			try {
				const parsedSpecs = parseSpecYaml(content);
				setSpecs(parsedSpecs, 'draft-spec'); // ã‚¹ãƒˆã‚¢æ›´æ–°
			} catch (e) {
				console.error('Spec parse error:', e);
			}
		}
	}

	// ã‚¨ãƒ‡ã‚£ã‚¿å¤‰æ›´ãƒãƒ³ãƒ‰ãƒ©
	function handleChange(newContent: string) {
		yamlContent = newContent;
		isDirty = true;
		validateYaml(newContent);
		// è‡ªå‹•ä¿å­˜ (ç°¡æ˜“)
		saveSpecYaml(newContent, 'draft-spec');
	}

	// ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆé©ç”¨
	function applyTemplate() {
		if (confirm('ç¾åœ¨ã®å†…å®¹ã‚’ä¸Šæ›¸ãã—ã¦ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’é©ç”¨ã—ã¾ã™ã‹ï¼Ÿ')) {
			if (currentTemplate === 'analyzer') {
				yamlContent = ANALYZER_TEMPLATE;
			} else {
				yamlContent = AGENT_TEMPLATE;
			}
			validateYaml(yamlContent);
			saveSpecYaml(yamlContent, 'draft-spec');
			isDirty = false;
			previousSpecs = [...$specs];
		}
	}

	// ã‚³ãƒŸãƒƒãƒˆï¼ˆå±¥æ­´ã«è¨˜éŒ²ï¼‰
	function handleCommit() {
		if (yamlErrors.length > 0) {
			alert('YAMLã‚¨ãƒ©ãƒ¼ãŒã‚ã‚Šã¾ã™ã€‚ä¿®æ­£ã—ã¦ã‹ã‚‰ã‚³ãƒŸãƒƒãƒˆã—ã¦ãã ã•ã„ã€‚');
			return;
		}

		const patch = historyStore.commit(previousSpecs, $specs, commitName || undefined);
		if (patch) {
			previousSpecs = [...$specs];
			isDirty = false;
			commitName = '';
			alert(`å¤‰æ›´ã‚’è¨˜éŒ²ã—ã¾ã—ãŸ: ${patch.spec.summary}`);
		} else {
			alert('å¤‰æ›´ãŒã‚ã‚Šã¾ã›ã‚“');
		}
	}

	// Undo
	function handleUndo() {
		const newSpecs = historyStore.undo();
		if (newSpecs) {
			setSpecs(newSpecs, 'draft-spec');
			yamlContent = stringifyYaml(newSpecs);
			saveSpecYaml(yamlContent, 'draft-spec');
			previousSpecs = [...newSpecs];
		}
	}

	// Redo
	function handleRedo() {
		const newSpecs = historyStore.redo();
		if (newSpecs) {
			setSpecs(newSpecs, 'draft-spec');
			yamlContent = stringifyYaml(newSpecs);
			saveSpecYaml(yamlContent, 'draft-spec');
			previousSpecs = [...newSpecs];
		}
	}

	// ç”Ÿæˆå‡¦ç†ã®é–‹å§‹
	function startGeneration() {
		if ($specs.length === 0) {
			alert('æœ‰åŠ¹ãªã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆä»•æ§˜ãŒã‚ã‚Šã¾ã›ã‚“');
			return;
		}
		if (!$settings.hasApiKey) {
			alert('APIã‚­ãƒ¼ãŒè¨­å®šã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚è¨­å®šãƒšãƒ¼ã‚¸ã§è¨­å®šã—ã¦ãã ã•ã„ã€‚');
			goto('/settings');
			return;
		}
		showGenerateModal = true;
	}

	// Artifactç”Ÿæˆå®Ÿè¡Œ
	async function handleGenerate() {
		// APIã‚­ãƒ¼ã®å–å¾—ï¼ˆå¾©å·åŒ–ï¼‰
		let apiKey = '';
		try {
			const password = $session.encryptionPassword || tempPassword;
			if (!password) {
				alert('APIã‚­ãƒ¼ã®ä¿è­·ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
				return;
			}

			const encryptedKey = loadFromStorage('spec-flow-studio:api-key-encrypted', '');
			if (!encryptedKey) {
				throw new Error('æš—å·åŒ–ã•ã‚ŒãŸAPIã‚­ãƒ¼ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
			}

			// å¾©å·åŒ–è©¦è¡Œ
			apiKey = await decryptData(encryptedKey, password);

			// æˆåŠŸã—ãŸã‚‰ã‚»ãƒƒã‚·ãƒ§ãƒ³ã«ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ä¿å­˜
			if (!$session.encryptionPassword) {
				session.setPassword(password);
			}
		} catch (error) {
			console.error(error);
			alert('ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒé–“é•ã£ã¦ã„ã‚‹ã‹ã€å¾©å·åŒ–ã«å¤±æ•—ã—ã¾ã—ãŸ');
			return;
		}

		isGenerating = true;
		try {
			// æœ€åˆã®AgentSpecã‚’ä½¿ç”¨ï¼ˆè¤‡æ•°å¯¾å¿œã¯ä»Šå¾Œï¼‰
			const targetSpec = $specs[0];

			const response = await fetch('/api/generate', {
				method: 'POST',
				headers: {
					'Content-Type': 'application/json',
					'x-api-key': apiKey
				},
				body: JSON.stringify({
					spec: targetSpec,
					artifactType: selectedArtifactType,
					model: $settings.geminiModel
				})
			});

			if (!response.ok) {
				const error = await response.json();
				throw new Error(error.error || 'Generation failed');
			}

			const { content } = await response.json();

			// Artifactã‚¹ãƒˆã‚¢ã«è¿½åŠ 
			addArtifact({
				id: crypto.randomUUID(),
				type: selectedArtifactType,
				name: `${targetSpec.displayName} - ${selectedArtifactType}`,
				content: content,
				generatedAt: new Date().toISOString(),
				specId: targetSpec.name
			});

			showGenerateModal = false;
			alert('ç”ŸæˆãŒå®Œäº†ã—ã¾ã—ãŸï¼ãƒ“ãƒ¥ãƒ¼ã‚¢ã§ç¢ºèªã§ãã¾ã™ã€‚');
			goto('/viewer'); // ãƒ“ãƒ¥ãƒ¼ã‚¢ã¸é·ç§»
		} catch (error) {
			console.error('Generation error:', error);
			alert(`ç”Ÿæˆã‚¨ãƒ©ãƒ¼: ${error instanceof Error ? error.message : 'Unknown error'}`);
		} finally {
			isGenerating = false;
			tempPassword = '';
		}
	}
</script>

<div class="editor-page">
	<header class="editor-header">
		<div class="header-left">
			<h1>Spec Editor</h1>
			<StatusIndicator
				status={yamlErrors.length === 0 ? 'success' : 'error'}
				label={yamlErrors.length === 0 ? 'Valid Spec' : `${yamlErrors.length} Errors`}
			/>
		</div>
		<div class="header-right">
			<select bind:value={currentTemplate} class="template-select" title="ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆé¸æŠ">
				<option value="default">Default Template</option>
				<option value="analyzer">Analyzer Agent</option>
			</select>
			<Button variant="secondary" size="sm" onclick={applyTemplate}>Load Template</Button>
			<Button variant="ghost" size="sm" onclick={handleUndo} disabled={!$canUndo} title="å…ƒã«æˆ»ã™"
				>â†¶</Button
			>
			<Button variant="ghost" size="sm" onclick={handleRedo} disabled={!$canRedo} title="ã‚„ã‚Šç›´ã™"
				>â†·</Button
			>
			<Button
				variant="primary"
				size="sm"
				onclick={handleCommit}
				disabled={yamlErrors.length > 0 || !isDirty}>ğŸ“ ã‚³ãƒŸãƒƒãƒˆ</Button
			>
			<Button
				variant="accent"
				size="sm"
				disabled={yamlErrors.length > 0 || isGenerating}
				onclick={startGeneration}
			>
				âœ¨ Generate Artifacts
			</Button>
		</div>
	</header>

	<div class="editor-layout">
		<!-- å·¦å´: YAMLã‚¨ãƒ‡ã‚£ã‚¿ -->
		<div class="editor-main">
			<SpecEditor bind:value={yamlContent} onChange={handleChange} />
		</div>

		<!-- å³å´: ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ & æƒ…å ± -->
		<div class="editor-sidebar">
			<!-- åˆ¶ç´„ãƒ‘ãƒãƒ« -->
			<div class="sidebar-section">
				<ConstraintPanel specs={$specs} />
			</div>

			<!-- ã‚¨ãƒ©ãƒ¼ãƒ‘ãƒãƒ« (ã‚¨ãƒ©ãƒ¼æ™‚ã®ã¿è¡¨ç¤º) -->
			{#if yamlErrors.length > 0}
				<div class="sidebar-section">
					<Panel title="YAML Errors" variant="error" glow>
						<ul class="error-list">
							{#each yamlErrors as error}
								<li class="error-item">
									<span class="error-line">Line {error.line + 1}:</span>
									<span class="error-msg">{error.message}</span>
								</li>
							{/each}
						</ul>
					</Panel>
				</div>
			{/if}

			<!-- ãƒ‘ãƒ¼ã‚¹çµæœãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ (ç°¡æ˜“) -->
			<div class="sidebar-section spec-preview">
				<Panel title="Structure Preview">
					<div class="preview-content">
						{#each $specs as agent}
							<div class="agent-preview">
								<span class="agent-icon"
									>{#if agent.role.includes('è§£æ') || agent.displayName.includes('Analyzer')}ğŸ”{:else}ğŸ¤–{/if}</span
								>
								<span class="agent-name">{agent.displayName}</span>
							</div>
						{/each}
						{#if $specs.length === 0 && yamlErrors.length === 0}
							<p class="text-muted text-center text-sm">No valid agents found</p>
						{/if}
					</div>
				</Panel>
			</div>

			<!-- é€šä¿¡å›³ãƒ‘ãƒãƒ« -->
			{#if $specs.length > 0}
				<div class="sidebar-section">
					<Panel title="Communication">
						<MermaidDiagram code={buildCommunicationDiagram($specs)} id="comm-diagram" />
					</Panel>
				</div>
			{/if}
		</div>
	</div>

	<!-- ç”Ÿæˆãƒ¢ãƒ¼ãƒ€ãƒ« -->
	{#if showGenerateModal}
		<div class="modal-backdrop">
			<div class="modal">
				<h2 class="modal-title">Generate Artifacts</h2>

				<div class="modal-body">
					<div class="form-group">
						<label for="artifactType">ç”Ÿæˆã‚¿ã‚¤ãƒ—</label>
						<select id="artifactType" bind:value={selectedArtifactType} class="form-select">
							<option value="ui-mock">UI Mock (HTML/Tailwind)</option>
							<option value="api-spec">API Specification (OpenAPI)</option>
							<option value="test-case">Test Cases (Markdown)</option>
							<option value="use-case-diagram">Use Case Diagram (Mermaid)</option>
						</select>
					</div>

					{#if !$session.encryptionPassword}
						<div class="form-group">
							<label for="password">æš—å·åŒ–ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰</label>
							<input
								id="password"
								type="password"
								bind:value={tempPassword}
								placeholder="APIã‚­ãƒ¼ä¿è­·ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›"
								class="form-input"
							/>
							<p class="help-text">APIã‚­ãƒ¼ã‚’å¾©å·åŒ–ã™ã‚‹ãŸã‚ã«å¿…è¦ã§ã™ã€‚</p>
						</div>
					{/if}

					<div class="modal-info">
						<p>å¯¾è±¡: <strong>{$specs[0]?.displayName || 'Agent'}</strong></p>
						<p>ãƒ¢ãƒ‡ãƒ«: <strong>{$settings.geminiModel}</strong></p>
					</div>
				</div>

				<div class="modal-footer">
					<Button variant="ghost" onclick={() => (showGenerateModal = false)}>ã‚­ãƒ£ãƒ³ã‚»ãƒ«</Button>
					<Button
						variant="accent"
						loading={isGenerating}
						disabled={isGenerating || (!$session.encryptionPassword && !tempPassword)}
						onclick={handleGenerate}
					>
						ç”Ÿæˆé–‹å§‹
					</Button>
				</div>
			</div>
		</div>
	{/if}
</div>

<style>
	.editor-page {
		height: calc(100vh - var(--header-height)); /* èª¿æ•´ */
		display: flex;
		flex-direction: column;
		gap: var(--space-4);
		animation: fade-in var(--transition-base) ease-out;
		position: relative;
	}

	.editor-header {
		display: flex;
		justify-content: space-between;
		align-items: center;
		height: var(--space-10);
	}

	.header-left {
		display: flex;
		align-items: center;
		gap: var(--space-4);
	}

	.header-right {
		display: flex;
		align-items: center;
		gap: var(--space-3);
	}

	.template-select {
		padding: var(--space-2) var(--space-3);
		background: var(--color-bg-tertiary);
		border: 1px solid var(--color-border-primary);
		border-radius: var(--radius-md);
		color: var(--color-text-primary);
		font-family: var(--font-sans);
		font-size: var(--font-size-sm);
	}

	.editor-layout {
		flex: 1;
		display: grid;
		grid-template-columns: 1fr 300px;
		gap: var(--space-4);
		min-height: 0; /* Grid overflowå¯¾ç­– */
	}

	.editor-main {
		height: 100%;
		min-height: 0;
	}

	.editor-sidebar {
		display: flex;
		flex-direction: column;
		gap: var(--space-4);
		overflow-y: auto;
		height: 100%;
	}

	.sidebar-section {
		flex-shrink: 0;
	}

	/* Errors */
	.error-list {
		list-style: none;
		font-size: var(--font-size-xs);
		color: var(--color-accent-error);
	}

	.error-item {
		margin-bottom: var(--space-2);
		padding-bottom: var(--space-2);
		border-bottom: 1px solid rgba(239, 68, 68, 0.2);
	}

	.error-item:last-child {
		border-bottom: none;
		margin-bottom: 0;
		padding-bottom: 0;
	}

	.error-line {
		font-weight: bold;
		margin-right: var(--space-2);
	}

	/* Preview */
	.preview-content {
		display: flex;
		flex-direction: column;
		gap: var(--space-2);
	}

	.agent-preview {
		display: flex;
		align-items: center;
		gap: var(--space-2);
		padding: var(--space-2);
		background: var(--color-bg-primary);
		border-radius: var(--radius-sm);
		border: 1px solid var(--color-border-secondary);
	}

	.agent-name {
		font-size: var(--font-size-sm);
		font-weight: 500;
	}

	/* Responsive */
	@media (max-width: 1024px) {
		.editor-layout {
			grid-template-columns: 1fr;
			grid-template-rows: 1fr auto;
		}

		.editor-sidebar {
			height: auto;
			max-height: 300px;
		}
	}

	/* Modal */
	.modal-backdrop {
		position: fixed;
		top: 0;
		left: 0;
		right: 0;
		bottom: 0;
		background: rgba(0, 0, 0, 0.7);
		backdrop-filter: blur(4px);
		display: flex;
		align-items: center;
		justify-content: center;
		z-index: 1000;
	}

	.modal {
		background: var(--color-bg-secondary);
		border: 1px solid var(--color-border-primary);
		border-radius: var(--radius-lg);
		padding: var(--space-6);
		width: 100%;
		max-width: 400px;
		box-shadow: var(--shadow-xl);
	}

	.modal-title {
		font-size: var(--font-size-lg);
		font-weight: 600;
		margin-bottom: var(--space-4);
		color: var(--color-text-primary);
	}

	.modal-body {
		display: flex;
		flex-direction: column;
		gap: var(--space-4);
		margin-bottom: var(--space-6);
	}

	.form-select,
	.form-input {
		width: 100%;
		padding: var(--space-3);
		background: var(--color-bg-tertiary);
		border: 1px solid var(--color-border-primary);
		border-radius: var(--radius-md);
		color: var(--color-text-primary);
		font-size: var(--font-size-sm);
	}

	.help-text {
		font-size: var(--font-size-xs);
		color: var(--color-text-muted);
		margin-top: var(--space-1);
	}

	.modal-info {
		padding: var(--space-3);
		background: rgba(0, 212, 255, 0.1);
		border-radius: var(--radius-md);
		font-size: var(--font-size-sm);
		display: flex;
		flex-direction: column;
		gap: var(--space-1);
	}

	.modal-footer {
		display: flex;
		justify-content: flex-end;
		gap: var(--space-2);
	}
</style>
</file>

</files>
